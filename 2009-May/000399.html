<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Ethercatmaster-users] Loosing time while sending Frames
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/ethercatmaster-users/2009-May/index.html" >
   <LINK REL="made" HREF="mailto:ethercatmaster-users%40lists.berlios.de?Subject=Re%3A%20%5BEthercatmaster-users%5D%20Loosing%20time%20while%20sending%20Frames&In-Reply-To=%3COFAFC8DCF0.BAA452C9-ONC12575AD.001C338F-C12575AD.001CF967%40datacon.at%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000397.html">
   <LINK REL="Next"  HREF="000401.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Ethercatmaster-users] Loosing time while sending Frames</H1>
    <B>henning.richter at besi.com</B> 
    <A HREF="mailto:ethercatmaster-users%40lists.berlios.de?Subject=Re%3A%20%5BEthercatmaster-users%5D%20Loosing%20time%20while%20sending%20Frames&In-Reply-To=%3COFAFC8DCF0.BAA452C9-ONC12575AD.001C338F-C12575AD.001CF967%40datacon.at%3E"
       TITLE="[Ethercatmaster-users] Loosing time while sending Frames">henning.richter at besi.com
       </A><BR>
    <I>Tue May  5 07:16:29 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000397.html">[Ethercatmaster-users] Loosing time while sending Frames
</A></li>
        <LI>Next message: <A HREF="000401.html">[Ethercatmaster-users] Loosing time while sending Frames
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#399">[ date ]</a>
              <a href="thread.html#399">[ thread ]</a>
              <a href="subject.html#399">[ subject ]</a>
              <a href="author.html#399">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>



Klaas Gadeyne wrote:
&gt;&gt;<i> On Mon, 4 May 2009, <A HREF="https://lists.berlios.de/mailman/listinfo/ethercatmaster-users">henning.richter at besi.com</A> wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i> In the main function of the EML a created and started a xenomai task.
</I>&gt;&gt;&gt;&gt;&gt;<i> The cycle time of this task is set to 250 us.
</I>&gt;&gt;&gt;&gt;&gt;<i> During this time I am sending one Frame to my slaves each cycle. In
</I>all
&gt;&gt;&gt;<i> I
</I>&gt;&gt;&gt;&gt;&gt;<i> have 3 Frames (Frame1 = 60 byte, Frame 2 = 1217 byte, Frame3 = 1204
</I>&gt;&gt;&gt;<i> byte).
</I>&gt;&gt;&gt;&gt;&gt;<i> I am also measuring the time the send command from the
</I>low_level_output
&gt;&gt;&gt;&gt;&gt;<i> function in ethercat_xenomai_drv.c needs.
</I>&gt;&gt;&gt;&gt;&gt;<i> This time is between 5 and 10 us. So passing the Frames to the
</I>network
&gt;&gt;&gt;&gt;&gt;<i> interface is quite fast.
</I>&gt;&gt;&gt;&gt;&gt;<i> So far so good, now the problem:
</I>&gt;&gt;&gt;&gt;&gt;<i> Measuring the elapsed time between 2 send commands (also @
</I>&gt;&gt;&gt;&gt;&gt;<i> low_level_output) gives me values between 150 us and 350.
</I>&gt;&gt;&gt;&gt;&gt;<i> This i too much I think.
</I>&gt;&gt;&gt;<i> Apart from Jan's suggestions, does that mean that your xenomai task
</I>indeed
&gt;&gt;&gt;<i> &quot;overruns&quot;?  Can you show some code?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Klaas
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> So here is some code:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I can't see from your code below how you actually _measure_ the time
</I>while your thread runs periodically (after the rt_task_set_periodic)?
&gt;&gt;<i> However, it's been a very long time since I've worked with xenomai, but
</I>your (real-time) code is full of printf (and new) statements, which in the
good old times would make your thread switch to 'secondary mode' -&gt; which
could explain the latencies you're seeing...
&gt;<i>
</I>&gt;<i> Doing new or malloc, thus acquiring glibc-internal locks and issuing
</I>&gt;<i> mmap from time to time, can cause nasty latencies on any real time
</I>kernel.
&gt;<i>
</I>&gt;<i> printf shouldn't be issued either if latency matters. Xenomai offers
</I>&gt;<i> rt_printf as an alternative for doing lock-less printing from RT threads
</I>&gt;<i> - still typically only used for debugging purposes, and typically
</I>&gt;<i> rate-limited.
</I>&gt;<i>
</I>&gt;<i> Jan
</I>
Could there still something be wrong in Xenomai (configuration) ?
Below I paste the output of the 'xeno-test', even it did not run through
completely (it stops while generating loads).

Henning

Here the results of the 'xeno-test':

xeno-test: started
withBusybox is 0
xeno-test: running tests

Di 5. Mai 07:12:40 CEST 2009
running: ./xeno-config --verbose
xeno-config --verbose
        --version=&quot;2.4.6.1&quot;
        --cc=&quot;gcc&quot;
        --arch=&quot;x86&quot;
        --prefix=&quot;/usr/xenomai&quot;
        --xeno-cflags=&quot;-I/usr/xenomai/include -D_GNU_SOURCE -D_REENTRANT
-D__XENO__&quot;
        --xeno-ldflags=&quot;-L/usr/xenomai/lib -lpthread &quot;
        --posix-cflags=&quot;-I/usr/xenomai/include -I/usr/xenomai/include/posix
-D_GNU_SOURCE -D_REENTRANT -D__XENO__&quot;
        --posix-ldflags=&quot;-Wl,@/usr/xenomai/lib/posix.wrappers
-L/usr/xenomai/lib -lpthread_rt -lpthread -lrt &quot;
        --library-dir=&quot;/usr/xenomai/lib&quot;

Di 5. Mai 07:12:40 CEST 2009
running: ./xeno-info
If some fields are empty or look unusual you may have an old version.
Compare to the current minimal requirements in Documentation/Changes.

Linux rd-ethercat 2.6.27.7-xe #1 SMP Wed Apr 29 12:00:19 CEST 2009 i686
GNU/Linux
Gnu C                  4.3.2-1ubuntu12)
Gnu make               3.81
util-linux             ng 2.14)
mount                  ng 2.14 (with libvolume_id and selinux support)
module-init-tools      3.3-pre11
e2fsprogs              1.41.3
Linux C Library        2.8.90
Dynamic linker (ldd)   2.8.90
Procps                 3.2.7
Net-tools              1.60
Kbd                    1.14.1
Sh-utils               6.10
Modules Loaded         e100 rt_eepro100 rtpacket rtnet af_packet i915 drm
bridge stp bnep rfcomm sco l2cap bluetooth ppdev ipv6 iptable_filter
ip_tables x_tables parport_pc lp parport sr_mod cdrom isp1760 com20020_pci
com20020 arcnet evdev serio_raw iTCO_wdt psmouse iTCO_vendor_support
intel_agp shpchp pci_hotplug agpgart ext3 jbd mbcache sd_mod crc_t10dif sg
usb_storage libusual ata_piix ata_generic libata mii uhci_hcd ehci_hcd
scsi_mod usbcore fuse

Di 5. Mai 07:12:41 CEST 2009
running: cat /proc/cpuinfo
processor       : 0
vendor_id       : GenuineIntel
cpu family      : 6
model           : 9
model name      : Mobile Genuine Intel(R) processor       1100MHz
stepping        : 5
cpu MHz         : 1099.881
cache size      : 1024 KB
fdiv_bug        : no
hlt_bug         : no
f00f_bug        : no
coma_bug        : no
fpu             : yes
fpu_exception   : yes
cpuid level     : 2
wp              : yes
flags           : fpu vme de pse tsc msr mce cx8 apic sep mtrr pge mca cmov
pat clflush dts acpi mmx fxsr sse sse2 tm pbe up bts est tm2
bogomips        : 2199.76
clflush size    : 64
power management:


Di 5. Mai 07:12:41 CEST 2009
running: md5sum /proc/cpuinfo # cpuinfo fingerprint
3f1cac044dfe9caf955d09d7612b905f  /proc/cpuinfo
CONFIG_PREEMPT_NOTIFIERS=y
# CONFIG_PREEMPT_NONE is not set
CONFIG_PREEMPT_VOLUNTARY=y
# CONFIG_PREEMPT is not set
CONFIG_IPIPE=y
CONFIG_IPIPE_DOMAINS=4
CONFIG_IPIPE_COMPAT=y
CONFIG_IPIPE_DELAYED_ATOMICSW=y
# CONFIG_PM is not set
# CONFIG_CPU_FREQ is not set
# CONFIG_IPIPE_DEBUG is not set
# CONFIG_DEBUG_SPINLOCK is not set
# CONFIG_DEBUG_SPINLOCK_SLEEP is not set

Di 5. Mai 07:12:41 CEST 2009
running: cat /proc/ipipe/Linux
       +----- Handling ([A]ccepted, [G]rabbed, [W]ired, [D]iscarded)
       |+---- Sticky
       ||+--- Locked
       |||+-- Exclusive
       ||||+- Virtual
[IRQ]  |||||
   0:  A....
   1:  A....
   2:  A....
   3:  A.L..
   4:  A.L..
   5:  A....
   6:  A....
   7:  A....
   8:  A....
   9:  A....
  10:  A.L..
  11:  A.L..
  12:  A....
  13:  A....
  14:  A....
  15:  A....
  16:  A....
  17:  A....
  18:  A....
  19:  A....
  20:  A....
  21:  A....
  22:  A....
  23:  A....
  24:  A....
  25:  A....
  26:  A....
  27:  A....
  28:  A....
  29:  A....
  30:  A....
  31:  A....
  32:  A....
  33:  A....
  34:  A....
  35:  A....
  36:  A....
  37:  A....
  38:  A....
  39:  A....
  40:  A....
  41:  A....
  42:  A....
  43:  A....
  44:  A....
  45:  A....
  46:  A....
  47:  A....
  48:  A....
  49:  A....
  50:  A....
  51:  A....
  52:  A....
  53:  A....
  54:  A....
  55:  A....
  56:  A....
  57:  A....
  58:  A....
  59:  A....
  60:  A....
  61:  A....
  62:  A....
  63:  A....
  64:  A....
  65:  A....
  66:  A....
  67:  A....
  68:  A....
  69:  A....
  70:  A....
  71:  A....
  72:  A....
  73:  A....
  74:  A....
  75:  A....
  76:  A....
  77:  A....
  78:  A....
  79:  A....
  80:  A....
  81:  A....
  82:  A....
  83:  A....
  84:  A....
  85:  A....
  86:  A....
  87:  A....
  88:  A....
  89:  A....
  90:  A....
  91:  A....
  92:  A....
  93:  A....
  94:  A....
  95:  A....
  96:  A....
  97:  A....
  98:  A....
  99:  A....
 100:  A....
 101:  A....
 102:  A....
 103:  A....
 104:  A....
 105:  A....
 106:  A....
 107:  A....
 108:  A....
 109:  A....
 110:  A....
 111:  A....
 112:  A....
 113:  A....
 114:  A....
 115:  A....
 116:  A....
 117:  A....
 118:  A....
 119:  A....
 120:  A....
 121:  A....
 122:  A....
 123:  A....
 124:  A....
 125:  A....
 126:  A....
 127:  A....
 128:  A....
 129:  A....
 130:  A....
 131:  A....
 132:  A....
 133:  A....
 134:  A....
 135:  A....
 136:  A....
 137:  A....
 138:  A....
 139:  A....
 140:  A....
 141:  A....
 142:  A....
 143:  A....
 144:  A....
 145:  A....
 146:  A....
 147:  A....
 148:  A....
 149:  A....
 150:  A....
 151:  A....
 152:  A....
 153:  A....
 154:  A....
 155:  A....
 156:  A....
 157:  A....
 158:  A....
 159:  A....
 160:  A....
 161:  A....
 162:  A....
 163:  A....
 164:  A....
 165:  A....
 166:  A....
 167:  A....
 168:  A....
 169:  A....
 170:  A....
 171:  A....
 172:  A....
 173:  A....
 174:  A....
 175:  A....
 176:  A....
 177:  A....
 178:  A....
 179:  A....
 180:  A....
 181:  A....
 182:  A....
 183:  A....
 184:  A....
 185:  A....
 186:  A....
 187:  A....
 188:  A....
 189:  A....
 190:  A....
 191:  A....
 192:  A....
 193:  A....
 194:  A....
 195:  A....
 196:  A....
 197:  A....
 198:  A....
 199:  A....
 200:  A....
 201:  A....
 202:  A....
 203:  A....
 204:  A....
 205:  A....
 206:  A....
 207:  A....
 208:  A....
 209:  A....
 210:  A....
 211:  A....
 212:  A....
 213:  A....
 214:  A....
 215:  A....
 216:  A....
 217:  A....
 218:  A....
 219:  A....
 220:  A....
 221:  A....
 222:  A....
 223:  A....
 224:  A....
 230:  A....
 231:  A....
 232:  A....
 233:  A....
 234:  GS...
 235:  A....
 236:  A....
 237:  A....
 238:  A....
 239:  A....
 240:  A....
 256:  G...V
 257:  G...V
 259:  G...V
[Domain info]
id=0x00000000
priority=100

Di 5. Mai 07:12:41 CEST 2009
running: cat /proc/ipipe/Xenomai
       +----- Handling ([A]ccepted, [G]rabbed, [W]ired, [D]iscarded)
       |+---- Sticky
       ||+--- Locked
       |||+-- Exclusive
       ||||+- Virtual
[IRQ]  |||||
   9:  W..X.
 230:  W....
 233:  W..X.
 234:  GS...
 258:  W...V
[Domain info]
id=0x58454e4f
priority=topmost

Di 5. Mai 07:12:41 CEST 2009
running: cat /proc/ipipe/version
2.1-02

Di 5. Mai 07:12:41 CEST 2009
running: generate_loads 1
dd workload started, pids 5100 stored in /var/lock/xeno-test.4960.pids
 5100 pts/2    00:00:00 dd
something died a 5100 or
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20090505/e19c8e93/attachment.html">https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20090505/e19c8e93/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000397.html">[Ethercatmaster-users] Loosing time while sending Frames
</A></li>
	<LI>Next message: <A HREF="000401.html">[Ethercatmaster-users] Loosing time while sending Frames
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#399">[ date ]</a>
              <a href="thread.html#399">[ thread ]</a>
              <a href="subject.html#399">[ subject ]</a>
              <a href="author.html#399">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/ethercatmaster-users">More information about the Ethercatmaster-users
mailing list</a><br>
</body></html>
