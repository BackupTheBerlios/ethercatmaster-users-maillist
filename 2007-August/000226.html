<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Ethercatmaster-users] RE : Re: understanding the datagrams
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/ethercatmaster-users/2007-August/index.html" >
   <LINK REL="made" HREF="mailto:ethercatmaster-users%40lists.berlios.de?Subject=Re%3A%20%5BEthercatmaster-users%5D%20RE%20%3A%20Re%3A%20understanding%20the%20datagrams&In-Reply-To=%3Cf68302e30708020137g20fa2530ne312b1a178f80bf%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000225.html">
   <LINK REL="Next"  HREF="000227.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Ethercatmaster-users] RE : Re: understanding the datagrams</H1>
    <B>roland tollenaar</B> 
    <A HREF="mailto:ethercatmaster-users%40lists.berlios.de?Subject=Re%3A%20%5BEthercatmaster-users%5D%20RE%20%3A%20Re%3A%20understanding%20the%20datagrams&In-Reply-To=%3Cf68302e30708020137g20fa2530ne312b1a178f80bf%40mail.gmail.com%3E"
       TITLE="[Ethercatmaster-users] RE : Re: understanding the datagrams">rwatollenaar at gmail.com
       </A><BR>
    <I>Thu Aug  2 10:37:16 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000225.html">[Ethercatmaster-users] RE : Re:  understanding the datagrams
</A></li>
        <LI>Next message: <A HREF="000227.html">[Ethercatmaster-users] connecting the slave over a switch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#226">[ date ]</a>
              <a href="thread.html#226">[ thread ]</a>
              <a href="subject.html#226">[ subject ]</a>
              <a href="author.html#226">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Said,

please let me know as soon as possible what the result is. In the mean time
I am going to figure out how to hack the frames that EML puts on the wire to
try LWR as well. But it is very imoprtant to know how TwinCat behaves in
LRW.

But you have it wrong below!!!  It is already in LRD/LWR you must set it
TO!! LRW.

Roland

On 8/2/07, said harti &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/ethercatmaster-users">harti_said at yahoo.fr</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> We can change the configure of the Twincat from LRW to LRD/LWR
</I>&gt;<i> we choose the specific module (EL2004 for example) :
</I>&gt;<i> Adevanced Setting..&gt;General&gt;Behavior&gt; and we can choose : Use LRD/LWR
</I>&gt;<i> instead of LRW,
</I>&gt;<i>
</I>&gt;<i> I am going to realize the scan...
</I>&gt;<i>
</I>&gt;<i> Said
</I>&gt;<i>
</I>&gt;<i> *Tom Panis &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/ethercatmaster-users">tompanis at skynet.be</A>&gt;* a &#233;crit :
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Roland Tollenaar schreef:
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks for the insight. I had not noticed that. Am I correct in
</I>&gt;<i> &gt; stating that the EML frame has a single telegram all LWR? Its surely
</I>&gt;<i> &gt; getting my digital inputs so there seems to be no problem there. Still
</I>&gt;<i> &gt; the command in the header of the data for the ouputs is different to
</I>&gt;<i> &gt; that in the EML one 0x0b as opposed to 0x0c so are you /sure/ that
</I>&gt;<i> &gt; EML is operating LWR on the outputs? What am I missing?
</I>&gt;<i>
</I>&gt;<i> EML doesn't use a LWR command (= logical write) but a LRW command (=
</I>&gt;<i> logical read write). With this LRW command there can be read from and
</I>&gt;<i> written to the slaves at the same time and using the same telegram.
</I>&gt;<i>
</I>&gt;<i> 0x0b stands for LWR and 0x0c stands for LRW. So because EML uses only
</I>&gt;<i> one telegram, it has to be 0x0c. Twincat splits the read and write
</I>&gt;<i> commands and therefore you'll see 0x0b at a Twincat scan. And I'm pretty
</I>&gt;<i> sure you'll also see 0x0a (LRD) in another frame of the same telegram
</I>&gt;<i> for reading data. An overview of all the Ethercat commands can be found
</I>&gt;<i> in the spec at page 69 ff.
</I>&gt;<i>
</I>&gt;<i> Ps. I'm not 100% sure but I think somewhere in the configuration of
</I>&gt;<i> TwinCAT, you can choose between using LRW commands or LRD and LWR
</I>&gt;<i> commands.
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Roland
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Tom Panis wrote:
</I>&gt;<i> &gt;&gt; Roland Tollenaar wrote:
</I>&gt;<i> &gt;&gt;&gt; Hi Klaas,
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Thanks. The LWR should be fine but its a bit strange that Twincat
</I>&gt;<i> &gt;&gt;&gt; does a logical RD. That would imply that no data is written to the
</I>&gt;<i> &gt;&gt;&gt; slaves but this does not correspond to the outputs being set?
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Ethercat usually sends frames with a couple of telegrams inside.
</I>&gt;<i> &gt;&gt; Looking at the scan Sa&#239;d posted you'll see that there is a LWR
</I>&gt;<i> &gt;&gt; telegram for the analog and digital outputs a LRD for the digital
</I>&gt;<i> &gt;&gt; inputs, a second LRD for the mailbox and a BRD.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Have you received the mail about the watchdog timer? Could you
</I>&gt;<i> &gt;&gt;&gt; advise on how to read/ set this with EML?
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Regards,
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Roland
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Klaas Gadeyne wrote:
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; On Tue, 31 Jul 2007, Roland Tollenaar wrote:
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Hi,
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Please give some assistance wrt to the ethercat dataframes. I am
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; having
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; trouble with the documentation.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; In particular at the moment the EC datagram header is what I am
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; interested in.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; This is what the header looks like.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Cmd /Idx /Addr /Offset /11bit length/R/C/R/M /IRQ
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; TC 0b 00 00 00 01 00 05 80 00 00
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; EML 0c 46 00 00 01 00 05 00 00 00
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Now the questions are:
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Where do I find documentation on the Cmd values that must be used.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Why
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; would EML have a different command? (0xc instead of 0x0b)
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; So it seems you (or EML code, since I don't know _when_ this frame is
</I>&gt;<i> &gt;&gt;&gt;&gt; send)) are performing a logical read-write, while twincat is doing a
</I>&gt;<i> &gt;&gt;&gt;&gt; logical read.
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; The Index Idx has 0x46 instead of 00. Again I have missed (cannot
</I>&gt;<i> for
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; the life of me find it this morning because I think I have seen
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; something about it) the part in the documentation that tells me
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; what the
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; index does. Why will EML have a different value here?
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; AFAIK (please check in the spec) the spec only says that the master
</I>&gt;<i> &gt;&gt;&gt;&gt; should check if the index is unaltered when a message returns, its
</I>&gt;<i> &gt;&gt;&gt;&gt; real value doesn't matter.
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Then we see a difference in the RCRM part of the header. I have no
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; idea
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; what they mean. C is recirculating, M means More datagrams.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; Me neither, I guess that is the module specific data?
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Finally my question is how to establish the lenght out of the 11 bit
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; length. This may be obvious but what confuses me is the part in the
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Ethercat Header (main header not the one in the datagram)
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; This part is
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; TC 0x39 0x10
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; EML 0x11 0x10
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Which I don;t understnad because according to the documentation
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; the last
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; 4 bits indicate the type and 1 should be Ethercat. But neither TC
</I>&gt;<i> nor
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; EML have a 1 in that position? Or is LSB and MSB turned around?
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; I don't understand your question here, but ethercat is little
</I>&gt;<i> &gt;&gt;&gt;&gt; endian IIRC
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; I get a feeling that the differences in this header may be the
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; cause for
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; the problem. It may even be the length which IMHO seems to differ
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; but I
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; am not sure because there is so much info I am lacking.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt;&gt; Ethercatmaster-users mailing list
</I>&gt;<i> &gt;&gt;&gt; <A HREF="https://lists.berlios.de/mailman/listinfo/ethercatmaster-users">Ethercatmaster-users at lists.berlios.de</A>
</I>&gt;<i> &gt;&gt;&gt; <A HREF="https://lists.berlios.de/mailman/listinfo/ethercatmaster-users">https://lists.berlios.de/mailman/listinfo/ethercatmaster-users</A>
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; Ethercatmaster-users mailing list
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.berlios.de/mailman/listinfo/ethercatmaster-users">Ethercatmaster-users at lists.berlios.de</A>
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.berlios.de/mailman/listinfo/ethercatmaster-users">https://lists.berlios.de/mailman/listinfo/ethercatmaster-users</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Ethercatmaster-users mailing list
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/ethercatmaster-users">Ethercatmaster-users at lists.berlios.de</A>
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/ethercatmaster-users">https://lists.berlios.de/mailman/listinfo/ethercatmaster-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i> Ne gardez plus qu'une seule adresse mail ! Copiez vos mails&lt;<A HREF="http://www.trueswitch.com/yahoo-fr/">http://www.trueswitch.com/yahoo-fr/</A>&gt;vers Yahoo! Mail
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Ethercatmaster-users mailing list
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/ethercatmaster-users">Ethercatmaster-users at lists.berlios.de</A>
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/ethercatmaster-users">https://lists.berlios.de/mailman/listinfo/ethercatmaster-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070802/8b3d3ae5/attachment.html">https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070802/8b3d3ae5/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000225.html">[Ethercatmaster-users] RE : Re:  understanding the datagrams
</A></li>
	<LI>Next message: <A HREF="000227.html">[Ethercatmaster-users] connecting the slave over a switch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#226">[ date ]</a>
              <a href="thread.html#226">[ thread ]</a>
              <a href="subject.html#226">[ subject ]</a>
              <a href="author.html#226">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/ethercatmaster-users">More information about the Ethercatmaster-users
mailing list</a><br>
</body></html>
