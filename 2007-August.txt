From rwatollenaar at gmail.com  Wed Aug  1 10:00:06 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Wed, 01 Aug 2007 10:00:06 +0200
Subject: [Ethercatmaster-users] digital output watchdog timeout Was:
	understanding the datagrams
In-Reply-To: <46AF806C.3070206@skynet.be>
References: <46AF1F30.1060907@gmail.com>	<Pine.LNX.4.64.0707311809240.21073@ampere.labo01.fmtc.be>	<46AF62AD.8040009@gmail.com>	<46AF6E4D.3040200@skynet.be>	<46AF720C.4010903@gmail.com>
	<46AF7828.1060508@skynet.be>	<46AF7994.9030003@gmail.com>
	<46AF806C.3070206@skynet.be>
Message-ID: <46B03D86.60303@gmail.com>

Hi Tom,

What setting in the configuration controls the watchdog. I don't recall 
any argument in the Syncman configuration that relates to this. So how 
do you know the watchdog is disabled? Also, there seem to be two 
watchdogs a Process data watchdog and the PDI watchdog. It seems to be 
the PDI watchdog that ETG is referring to that might be the problem. Is 
that the one that is disabled according to you?

Apparently the the disabling is done by setting the PDI WD time to 0. 
Correct?

But finally I must say that the specs state that it is the Process Data 
watchdog only which on a time-out would drive the outputs low. Not the 
PDI watchdog. So it is important to know which watchdog according to you 
is disabled?

Regards,

Roland



Tom Panis wrote:
> Roland Tollenaar wrote:
>> HI,
>>
>> Perfect! explains a lot. thanks. This all really seems to point 
>> towards the watchdog timer. Have you got any idea how I can check/set 
>> that?
> 
> Changing the watchdog time isn't implemented in EML, but feel free to 
> implement it :-).
> 
> I'm not sure if the watchdog is the problem since it's disabled in the 
> configuration you use. Enabling/disabling the watchdog can be done by 
> changing the sixth argument of the EC_SyncMan of the used module
> See 
> https://svn.berlios.de/wsvn/ethercatmaster/trunk/src/dll/ethercat_slave_memory.cxx?op=file&rev=0&sc=0
> 
>> Regards,
>>
>> Roland.
>>
>> Tom Panis wrote:
>>> Roland Tollenaar schreef:
>>>> Hi,
>>>>
>>>> Thanks for the insight. I had not noticed that. Am I correct in 
>>>> stating that the EML frame has a single telegram all LWR? Its surely 
>>>> getting my digital inputs so there seems to be no problem there. 
>>>> Still the command in the header of the data for the ouputs is 
>>>> different to that in the EML one  0x0b as opposed to 0x0c so are you 
>>>> /sure/ that EML is operating LWR on the outputs? What am I missing?
>>> EML doesn't use a LWR command (= logical write) but a LRW command (= 
>>> logical read write). With this LRW command there can be read from and 
>>> written to the slaves at the same time and using the same telegram.
>>>
>>> 0x0b stands for LWR and 0x0c stands for LRW.  So because EML uses 
>>> only one telegram, it has to be 0x0c. Twincat splits the read and 
>>> write commands and therefore you'll see 0x0b at a Twincat scan. And 
>>> I'm pretty sure you'll also see 0x0a (LRD) in another frame of the 
>>> same telegram for reading data. An overview of all the Ethercat 
>>> commands can be found in the spec at page 69 ff.
>>>
>>> Ps. I'm not 100% sure but I think somewhere in the configuration of 
>>> TwinCAT, you can choose between using LRW commands or LRD and LWR 
>>> commands.
>>>
>>>> Roland
>>>>
>>>> Tom Panis wrote:
>>>>> Roland Tollenaar wrote:
>>>>>> Hi Klaas,
>>>>>>
>>>>>> Thanks. The LWR should be fine but its a bit strange that Twincat 
>>>>>> does a logical RD. That would imply that no data is written to the 
>>>>>> slaves but this does not correspond to the outputs being set?
>>>>>>   
>>>>> Ethercat usually sends frames with a couple of telegrams inside. 
>>>>> Looking at the scan Sa?d posted you'll see that there is a LWR 
>>>>> telegram for the analog and digital outputs a LRD for the digital 
>>>>> inputs, a second LRD for the mailbox and a BRD.
>>>>>
>>>>>
>>>>>> Have you received the mail about the watchdog timer? Could you 
>>>>>> advise on how to read/ set this with EML?
>>>>>>
>>>>>> Regards,
>>>>>>
>>>>>> Roland
>>>>>>
>>>>>> Klaas Gadeyne wrote:
>>>>>>  
>>>>>>> On Tue, 31 Jul 2007, Roland Tollenaar wrote:
>>>>>>>   
>>>>>>>> Hi,
>>>>>>>>
>>>>>>>> Please give some assistance wrt to the ethercat dataframes. I am 
>>>>>>>> having
>>>>>>>> trouble with the documentation.
>>>>>>>>
>>>>>>>> In particular at the moment the EC datagram header is what I am
>>>>>>>> interested in.
>>>>>>>>
>>>>>>>> This is what the header looks like.
>>>>>>>>
>>>>>>>>    Cmd    /Idx    /Addr    /Offset    /11bit length/R/C/R/M    /IRQ
>>>>>>>> TC  0b    00    00 00    01 00    05 80            00 00
>>>>>>>> EML 0c    46    00 00    01 00    05 00            00 00
>>>>>>>>
>>>>>>>> Now the questions are:
>>>>>>>>
>>>>>>>> Where do I find documentation on the Cmd values that must be 
>>>>>>>> used. Why
>>>>>>>> would EML have a different command? (0xc instead of 0x0b)
>>>>>>>>       
>>>>>>> <https://svn.berlios.de/wsvn/ethercatmaster/trunk/src/dll/ethercat_device_addressed_telegram.cxx?op=file&rev=0&sc=0> 
>>>>>>>
>>>>>>> <https://svn.berlios.de/wsvn/ethercatmaster/trunk/src/dll/ethercat_logical_addressed_telegram.cxx?op=file&rev=0&sc=0> 
>>>>>>>
>>>>>>>
>>>>>>> So it seems you (or EML code, since I don't know _when_ this 
>>>>>>> frame is
>>>>>>> send)) are performing a logical read-write, while twincat is doing a
>>>>>>> logical read.
>>>>>>>
>>>>>>>   
>>>>>>>> The Index Idx has 0x46 instead of 00. Again I have missed 
>>>>>>>> (cannot for
>>>>>>>> the life of me find it this morning because I think I have seen
>>>>>>>> something about it) the part in the documentation that tells me 
>>>>>>>> what the
>>>>>>>> index does. Why will EML have a different value here?
>>>>>>>>       
>>>>>>> AFAIK (please check in the spec) the spec only says that the master
>>>>>>> should check if the index is unaltered when a message returns, its
>>>>>>> real value doesn't matter.
>>>>>>>
>>>>>>>   
>>>>>>>> Then we see a difference in the RCRM part of the header. I have 
>>>>>>>> no idea
>>>>>>>> what they mean. C is recirculating, M means More datagrams.
>>>>>>>>       
>>>>>>> Me neither, I guess that is the module specific data?
>>>>>>>
>>>>>>>   
>>>>>>>> Finally my question is how to establish the lenght out of the 11 
>>>>>>>> bit
>>>>>>>> length. This may be obvious but what confuses me is the part in the
>>>>>>>> Ethercat Header (main header not the one in the datagram)
>>>>>>>>
>>>>>>>> This part is
>>>>>>>> TC   0x39 0x10
>>>>>>>> EML  0x11 0x10
>>>>>>>>
>>>>>>>> Which I don;t understnad because according to the documentation 
>>>>>>>> the last
>>>>>>>> 4 bits indicate the type and 1 should be Ethercat. But neither 
>>>>>>>> TC nor
>>>>>>>> EML have a 1 in that position? Or is LSB and MSB turned around?
>>>>>>>>       
>>>>>>> I don't understand your question here, but ethercat is little 
>>>>>>> endian IIRC
>>>>>>>
>>>>>>>   
>>>>>>>> I get a feeling that the differences in this header may be the 
>>>>>>>> cause for
>>>>>>>> the problem. It may even be the length which IMHO seems to 
>>>>>>>> differ but I
>>>>>>>> am not sure because there is so much info I am lacking.
>>>>>>>>       
>>>>>>>     
>>>>>> _______________________________________________
>>>>>> Ethercatmaster-users mailing list
>>>>>> Ethercatmaster-users at lists.berlios.de
>>>>>> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>>>>>>
>>>>>>   
>>>>> _______________________________________________
>>>>> Ethercatmaster-users mailing list
>>>>> Ethercatmaster-users at lists.berlios.de
>>>>> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>>>>>
>>> _______________________________________________
>>> Ethercatmaster-users mailing list
>>> Ethercatmaster-users at lists.berlios.de
>>> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>>>
> _______________________________________________
> Ethercatmaster-users mailing list
> Ethercatmaster-users at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
> 


From harti_said at yahoo.fr  Thu Aug  2 09:05:01 2007
From: harti_said at yahoo.fr (said harti)
Date: Thu, 2 Aug 2007 09:05:01 +0200 (CEST)
Subject: [Ethercatmaster-users] RE : Re:  understanding the datagrams
In-Reply-To: <46AF7828.1060508@skynet.be>
Message-ID: <393668.63523.qm@web37306.mail.mud.yahoo.com>

Hi,

We can change the configure of the Twincat from LRW to LRD/LWR 
we choose the specific module (EL2004 for example) :
Adevanced Setting..>General>Behavior> and we can choose : Use LRD/LWR instead of LRW, 

I am going to realize the scan...

Said

Tom Panis <tompanis at skynet.be> a ?crit : 
Roland Tollenaar schreef:
> Hi,
>
> Thanks for the insight. I had not noticed that. Am I correct in 
> stating that the EML frame has a single telegram all LWR? Its surely 
> getting my digital inputs so there seems to be no problem there. Still 
> the command in the header of the data for the ouputs is different to 
> that in the EML one  0x0b as opposed to 0x0c so are you /sure/ that 
> EML is operating LWR on the outputs? What am I missing?

EML doesn't use a LWR command (= logical write) but a LRW command (= 
logical read write). With this LRW command there can be read from and 
written to the slaves at the same time and using the same telegram.

0x0b stands for LWR and 0x0c stands for LRW.  So because EML uses only 
one telegram, it has to be 0x0c. Twincat splits the read and write 
commands and therefore you'll see 0x0b at a Twincat scan. And I'm pretty 
sure you'll also see 0x0a (LRD) in another frame of the same telegram 
for reading data. An overview of all the Ethercat commands can be found 
in the spec at page 69 ff.

Ps. I'm not 100% sure but I think somewhere in the configuration of 
TwinCAT, you can choose between using LRW commands or LRD and LWR commands.

>
> Roland
>
> Tom Panis wrote:
>> Roland Tollenaar wrote:
>>> Hi Klaas,
>>>
>>> Thanks. The LWR should be fine but its a bit strange that Twincat 
>>> does a logical RD. That would imply that no data is written to the 
>>> slaves but this does not correspond to the outputs being set?
>>>   
>>
>> Ethercat usually sends frames with a couple of telegrams inside. 
>> Looking at the scan Sa?d posted you'll see that there is a LWR 
>> telegram for the analog and digital outputs a LRD for the digital 
>> inputs, a second LRD for the mailbox and a BRD.
>>
>>
>>> Have you received the mail about the watchdog timer? Could you 
>>> advise on how to read/ set this with EML?
>>>
>>> Regards,
>>>
>>> Roland
>>>
>>> Klaas Gadeyne wrote:
>>>  
>>>> On Tue, 31 Jul 2007, Roland Tollenaar wrote:
>>>>    
>>>>> Hi,
>>>>>
>>>>> Please give some assistance wrt to the ethercat dataframes. I am 
>>>>> having
>>>>> trouble with the documentation.
>>>>>
>>>>> In particular at the moment the EC datagram header is what I am
>>>>> interested in.
>>>>>
>>>>> This is what the header looks like.
>>>>>
>>>>>    Cmd    /Idx    /Addr    /Offset    /11bit length/R/C/R/M    /IRQ
>>>>> TC  0b    00    00 00    01 00    05 80            00 00
>>>>> EML 0c    46    00 00    01 00    05 00            00 00
>>>>>
>>>>> Now the questions are:
>>>>>
>>>>> Where do I find documentation on the Cmd values that must be used. 
>>>>> Why
>>>>> would EML have a different command? (0xc instead of 0x0b)
>>>>>       
>>>>  
>>>>
>>>>  
>>>>
>>>>
>>>> So it seems you (or EML code, since I don't know _when_ this frame is
>>>> send)) are performing a logical read-write, while twincat is doing a
>>>> logical read.
>>>>
>>>>    
>>>>> The Index Idx has 0x46 instead of 00. Again I have missed (cannot for
>>>>> the life of me find it this morning because I think I have seen
>>>>> something about it) the part in the documentation that tells me 
>>>>> what the
>>>>> index does. Why will EML have a different value here?
>>>>>       
>>>> AFAIK (please check in the spec) the spec only says that the master
>>>> should check if the index is unaltered when a message returns, its
>>>> real value doesn't matter.
>>>>
>>>>    
>>>>> Then we see a difference in the RCRM part of the header. I have no 
>>>>> idea
>>>>> what they mean. C is recirculating, M means More datagrams.
>>>>>       
>>>> Me neither, I guess that is the module specific data?
>>>>
>>>>    
>>>>> Finally my question is how to establish the lenght out of the 11 bit
>>>>> length. This may be obvious but what confuses me is the part in the
>>>>> Ethercat Header (main header not the one in the datagram)
>>>>>
>>>>> This part is
>>>>> TC   0x39 0x10
>>>>> EML  0x11 0x10
>>>>>
>>>>> Which I don;t understnad because according to the documentation 
>>>>> the last
>>>>> 4 bits indicate the type and 1 should be Ethercat. But neither TC nor
>>>>> EML have a 1 in that position? Or is LSB and MSB turned around?
>>>>>       
>>>> I don't understand your question here, but ethercat is little 
>>>> endian IIRC
>>>>
>>>>    
>>>>> I get a feeling that the differences in this header may be the 
>>>>> cause for
>>>>> the problem. It may even be the length which IMHO seems to differ 
>>>>> but I
>>>>> am not sure because there is so much info I am lacking.
>>>>>       
>>>>     
>>> _______________________________________________
>>> Ethercatmaster-users mailing list
>>> Ethercatmaster-users at lists.berlios.de
>>> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>>>
>>>   
>> _______________________________________________
>> Ethercatmaster-users mailing list
>> Ethercatmaster-users at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>>
>
_______________________________________________
Ethercatmaster-users mailing list
Ethercatmaster-users at lists.berlios.de
https://lists.berlios.de/mailman/listinfo/ethercatmaster-users


       
---------------------------------
 Ne gardez plus qu'une seule adresse mail ! Copiez vos mails vers Yahoo! Mail 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070802/ae3a6feb/attachment.html>

From rwatollenaar at gmail.com  Thu Aug  2 10:37:16 2007
From: rwatollenaar at gmail.com (roland tollenaar)
Date: Thu, 2 Aug 2007 10:37:16 +0200
Subject: [Ethercatmaster-users] RE : Re: understanding the datagrams
In-Reply-To: <393668.63523.qm@web37306.mail.mud.yahoo.com>
References: <46AF7828.1060508@skynet.be>
	<393668.63523.qm@web37306.mail.mud.yahoo.com>
Message-ID: <f68302e30708020137g20fa2530ne312b1a178f80bf@mail.gmail.com>

Hi Said,

please let me know as soon as possible what the result is. In the mean time
I am going to figure out how to hack the frames that EML puts on the wire to
try LWR as well. But it is very imoprtant to know how TwinCat behaves in
LRW.

But you have it wrong below!!!  It is already in LRD/LWR you must set it
TO!! LRW.

Roland

On 8/2/07, said harti <harti_said at yahoo.fr> wrote:
>
> Hi,
>
> We can change the configure of the Twincat from LRW to LRD/LWR
> we choose the specific module (EL2004 for example) :
> Adevanced Setting..>General>Behavior> and we can choose : Use LRD/LWR
> instead of LRW,
>
> I am going to realize the scan...
>
> Said
>
> *Tom Panis <tompanis at skynet.be>* a ?crit :
>
>
> Roland Tollenaar schreef:
> > Hi,
> >
> > Thanks for the insight. I had not noticed that. Am I correct in
> > stating that the EML frame has a single telegram all LWR? Its surely
> > getting my digital inputs so there seems to be no problem there. Still
> > the command in the header of the data for the ouputs is different to
> > that in the EML one 0x0b as opposed to 0x0c so are you /sure/ that
> > EML is operating LWR on the outputs? What am I missing?
>
> EML doesn't use a LWR command (= logical write) but a LRW command (=
> logical read write). With this LRW command there can be read from and
> written to the slaves at the same time and using the same telegram.
>
> 0x0b stands for LWR and 0x0c stands for LRW. So because EML uses only
> one telegram, it has to be 0x0c. Twincat splits the read and write
> commands and therefore you'll see 0x0b at a Twincat scan. And I'm pretty
> sure you'll also see 0x0a (LRD) in another frame of the same telegram
> for reading data. An overview of all the Ethercat commands can be found
> in the spec at page 69 ff.
>
> Ps. I'm not 100% sure but I think somewhere in the configuration of
> TwinCAT, you can choose between using LRW commands or LRD and LWR
> commands.
>
> >
> > Roland
> >
> > Tom Panis wrote:
> >> Roland Tollenaar wrote:
> >>> Hi Klaas,
> >>>
> >>> Thanks. The LWR should be fine but its a bit strange that Twincat
> >>> does a logical RD. That would imply that no data is written to the
> >>> slaves but this does not correspond to the outputs being set?
> >>>
> >>
> >> Ethercat usually sends frames with a couple of telegrams inside.
> >> Looking at the scan Sa?d posted you'll see that there is a LWR
> >> telegram for the analog and digital outputs a LRD for the digital
> >> inputs, a second LRD for the mailbox and a BRD.
> >>
> >>
> >>> Have you received the mail about the watchdog timer? Could you
> >>> advise on how to read/ set this with EML?
> >>>
> >>> Regards,
> >>>
> >>> Roland
> >>>
> >>> Klaas Gadeyne wrote:
> >>>
> >>>> On Tue, 31 Jul 2007, Roland Tollenaar wrote:
> >>>>
> >>>>> Hi,
> >>>>>
> >>>>> Please give some assistance wrt to the ethercat dataframes. I am
> >>>>> having
> >>>>> trouble with the documentation.
> >>>>>
> >>>>> In particular at the moment the EC datagram header is what I am
> >>>>> interested in.
> >>>>>
> >>>>> This is what the header looks like.
> >>>>>
> >>>>> Cmd /Idx /Addr /Offset /11bit length/R/C/R/M /IRQ
> >>>>> TC 0b 00 00 00 01 00 05 80 00 00
> >>>>> EML 0c 46 00 00 01 00 05 00 00 00
> >>>>>
> >>>>> Now the questions are:
> >>>>>
> >>>>> Where do I find documentation on the Cmd values that must be used.
> >>>>> Why
> >>>>> would EML have a different command? (0xc instead of 0x0b)
> >>>>>
> >>>>
> >>>>
> >>>>
> >>>>
> >>>>
> >>>> So it seems you (or EML code, since I don't know _when_ this frame is
> >>>> send)) are performing a logical read-write, while twincat is doing a
> >>>> logical read.
> >>>>
> >>>>
> >>>>> The Index Idx has 0x46 instead of 00. Again I have missed (cannot
> for
> >>>>> the life of me find it this morning because I think I have seen
> >>>>> something about it) the part in the documentation that tells me
> >>>>> what the
> >>>>> index does. Why will EML have a different value here?
> >>>>>
> >>>> AFAIK (please check in the spec) the spec only says that the master
> >>>> should check if the index is unaltered when a message returns, its
> >>>> real value doesn't matter.
> >>>>
> >>>>
> >>>>> Then we see a difference in the RCRM part of the header. I have no
> >>>>> idea
> >>>>> what they mean. C is recirculating, M means More datagrams.
> >>>>>
> >>>> Me neither, I guess that is the module specific data?
> >>>>
> >>>>
> >>>>> Finally my question is how to establish the lenght out of the 11 bit
> >>>>> length. This may be obvious but what confuses me is the part in the
> >>>>> Ethercat Header (main header not the one in the datagram)
> >>>>>
> >>>>> This part is
> >>>>> TC 0x39 0x10
> >>>>> EML 0x11 0x10
> >>>>>
> >>>>> Which I don;t understnad because according to the documentation
> >>>>> the last
> >>>>> 4 bits indicate the type and 1 should be Ethercat. But neither TC
> nor
> >>>>> EML have a 1 in that position? Or is LSB and MSB turned around?
> >>>>>
> >>>> I don't understand your question here, but ethercat is little
> >>>> endian IIRC
> >>>>
> >>>>
> >>>>> I get a feeling that the differences in this header may be the
> >>>>> cause for
> >>>>> the problem. It may even be the length which IMHO seems to differ
> >>>>> but I
> >>>>> am not sure because there is so much info I am lacking.
> >>>>>
> >>>>
> >>> _______________________________________________
> >>> Ethercatmaster-users mailing list
> >>> Ethercatmaster-users at lists.berlios.de
> >>> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
> >>>
> >>>
> >> _______________________________________________
> >> Ethercatmaster-users mailing list
> >> Ethercatmaster-users at lists.berlios.de
> >> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
> >>
> >
> _______________________________________________
> Ethercatmaster-users mailing list
> Ethercatmaster-users at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>
>
> ------------------------------
> Ne gardez plus qu'une seule adresse mail ! Copiez vos mails<http://www.trueswitch.com/yahoo-fr/>vers Yahoo! Mail
>
>
> _______________________________________________
> Ethercatmaster-users mailing list
> Ethercatmaster-users at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070802/8b3d3ae5/attachment.html>

From rolandtollenaar at gmail.com  Thu Aug  2 12:17:57 2007
From: rolandtollenaar at gmail.com (roland Tollenaar)
Date: Thu, 2 Aug 2007 10:17:57 +0000
Subject: [Ethercatmaster-users] connecting the slave over a switch
Message-ID: <bc4264770708020317v7353044bn5469a09ecec0331c@mail.gmail.com>

Hi,

I now have a client which happily runs wireshark. I can see the
communication attempt between my EML master and the slave ( think I
can even see the slave responding) but the master_test fails to
perform as it does when i only have a direct link between the master
and the slave. Somewhere the switch is doing something not so nice
witht he packets. Below is the master_test output and the scan is
attached. can anyone possibly make out what i am doing wrong?

Regards,

Roland.


root at slax:/mnt/appusb/Packages/eml/modtrunk/build-rtnet/tests/rtnet#
./master_test rteth0
Socket created: socket id: 896
Got interface: index: 0
Attach netif

Master initializing

EtherCAT AL: Ring contains 10 slaves
EEPROM busy
EEPROM busy
AL creating SlaveHandler: pos=0, adr=0x3e9, Prod. Code=0x44c2c52, rev=0x10000
EEPROM busy
EEPROM busy
EtherCAT_SlaveDb: No such Config, returning NULL!
EC_AL Warning: No such slave in db, creating dummy slave
AL creating SlaveHandler: pos=1, Product Code=0x3f63052, rev=0x100000
EEPROM busy
EEPROM busy
EtherCAT_SlaveDb: No such Config, returning NULL!
EC_AL Warning: No such slave in db, creating dummy slave
AL creating SlaveHandler: pos=2, Product Code=0x3f63052, rev=0x100000
EEPROM busy
EEPROM busy
EtherCAT_SlaveDb: No such Config, returning NULL!
EC_AL Warning: No such slave in db, creating dummy slave
AL creating SlaveHandler: pos=3, Product Code=0x3f63052, rev=0x100000
EEPROM busy
EEPROM busy
EtherCAT_SlaveDb: No such Config, returning NULL!
EC_AL Warning: No such slave in db, creating dummy slave
AL creating SlaveHandler: pos=4, Product Code=0x3f63052, rev=0x100000
EEPROM busy
EEPROM busy
EtherCAT_SlaveDb: No such Config, returning NULL!
EC_AL Warning: No such slave in db, creating dummy slave
AL creating SlaveHandler: pos=5, Product Code=0x10243052, rev=0x0
EEPROM busy
EEPROM busy
AL creating SlaveHandler: pos=6, adr=0x3ec, Prod. Code=0x7d43052, rev=0x100000
EEPROM busy
EEPROM busy
EtherCAT_SlaveDb: No such Config, returning NULL!
EC_AL Warning: No such slave in db, creating dummy slave
AL creating SlaveHandler: pos=7, Product Code=0x7d43052, rev=0x100000
EEPROM busy
EEPROM busy
EtherCAT_SlaveDb: No such Config, returning NULL!
EC_AL Warning: No such slave in db, creating dummy slave
AL creating SlaveHandler: pos=8, Product Code=0x7d43052, rev=0x100000
EEPROM busy
EEPROM busy
EtherCAT_SlaveDb: No such Config, returning NULL!
EC_AL Warning: No such slave in db, creating dummy slave
AL creating SlaveHandler: pos=9, Product Code=0x7d43052, rev=0x100000
AL: resetting FMMUs
AL: resetting SMs
EC_Telegram::check_index(): Index field does not correspond with received data
low_level_input: framebuilding failed!
AL: Setting all slaves in init mode
building frame: checkheader failed
low_level_input: framebuilding failed!
master_test: /mnt/appusb/Packages/eml/trunk/src/dll/ethercat_device_addressed_telegram.cxx:110:
virtual const unsigned char* APRD_Telegram::build_command_field(const
unsigned char*): Assertion `a_buffer[0] == APRD' failed.
Aborted
-------------- next part --------------
A non-text attachment was scrubbed...
Name: eml_over_switch.pcap
Type: application/octet-stream
Size: 14880 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070802/9c5e6ac6/attachment.obj>

From harti_said at yahoo.fr  Thu Aug  2 14:18:08 2007
From: harti_said at yahoo.fr (said harti)
Date: Thu, 2 Aug 2007 14:18:08 +0200 (CEST)
Subject: [Ethercatmaster-users] RE : Re: RE : Re: understanding the datagrams
In-Reply-To: <f68302e30708020425m593713d4pc502d126d7ef92ae@mail.gmail.com>
Message-ID: <702616.86900.qm@web37301.mail.mud.yahoo.com>

Hi Rolland, sorry, i had some problem demo vesion with TwinCAT tools, which i have reolved....

So, when i active the option : Use LRD/LWR instead of LRW, there is no change, i got 0x0b on Cmd

and i don't fund the option which allow me to set the conifg on : LRW

If you have other suggestion, let me know, ...

Said

roland tollenaar <rwatollenaar at gmail.com> a ?crit : Hi Said,

Are you still around? Have you had any luck with twincat in LRW mode?

Regards,

Roland

On 8/2/07, roland tollenaar < rwatollenaar at gmail.com> wrote:Hi Said,

please let me know as soon as possible what the result is. In the mean time I am going to figure out how to hack the frames that EML puts on the wire to try LWR as well. But it is very imoprtant to know how TwinCat behaves in LRW. 

But you have it wrong below!!!  It is already in LRD/LWR you must set it TO!! LRW.

Roland

On 8/2/07,  said harti < harti_said at yahoo.fr> wrote:Hi,

We can change the configure of the Twincat from LRW to LRD/LWR  
we choose the specific module (EL2004 for example) :
Adevanced Setting..>General>Behavior> and we can choose : Use LRD/LWR instead of LRW, 

I am going to realize the scan...

Said

  Tom Panis <tompanis at skynet.be> a ?crit :   
Roland Tollenaar schreef:
> Hi,
>
> Thanks for the insight. I had not noticed that. Am I correct in 
> stating that the EML frame has a single telegram all LWR? Its surely  
> getting my digital inputs so there seems to be no problem there. Still 
> the command in the header of the data for the ouputs is different to 
> that in the EML one  0x0b as opposed to 0x0c so are you /sure/ that  
> EML is operating LWR on the outputs? What am I missing?

EML doesn't  use a LWR command (= logical write) but a LRW command (= 
logical read write). With this LRW command there can be read from and 
written to the slaves at the same time and using the same telegram.

0x0b stands for LWR and 0x0c stands for LRW.  So because EML uses only  
one telegram, it has to be 0x0c. Twincat splits the read and write 
commands and therefore you'll see 0x0b at a Twincat scan. And I'm pretty 
sure you'll also see 0x0a (LRD) in another frame of the same telegram  
for reading data. An overview of all the Ethercat commands can be found 
in the spec at page 69 ff.

Ps. I'm not 100% sure but I think somewhere in the configuration of 
TwinCAT, you can choose between using LRW commands or LRD and LWR commands. 

>
> Roland
>
> Tom Panis wrote:
>> Roland Tollenaar wrote:
>>> Hi Klaas,
>>>
>>> Thanks. The LWR should be fine but its a bit strange that Twincat  
>>> does a logical RD. That would imply that no data is written to the 
>>> slaves but this does not correspond to the outputs being set?
>>>   
>>
>> Ethercat usually sends frames with a couple of telegrams inside.  
>> Looking at the scan Sa?d posted you'll see that there is a LWR 
>> telegram for the analog and digital outputs a LRD for the digital 
>> inputs, a second LRD for the mailbox and a BRD.
  >>
>>
>>> Have you received the mail about the watchdog timer? Could you 
>>> advise on how to read/ set this with EML?
>>>
>>> Regards,
>>>
>>> Roland 
>>>
>>> Klaas Gadeyne wrote:
>>>  
>>>> On Tue, 31 Jul 2007, Roland Tollenaar wrote:
>>>>    
>>>>> Hi,
>>>>>
>>>>> Please give some  assistance wrt to the ethercat dataframes. I am 
>>>>> having
>>>>> trouble with the documentation.
>>>>>
>>>>> In particular at the moment the EC datagram header is what I am 
>>>>> interested in.
>>>>>
>>>>> This is what the header looks like.
>>>>>
>>>>>    Cmd    /Idx    /Addr    /Offset    /11bit length/R/C/R/M    /IRQ 
>>>>> TC  0b    00    00 00    01 00    05 80            00 00
>>>>> EML 0c    46    00 00    01 00    05 00            00 00
>>>>>
>>>>> Now the questions are: 
>>>>>
>>>>> Where do I find documentation on the Cmd values that must be used. 
>>>>> Why
>>>>> would EML have a different command? (0xc instead of 0x0b) 
>>>>>        
>>>>  
>>>>
>>>>  
>>>>
>>>>

>>>> So it seems you (or EML code, since I don't know _when_ this frame is 
>>>> send)) are performing a logical read-write, while twincat is doing a
>>>> logical read.
>>>>
>>>>    
>>>>> The Index Idx has 0x46 instead of 00. Again I have missed (cannot for 
>>>>> the life of me find it this morning because I think I have seen
>>>>> something about it) the part in the documentation that tells me 
>>>>> what the
>>>>> index  does. Why will EML have a different value here?
>>>>>       
>>>> AFAIK (please check in the spec) the spec only says that the master
>>>> should check if the index is unaltered when a message returns, its 
>>>> real value doesn't matter.
>>>>
>>>>    
>>>>> Then we see a difference in the RCRM part of the header. I have no 
>>>>> idea
 >>>>> what they mean. C is recirculating, M means More datagrams. 
>>>>>       
>>>> Me neither, I guess that is the module specific data?
>>>>
>>>>    
>>>>> Finally my question is how to establish the lenght out of the 11 bit 
>>>>> length. This may be obvious but what confuses me is the part in the
>>>>> Ethercat Header (main header not the one in the  datagram)
>>>>>
>>>>> This part is
>>>>> TC   0x39 0x10
>>>>> EML  0x11 0x10
>>>>>
>>>>> Which I don;t understnad because according to the documentation  
>>>>> the last
>>>>> 4 bits indicate the type and 1 should be Ethercat. But neither TC nor
>>>>> EML have a 1 in that position? Or is LSB and MSB turned around?
>>>>>        
>>>> I don't understand your question here, but ethercat is little 
>>>> endian IIRC
>>>>
>>>>    
>>>>> I get a feeling that the differences in this header may be the  
>>>>> cause for
>>>>> the problem. It may even be the length which IMHO seems to differ 
>>>>> but I
>>>>> am not sure because there is so much info I am  lacking.
>>>>>       
>>>>     
>>> _______________________________________________
>>> Ethercatmaster-users mailing list
>>>   Ethercatmaster-users at lists.berlios.de
>>> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users 
>>>
>>>   
>> _______________________________________________
>> Ethercatmaster-users mailing list
>>   Ethercatmaster-users at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users 
>>
>
_______________________________________________
Ethercatmaster-users mailing list
  Ethercatmaster-users at lists.berlios.de
https://lists.berlios.de/mailman/listinfo/ethercatmaster-users 


           

---------------------------------
  Ne gardez plus qu'une seule adresse mail ! Copiez vos mails vers Yahoo! Mail 

  _______________________________________________
Ethercatmaster-users mailing list
Ethercatmaster-users at lists.berlios.de 
https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
  


 


 

       
---------------------------------
 Stockage illimit? de vos mails avec Yahoo! Mail. Changez aujourd'hui de mail !
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070802/713b039b/attachment.html>

From klaas.gadeyne at fmtc.be  Thu Aug  2 17:44:21 2007
From: klaas.gadeyne at fmtc.be (Klaas Gadeyne)
Date: Thu, 2 Aug 2007 17:44:21 +0200 (CEST)
Subject: [Ethercatmaster-users] digital output watchdog timeout Was:
 understanding the datagrams
In-Reply-To: <46B03D86.60303@gmail.com>
References: <46AF1F30.1060907@gmail.com>
	<Pine.LNX.4.64.0707311809240.21073@ampere.labo01.fmtc.be>
	<46AF62AD.8040009@gmail.com> <46AF6E4D.3040200@skynet.be>
	<46AF720C.4010903@gmail.com>
	<46AF7828.1060508@skynet.be> <46AF7994.9030003@gmail.com>
	<46AF806C.3070206@skynet.be> <46B03D86.60303@gmail.com>
Message-ID: <Pine.LNX.4.64.0708021742240.3918@ampere.labo01.fmtc.be>

On Wed, 1 Aug 2007, Roland Tollenaar wrote:
> What setting in the configuration controls the watchdog. I don't recall
> any argument in the Syncman configuration that relates to this. So how
> do you know the watchdog is disabled? Also, there seem to be two
> watchdogs a Process data watchdog and the PDI watchdog. It seems to be
> the PDI watchdog that ETG is referring to that might be the problem. Is
> that the one that is disabled according to you?
>
> Apparently the the disabling is done by setting the PDI WD time to 0.
> Correct?
>
> But finally I must say that the specs state that it is the Process Data
> watchdog only which on a time-out would drive the outputs low. Not the
> PDI watchdog. So it is important to know which watchdog according to you
> is disabled?

Given the fact that your program _continuously_ sends ethercat messages
(it was a plain while loop, not in a separate thread, right?), a
watchdog timeout seems to be very unlikely to me.  Or do I miss
something here?

Klaas


From klaas.gadeyne at fmtc.be  Thu Aug  2 17:51:44 2007
From: klaas.gadeyne at fmtc.be (Klaas Gadeyne)
Date: Thu, 2 Aug 2007 17:51:44 +0200 (CEST)
Subject: [Ethercatmaster-users] connecting the slave over a switch
In-Reply-To: <bc4264770708020317v7353044bn5469a09ecec0331c@mail.gmail.com>
References: <bc4264770708020317v7353044bn5469a09ecec0331c@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0708021744380.3918@ampere.labo01.fmtc.be>

On Thu, 2 Aug 2007, roland Tollenaar wrote:
> I now have a client which happily runs wireshark. I can see the
> communication attempt between my EML master and the slave ( think I
> can even see the slave responding) but the master_test fails to
> perform as it does when i only have a direct link between the master
> and the slave. Somewhere the switch is doing something not so nice
> witht he packets. Below is the master_test output and the scan is
> attached. can anyone possibly make out what i am doing wrong?

> root at slax:/mnt/appusb/Packages/eml/modtrunk/build-rtnet/tests/rtnet#
> ./master_test rteth0
> Socket created: socket id: 896
> Got interface: index: 0
> Attach netif
>
> Master initializing
>
[...]
> AL: resetting SMs
> EC_Telegram::check_index(): Index field does not correspond with received data
> low_level_input: framebuilding failed!
> AL: Setting all slaves in init mode
> building frame: checkheader failed
> low_level_input: framebuilding failed!
> master_test: /mnt/appusb/Packages/eml/trunk/src/dll/ethercat_device_addressed_telegram.cxx:110:
> virtual const unsigned char* APRD_Telegram::build_command_field(const
> unsigned char*): Assertion `a_buffer[0] == APRD' failed.
> Aborted

I can hardly imagine the switch would alter ethernet data.  Did you
try with different switches.

[wild guess]
I don't know/recall if Tom's implementation uses locks to prevent sending a
new message before the new one is back (or a time-out occurred).

If it is not the case, I presume you might have hit some EML bug here due to
the fact that the switch adds some extra (HW) latency to the message
transmission time and something fishy happens.

Are you still using the while loop for sending?  If so, what happens
if you send the ethercat messages in a separate thread with a
frequency of say, 1KHz?
[/wild guess]

You might find debugging information in the wireshark scan too:
remember that the slaves should leave the index field unaltered...

Klaas


From rwatollenaar at gmail.com  Fri Aug  3 09:06:13 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Fri, 03 Aug 2007 09:06:13 +0200
Subject: [Ethercatmaster-users] digital output watchdog timeout Was:
 understanding the datagrams
In-Reply-To: <Pine.LNX.4.64.0708021742240.3918@ampere.labo01.fmtc.be>
References: <46AF1F30.1060907@gmail.com>
	<Pine.LNX.4.64.0707311809240.21073@ampere.labo01.fmtc.be>
	<46AF62AD.8040009@gmail.com> <46AF6E4D.3040200@skynet.be>
	<46AF720C.4010903@gmail.com> <46AF7828.1060508@skynet.be>
	<46AF7994.9030003@gmail.com> <46AF806C.3070206@skynet.be>
	<46B03D86.60303@gmail.com>
	<Pine.LNX.4.64.0708021742240.3918@ampere.labo01.fmtc.be>
Message-ID: <46B2D3E5.9090603@gmail.com>

Hi Klaas

> Given the fact that your program _continuously_ sends ethercat messages
> (it was a plain while loop, not in a separate thread, right?), a
> watchdog timeout seems to be very unlikely to me.  Or do I miss
> something here?

I tend to agree.

RR


> 
> Klaas
> 


From rwatollenaar at gmail.com  Fri Aug  3 09:14:24 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Fri, 03 Aug 2007 09:14:24 +0200
Subject: [Ethercatmaster-users] connecting the slave over a switch
In-Reply-To: <Pine.LNX.4.64.0708021744380.3918@ampere.labo01.fmtc.be>
References: <bc4264770708020317v7353044bn5469a09ecec0331c@mail.gmail.com>
	<Pine.LNX.4.64.0708021744380.3918@ampere.labo01.fmtc.be>
Message-ID: <46B2D5D0.2010001@gmail.com>

Hi



> [...]
>> AL: resetting SMs
>> EC_Telegram::check_index(): Index field does not correspond with 
>> received data
>> low_level_input: framebuilding failed!
>> AL: Setting all slaves in init mode
>> building frame: checkheader failed
>> low_level_input: framebuilding failed!
>> master_test: 
>> /mnt/appusb/Packages/eml/trunk/src/dll/ethercat_device_addressed_telegram.cxx:110: 
>>
>> virtual const unsigned char* APRD_Telegram::build_command_field(const
>> unsigned char*): Assertion `a_buffer[0] == APRD' failed.
>> Aborted
> 
> I can hardly imagine the switch would alter ethernet data.  Did you
> try with different switches.
Yes, same problem. Moreover there is no problem over the switch when 
using Twincat to connect and communicate.

> 
> [wild guess]
> I don't know/recall if Tom's implementation uses locks to prevent sending a
> new message before the new one is back (or a time-out occurred).
Could be something like this. I know that my frames are a lot longer 
than anything anyone else has ever tried. from what I can gather of your 
and Saids configuration. I think what I might try is to shorten this.


> 
> If it is not the case, I presume you might have hit some EML bug here 
> due to
> the fact that the switch adds some extra (HW) latency to the message
> transmission time and something fishy happens.
> 
> Are you still using the while loop for sending?  If so, what happens
> if you send the ethercat messages in a separate thread with a
> frequency of say, 1KHz?
> [/wild guess]
Easy for me to try. Will do so.


> 
> You might find debugging information in the wireshark scan too:
> remember that the slaves should leave the index field unaltered...
Correct. Will investigate this also.


Thanks

Roland


> 
> Klaas
> 


From harti_said at yahoo.fr  Fri Aug  3 09:30:35 2007
From: harti_said at yahoo.fr (said harti)
Date: Fri, 3 Aug 2007 09:30:35 +0200 (CEST)
Subject: [Ethercatmaster-users] RE : Re: RE : Re: understanding the datagrams
In-Reply-To: <f68302e30708020425m593713d4pc502d126d7ef92ae@mail.gmail.com>
Message-ID: <695280.80367.qm@web37309.mail.mud.yahoo.com>

Hi,

if there is : Use LRD/LWR instead of LRW on the advanced setting menu, that is meen that the fhe default mode is LRW , are you agree with me???!!!

if not, can evryone tell me how can i set the TwinCAT config to LRW mode ?? i have looked for that, but i dont find this function...

Said

roland tollenaar <rwatollenaar at gmail.com> a ?crit : Hi Said,

Are you still around? Have you had any luck with twincat in LRW mode?

Regards,

Roland

On 8/2/07, roland tollenaar < rwatollenaar at gmail.com> wrote:Hi Said,

please let me know as soon as possible what the result is. In the mean time I am going to figure out how to hack the frames that EML puts on the wire to try LWR as well. But it is very imoprtant to know how TwinCat behaves in LRW. 

But you have it wrong below!!!  It is already in LRD/LWR you must set it TO!! LRW.

Roland

On 8/2/07,  said harti < harti_said at yahoo.fr> wrote:Hi,

We can change the configure of the Twincat from LRW to LRD/LWR  
we choose the specific module (EL2004 for example) :
Adevanced Setting..>General>Behavior> and we can choose : Use LRD/LWR instead of LRW, 

I am going to realize the scan...

Said

  Tom Panis <tompanis at skynet.be> a ?crit :   
Roland Tollenaar schreef:
> Hi,
>
> Thanks for the insight. I had not noticed that. Am I correct in 
> stating that the EML frame has a single telegram all LWR? Its surely  
> getting my digital inputs so there seems to be no problem there. Still 
> the command in the header of the data for the ouputs is different to 
> that in the EML one  0x0b as opposed to 0x0c so are you /sure/ that  
> EML is operating LWR on the outputs? What am I missing?

EML doesn't  use a LWR command (= logical write) but a LRW command (= 
logical read write). With this LRW command there can be read from and 
written to the slaves at the same time and using the same telegram.

0x0b stands for LWR and 0x0c stands for LRW.  So because EML uses only  
one telegram, it has to be 0x0c. Twincat splits the read and write 
commands and therefore you'll see 0x0b at a Twincat scan. And I'm pretty 
sure you'll also see 0x0a (LRD) in another frame of the same telegram  
for reading data. An overview of all the Ethercat commands can be found 
in the spec at page 69 ff.

Ps. I'm not 100% sure but I think somewhere in the configuration of 
TwinCAT, you can choose between using LRW commands or LRD and LWR commands. 

>
> Roland
>
> Tom Panis wrote:
>> Roland Tollenaar wrote:
>>> Hi Klaas,
>>>
>>> Thanks. The LWR should be fine but its a bit strange that Twincat  
>>> does a logical RD. That would imply that no data is written to the 
>>> slaves but this does not correspond to the outputs being set?
>>>   
>>
>> Ethercat usually sends frames with a couple of telegrams inside.  
>> Looking at the scan Sa?d posted you'll see that there is a LWR 
>> telegram for the analog and digital outputs a LRD for the digital 
>> inputs, a second LRD for the mailbox and a BRD.
  >>
>>
>>> Have you received the mail about the watchdog timer? Could you 
>>> advise on how to read/ set this with EML?
>>>
>>> Regards,
>>>
>>> Roland 
>>>
>>> Klaas Gadeyne wrote:
>>>  
>>>> On Tue, 31 Jul 2007, Roland Tollenaar wrote:
>>>>    
>>>>> Hi,
>>>>>
>>>>> Please give some  assistance wrt to the ethercat dataframes. I am 
>>>>> having
>>>>> trouble with the documentation.
>>>>>
>>>>> In particular at the moment the EC datagram header is what I am 
>>>>> interested in.
>>>>>
>>>>> This is what the header looks like.
>>>>>
>>>>>    Cmd    /Idx    /Addr    /Offset    /11bit length/R/C/R/M    /IRQ 
>>>>> TC  0b    00    00 00    01 00    05 80            00 00
>>>>> EML 0c    46    00 00    01 00    05 00            00 00
>>>>>
>>>>> Now the questions are: 
>>>>>
>>>>> Where do I find documentation on the Cmd values that must be used. 
>>>>> Why
>>>>> would EML have a different command? (0xc instead of 0x0b) 
>>>>>        
>>>>  
>>>>
>>>>  
>>>>
>>>>

>>>> So it seems you (or EML code, since I don't know _when_ this frame is 
>>>> send)) are performing a logical read-write, while twincat is doing a
>>>> logical read.
>>>>
>>>>    
>>>>> The Index Idx has 0x46 instead of 00. Again I have missed (cannot for 
>>>>> the life of me find it this morning because I think I have seen
>>>>> something about it) the part in the documentation that tells me 
>>>>> what the
>>>>> index  does. Why will EML have a different value here?
>>>>>       
>>>> AFAIK (please check in the spec) the spec only says that the master
>>>> should check if the index is unaltered when a message returns, its 
>>>> real value doesn't matter.
>>>>
>>>>    
>>>>> Then we see a difference in the RCRM part of the header. I have no 
>>>>> idea
 >>>>> what they mean. C is recirculating, M means More datagrams. 
>>>>>       
>>>> Me neither, I guess that is the module specific data?
>>>>
>>>>    
>>>>> Finally my question is how to establish the lenght out of the 11 bit 
>>>>> length. This may be obvious but what confuses me is the part in the
>>>>> Ethercat Header (main header not the one in the  datagram)
>>>>>
>>>>> This part is
>>>>> TC   0x39 0x10
>>>>> EML  0x11 0x10
>>>>>
>>>>> Which I don;t understnad because according to the documentation  
>>>>> the last
>>>>> 4 bits indicate the type and 1 should be Ethercat. But neither TC nor
>>>>> EML have a 1 in that position? Or is LSB and MSB turned around?
>>>>>        
>>>> I don't understand your question here, but ethercat is little 
>>>> endian IIRC
>>>>
>>>>    
>>>>> I get a feeling that the differences in this header may be the  
>>>>> cause for
>>>>> the problem. It may even be the length which IMHO seems to differ 
>>>>> but I
>>>>> am not sure because there is so much info I am  lacking.
>>>>>       
>>>>     
>>> _______________________________________________
>>> Ethercatmaster-users mailing list
>>>   Ethercatmaster-users at lists.berlios.de
>>> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users 
>>>
>>>   
>> _______________________________________________
>> Ethercatmaster-users mailing list
>>   Ethercatmaster-users at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users 
>>
>
_______________________________________________
Ethercatmaster-users mailing list
  Ethercatmaster-users at lists.berlios.de
https://lists.berlios.de/mailman/listinfo/ethercatmaster-users 


           

---------------------------------
  Ne gardez plus qu'une seule adresse mail ! Copiez vos mails vers Yahoo! Mail 

  _______________________________________________
Ethercatmaster-users mailing list
Ethercatmaster-users at lists.berlios.de 
https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
  


 


 

       
---------------------------------
 Stockage illimit? de vos mails avec Yahoo! Mail. Changez aujourd'hui de mail !
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070803/e4ea8304/attachment.html>

From rwatollenaar at gmail.com  Fri Aug  3 10:46:10 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Fri, 03 Aug 2007 10:46:10 +0200
Subject: [Ethercatmaster-users] RE : Re: RE : Re: understanding the
	datagrams
In-Reply-To: <695280.80367.qm@web37309.mail.mud.yahoo.com>
References: <695280.80367.qm@web37309.mail.mud.yahoo.com>
Message-ID: <46B2EB52.40209@gmail.com>

Hi Said,

I agree with you, i have already discovered this. Can you confirm with a 
scan that when you tick on the LRD/LWR that the ethercat message is 
different to when that box is NOT ticked. Then we can see if that 
selection does anything at all in twincat?

Regards,

Roland

said harti wrote:
> Hi,
> 
> if there is : Use LRD/LWR instead of LRW on the advanced setting menu, 
> that is meen that the fhe default mode is LRW , are you agree with me???!!!
> 
> if not, can evryone tell me how can i set the TwinCAT config to LRW mode 
> ?? i have looked for that, but i dont find this function...
> 
> Said
> 
> */roland tollenaar <rwatollenaar at gmail.com>/* a ?crit :
> 
>     Hi Said,
> 
>     Are you still around? Have you had any luck with twincat in LRW mode?
> 
>     Regards,
> 
>     Roland
> 
>     On 8/2/07, *roland tollenaar* < rwatollenaar at gmail.com
>     <mailto:rwatollenaar at gmail.com>> wrote:
> 
>         Hi Said,
> 
>         please let me know as soon as possible what the result is. In
>         the mean time I am going to figure out how to hack the frames
>         that EML puts on the wire to try LWR as well. But it is very
>         imoprtant to know how TwinCat behaves in LRW.
> 
>         But you have it wrong below!!!  It is already in LRD/LWR you
>         must set it TO!! LRW.
> 
>         Roland
> 
> 
>         On 8/2/07, *said harti* < harti_said at yahoo.fr
>         <mailto:harti_said at yahoo.fr>> wrote:
> 
>             Hi,
> 
>             We can change the configure of the Twincat from LRW to LRD/LWR
>             we choose the specific module (EL2004 for example) :
>             Adevanced Setting..>General>Behavior> and we can choose :
>             Use LRD/LWR instead of LRW,
> 
>             I am going to realize the scan...
> 
>             Said
> 
>             */ Tom Panis <tompanis at skynet.be
>             <mailto:tompanis at skynet.be>>/* a ?crit :
> 
> 
>                 Roland Tollenaar schreef:
>                 >  Hi,
>                 >
>                 >  Thanks for the insight. I had not noticed that. Am I
>                 correct in
>                 >  stating that the EML frame has a single telegram all
>                 LWR? Its surely
>                 >  getting my digital inputs so there seems to be no
>                 problem there. Still
>                 >  the command in the header of the data for the ouputs
>                 is different to
>                 >  that in the EML one 0x0b as opposed to 0x0c so are you
>                 /sure/ that
>                 >  EML is operating LWR on the outputs? What am I missing?
> 
>                 EML doesn't use a LWR command (= logical write) but a
>                 LRW command (=
>                 logical read write). With this LRW command there can be
>                 read from and
>                 written to the slaves at the same time and using the
>                 same telegram.
> 
>                 0x0b stands for LWR and 0x0c stands for LRW. So because
>                 EML uses only
>                 one telegram, it has to be 0x0c. Twincat splits the read
>                 and write
>                 commands and therefore you'll see 0x0b at a Twincat
>                 scan. And I'm pretty
>                 sure you'll also see 0x0a (LRD) in another frame of the
>                 same telegram
>                 for reading data. An overview of all the Ethercat
>                 commands can be found
>                 in the spec at page 69 ff.
> 
>                 Ps. I'm not 100% sure but I think somewhere in the
>                 configuration of
>                 TwinCAT, you can choose between using LRW commands or
>                 LRD and LWR commands.
> 
>                 >
>                 >  Roland
>                 >
>                 >  Tom Panis wrote:
>                 > > Roland Tollenaar wrote:
>                 > >> Hi Klaas,
>                 > >>
>                 > >> Thanks. The LWR should be fine but its a bit strange
>                 that Twincat
>                 > >> does a logical RD. That would imply that no data is
>                 written to the
>                 > >> slaves but this does not correspond to the outputs
>                 being set?
>                 > >>
>                 > >
>                 > > Ethercat usually sends frames with a couple of
>                 telegrams inside.
>                 > > Looking at the scan Sa?d posted you'll see that there
>                 is a LWR
>                 > > telegram for the analog and digital outputs a LRD for
>                 the digital
>                 > > inputs, a second LRD for the mailbox and a BRD.
>                 > >
>                 > >
>                 > >> Have you received the mail about the watchdog timer?
>                 Could you
>                 > >> advise on how to read/ set this with EML?
>                 > >>
>                 > >> Regards,
>                 > >>
>                 > >> Roland
>                 > >>
>                 > >> Klaas Gadeyne wrote:
>                 > >>
>                 > >>> On Tue, 31 Jul 2007, Roland Tollenaar wrote:
>                 > >>>
>                 > >>>> Hi,
>                 > >>>>
>                 > >>>> Please give some assistance wrt to the ethercat
>                 dataframes. I am
>                 > >>>> having
>                 > >>>> trouble with the documentation.
>                 > >>>>
>                 > >>>> In particular at the moment the EC datagram header
>                 is what I am
>                 > >>>> interested in.
>                 > >>>>
>                 > >>>> This is what the header looks like.
>                 > >>>>
>                 > >>>> Cmd /Idx /Addr /Offset /11bit length/R/C/R/M /IRQ
>                 > >>>> TC 0b 00 00 00 01 00 05 80 00 00
>                 > >>>> EML 0c 46 00 00 01 00 05 00 00 00
>                 > >>>>
>                 > >>>> Now the questions are:
>                 > >>>>
>                 > >>>> Where do I find documentation on the Cmd values
>                 that must be used.
>                 > >>>> Why
>                 > >>>> would EML have a different command? (0xc instead
>                 of 0x0b)
>                 > >>>>
>                 > >>>
>                 > >>>
>                 > >>>
>                 > >>>
>                 > >>>
>                 > >>> So it seems you (or EML code, since I don't know
>                 _when_ this frame is
>                 > >>> send)) are performing a logical read-write, while
>                 twincat is doing a
>                 > >>> logical read.
>                 > >>>
>                 > >>>
>                 > >>>> The Index Idx has 0x46 instead of 00. Again I have
>                 missed (cannot for
>                 > >>>> the life of me find it this morning because I
>                 think I have seen
>                 > >>>> something about it) the part in the documentation
>                 that tells me
>                 > >>>> what the
>                 > >>>> index does. Why will EML have a different value here?
>                 > >>>>
>                 > >>> AFAIK (please check in the spec) the spec only says
>                 that the master
>                 > >>> should check if the index is unaltered when a
>                 message returns, its
>                 > >>> real value doesn't matter.
>                 > >>>
>                 > >>>
>                 > >>>> Then we see a difference in the RCRM part of the
>                 header. I have no
>                 > >>>> idea
>                 > >>>> what they mean. C is recirculating, M means More
>                 datagrams.
>                 > >>>>
>                 > >>> Me neither, I guess that is the module specific data?
>                 > >>>
>                 > >>>
>                 > >>>> Finally my question is how to establish the lenght
>                 out of the 11 bit
>                 > >>>> length. This may be obvious but what confuses me
>                 is the part in the
>                 > >>>> Ethercat Header (main header not the one in the
>                 datagram)
>                 > >>>>
>                 > >>>> This part is
>                 > >>>> TC 0x39 0x10
>                 > >>>> EML 0x11 0x10
>                 > >>>>
>                 > >>>> Which I don;t understnad because according to the
>                 documentation
>                 > >>>> the last
>                 > >>>> 4 bits indicate the type and 1 should be Ethercat.
>                 But neither TC nor
>                 > >>>> EML have a 1 in that position? Or is LSB and MSB
>                 turned around?
>                 > >>>>
>                 > >>> I don't understand your question here, but ethercat
>                 is little
>                 > >>> endian IIRC
>                 > >>>
>                 > >>>
>                 > >>>> I get a feeling that the differences in this
>                 header may be the
>                 > >>>> cause for
>                 > >>>> the problem. It may even be the length which IMHO
>                 seems to differ
>                 > >>>> but I
>                 > >>>> am not sure because there is so much info I am
>                 lacking.
>                 > >>>>
>                 > >>>
>                 > >> _______________________________________________
>                 > >> Ethercatmaster-users mailing list
>                 > >> Ethercatmaster-users at lists.berlios.de
>                 <mailto:Ethercatmaster-users at lists.berlios.de>
>                 > >>
>                 https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>                 <https://lists.berlios.de/mailman/listinfo/ethercatmaster-users>
>                 > >>
>                 > >>
>                 > > _______________________________________________
>                 > > Ethercatmaster-users mailing list
>                 > > Ethercatmaster-users at lists.berlios.de
>                 <mailto:Ethercatmaster-users at lists.berlios.de>
>                 > >
>                 https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>                 <https://lists.berlios.de/mailman/listinfo/ethercatmaster-users>
>                 > >
>                 >
>                 _______________________________________________
>                 Ethercatmaster-users mailing list
>                 Ethercatmaster-users at lists.berlios.de
>                 <mailto:Ethercatmaster-users at lists.berlios.de>
>                 https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>                 <https://lists.berlios.de/mailman/listinfo/ethercatmaster-users>
> 
> 
>             ------------------------------------------------------------------------
>             Ne gardez plus qu'une seule adresse mail ! Copiez vos mails
>             <http://www.trueswitch.com/yahoo-fr/> vers Yahoo! Mail
> 
>             _______________________________________________
>             Ethercatmaster-users mailing list
>             Ethercatmaster-users at lists.berlios.de
>             <mailto:Ethercatmaster-users at lists.berlios.de>
>             https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
> 
> 
> 
> 
> ------------------------------------------------------------------------
> Stockage illimit? de vos mails avec Yahoo! Mail. Changez aujourd'hui de 
> mail ! <http://fr.promotions.yahoo.com/mail/nouveau_yahoomail2.html>


From harti_said at yahoo.fr  Fri Aug  3 10:55:05 2007
From: harti_said at yahoo.fr (said harti)
Date: Fri, 3 Aug 2007 10:55:05 +0200 (CEST)
Subject: [Ethercatmaster-users] RE : Re: RE : Re: RE : Re: understanding the
	datagrams
In-Reply-To: <46B2EB52.40209@gmail.com>
Message-ID: <165881.51100.qm@web37303.mail.mud.yahoo.com>

ok, iam going to do that very soon, 

but i have a bad question, i must set just the EL2004 DO on LRD/LWR or all modules ???

Roland Tollenaar <rwatollenaar at gmail.com> a ?crit : Hi Said,

I agree with you, i have already discovered this. Can you confirm with a 
scan that when you tick on the LRD/LWR that the ethercat message is 
different to when that box is NOT ticked. Then we can see if that 
selection does anything at all in twincat?

Regards,

Roland

said harti wrote:
> Hi,
> 
> if there is : Use LRD/LWR instead of LRW on the advanced setting menu, 
> that is meen that the fhe default mode is LRW , are you agree with me???!!!
> 
> if not, can evryone tell me how can i set the TwinCAT config to LRW mode 
> ?? i have looked for that, but i dont find this function...
> 
> Said
> 
> */roland tollenaar /* a ?crit :
> 
>     Hi Said,
> 
>     Are you still around? Have you had any luck with twincat in LRW mode?
> 
>     Regards,
> 
>     Roland
> 
>     On 8/2/07, *roland tollenaar* < rwatollenaar at gmail.com
>     > wrote:
> 
>         Hi Said,
> 
>         please let me know as soon as possible what the result is. In
>         the mean time I am going to figure out how to hack the frames
>         that EML puts on the wire to try LWR as well. But it is very
>         imoprtant to know how TwinCat behaves in LRW.
> 
>         But you have it wrong below!!!  It is already in LRD/LWR you
>         must set it TO!! LRW.
> 
>         Roland
> 
> 
>         On 8/2/07, *said harti* < harti_said at yahoo.fr
>         > wrote:
> 
>             Hi,
> 
>             We can change the configure of the Twincat from LRW to LRD/LWR
>             we choose the specific module (EL2004 for example) :
>             Adevanced Setting..>General>Behavior> and we can choose :
>             Use LRD/LWR instead of LRW,
> 
>             I am going to realize the scan...
> 
>             Said
> 
>             */ Tom Panis 
>             >/* a ?crit :
> 
> 
>                 Roland Tollenaar schreef:
>                 >  Hi,
>                 >
>                 >  Thanks for the insight. I had not noticed that. Am I
>                 correct in
>                 >  stating that the EML frame has a single telegram all
>                 LWR? Its surely
>                 >  getting my digital inputs so there seems to be no
>                 problem there. Still
>                 >  the command in the header of the data for the ouputs
>                 is different to
>                 >  that in the EML one 0x0b as opposed to 0x0c so are you
>                 /sure/ that
>                 >  EML is operating LWR on the outputs? What am I missing?
> 
>                 EML doesn't use a LWR command (= logical write) but a
>                 LRW command (=
>                 logical read write). With this LRW command there can be
>                 read from and
>                 written to the slaves at the same time and using the
>                 same telegram.
> 
>                 0x0b stands for LWR and 0x0c stands for LRW. So because
>                 EML uses only
>                 one telegram, it has to be 0x0c. Twincat splits the read
>                 and write
>                 commands and therefore you'll see 0x0b at a Twincat
>                 scan. And I'm pretty
>                 sure you'll also see 0x0a (LRD) in another frame of the
>                 same telegram
>                 for reading data. An overview of all the Ethercat
>                 commands can be found
>                 in the spec at page 69 ff.
> 
>                 Ps. I'm not 100% sure but I think somewhere in the
>                 configuration of
>                 TwinCAT, you can choose between using LRW commands or
>                 LRD and LWR commands.
> 
>                 >
>                 >  Roland
>                 >
>                 >  Tom Panis wrote:
>                 > > Roland Tollenaar wrote:
>                 > >> Hi Klaas,
>                 > >>
>                 > >> Thanks. The LWR should be fine but its a bit strange
>                 that Twincat
>                 > >> does a logical RD. That would imply that no data is
>                 written to the
>                 > >> slaves but this does not correspond to the outputs
>                 being set?
>                 > >>
>                 > >
>                 > > Ethercat usually sends frames with a couple of
>                 telegrams inside.
>                 > > Looking at the scan Sa?d posted you'll see that there
>                 is a LWR
>                 > > telegram for the analog and digital outputs a LRD for
>                 the digital
>                 > > inputs, a second LRD for the mailbox and a BRD.
>                 > >
>                 > >
>                 > >> Have you received the mail about the watchdog timer?
>                 Could you
>                 > >> advise on how to read/ set this with EML?
>                 > >>
>                 > >> Regards,
>                 > >>
>                 > >> Roland
>                 > >>
>                 > >> Klaas Gadeyne wrote:
>                 > >>
>                 > >>> On Tue, 31 Jul 2007, Roland Tollenaar wrote:
>                 > >>>
>                 > >>>> Hi,
>                 > >>>>
>                 > >>>> Please give some assistance wrt to the ethercat
>                 dataframes. I am
>                 > >>>> having
>                 > >>>> trouble with the documentation.
>                 > >>>>
>                 > >>>> In particular at the moment the EC datagram header
>                 is what I am
>                 > >>>> interested in.
>                 > >>>>
>                 > >>>> This is what the header looks like.
>                 > >>>>
>                 > >>>> Cmd /Idx /Addr /Offset /11bit length/R/C/R/M /IRQ
>                 > >>>> TC 0b 00 00 00 01 00 05 80 00 00
>                 > >>>> EML 0c 46 00 00 01 00 05 00 00 00
>                 > >>>>
>                 > >>>> Now the questions are:
>                 > >>>>
>                 > >>>> Where do I find documentation on the Cmd values
>                 that must be used.
>                 > >>>> Why
>                 > >>>> would EML have a different command? (0xc instead
>                 of 0x0b)
>                 > >>>>
>                 > >>>
>                 > >>>
>                 > >>>
>                 > >>>
>                 > >>>
>                 > >>> So it seems you (or EML code, since I don't know
>                 _when_ this frame is
>                 > >>> send)) are performing a logical read-write, while
>                 twincat is doing a
>                 > >>> logical read.
>                 > >>>
>                 > >>>
>                 > >>>> The Index Idx has 0x46 instead of 00. Again I have
>                 missed (cannot for
>                 > >>>> the life of me find it this morning because I
>                 think I have seen
>                 > >>>> something about it) the part in the documentation
>                 that tells me
>                 > >>>> what the
>                 > >>>> index does. Why will EML have a different value here?
>                 > >>>>
>                 > >>> AFAIK (please check in the spec) the spec only says
>                 that the master
>                 > >>> should check if the index is unaltered when a
>                 message returns, its
>                 > >>> real value doesn't matter.
>                 > >>>
>                 > >>>
>                 > >>>> Then we see a difference in the RCRM part of the
>                 header. I have no
>                 > >>>> idea
>                 > >>>> what they mean. C is recirculating, M means More
>                 datagrams.
>                 > >>>>
>                 > >>> Me neither, I guess that is the module specific data?
>                 > >>>
>                 > >>>
>                 > >>>> Finally my question is how to establish the lenght
>                 out of the 11 bit
>                 > >>>> length. This may be obvious but what confuses me
>                 is the part in the
>                 > >>>> Ethercat Header (main header not the one in the
>                 datagram)
>                 > >>>>
>                 > >>>> This part is
>                 > >>>> TC 0x39 0x10
>                 > >>>> EML 0x11 0x10
>                 > >>>>
>                 > >>>> Which I don;t understnad because according to the
>                 documentation
>                 > >>>> the last
>                 > >>>> 4 bits indicate the type and 1 should be Ethercat.
>                 But neither TC nor
>                 > >>>> EML have a 1 in that position? Or is LSB and MSB
>                 turned around?
>                 > >>>>
>                 > >>> I don't understand your question here, but ethercat
>                 is little
>                 > >>> endian IIRC
>                 > >>>
>                 > >>>
>                 > >>>> I get a feeling that the differences in this
>                 header may be the
>                 > >>>> cause for
>                 > >>>> the problem. It may even be the length which IMHO
>                 seems to differ
>                 > >>>> but I
>                 > >>>> am not sure because there is so much info I am
>                 lacking.
>                 > >>>>
>                 > >>>
>                 > >> _______________________________________________
>                 > >> Ethercatmaster-users mailing list
>                 > >> Ethercatmaster-users at lists.berlios.de
>                 
>                 > >>
>                 https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>                 
>                 > >>
>                 > >>
>                 > > _______________________________________________
>                 > > Ethercatmaster-users mailing list
>                 > > Ethercatmaster-users at lists.berlios.de
>                 
>                 > >
>                 https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>                 
>                 > >
>                 >
>                 _______________________________________________
>                 Ethercatmaster-users mailing list
>                 Ethercatmaster-users at lists.berlios.de
>                 
>                 https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>                 
> 
> 
>             ------------------------------------------------------------------------
>             Ne gardez plus qu'une seule adresse mail ! Copiez vos mails
>              vers Yahoo! Mail
> 
>             _______________________________________________
>             Ethercatmaster-users mailing list
>             Ethercatmaster-users at lists.berlios.de
>             
>             https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
> 
> 
> 
> 
> ------------------------------------------------------------------------
> Stockage illimit? de vos mails avec Yahoo! Mail. Changez aujourd'hui de 
> mail ! 


       
---------------------------------
 Stockage illimit? de vos mails avec Yahoo! Mail. Changez aujourd'hui de mail !
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070803/f7d23d3c/attachment.html>

From rwatollenaar at gmail.com  Fri Aug  3 16:33:54 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Fri, 03 Aug 2007 16:33:54 +0200
Subject: [Ethercatmaster-users] RE : Re: RE : Re: RE : Re: RE : Re:
 understanding the datagrams
In-Reply-To: <806715.7514.qm@web37309.mail.mud.yahoo.com>
References: <806715.7514.qm@web37309.mail.mud.yahoo.com>
Message-ID: <46B33CD2.1020204@gmail.com>

Hi Said,

Thanks. I did. The conclusion I think is that TwinCat always sends in 
lrd and lwr. This means that they may know that there is some problem 
with LRW.


This might be serious.


I think what we must now try is to send LWR from EML. That may be no 
trivial task. Initially a crude hack into the frame may be easiest. Just 
to check the response. Problem is that life is not made easier by the 
bug in EML that cuts out my communication when I have a switch in between.

It would be nice if the EML guys had some advice but I think this will 
be up to us.

Regards,

Roland.

said harti wrote:
> do you have receive my Traffics scans ?
> 
> */Roland Tollenaar <rwatollenaar at gmail.com>/* a ?crit :
> 
>     Hi Said,
> 
>     good question. I would do all of them.
> 
>     RR
> 
>     said harti wrote:
>      > ok, iam going to do that very soon,
>      >
>      > but i have a bad question, i must set just the EL2004 DO on
>     LRD/LWR or
>      > all modules ???
>      >
>      > */Roland Tollenaar /* a ?crit :
>      >
>      > Hi Said,
>      >
>      > I agree with you, i have already discovered this. Can you confirm
>      > with a
>      > scan that when you tick on the LRD/LWR that the ethercat message is
>      > different to when that box is NOT ticked. Then we can see if that
>      > selection does anything at all in twincat?
>      >
>      > Regards,
>      >
>      > Roland
>      >
>      > said harti wrote:
>      > > Hi,
>      > >
>      > > if there is : Use LRD/LWR instead of LRW on the advanced setting
>      > menu,
>      > > that is meen that the fhe default mode is LRW , are you agree
>      > with me???!!!
>      > >
>      > > if not, can evryone tell me how can i set the TwinCAT config to
>      > LRW mode
>      > > ?? i have looked for that, but i dont find this function...
>      > >
>      > > Said
>      > >
>      > > */roland tollenaar /* a ?crit :
>      > >
>      > > Hi Said,
>      > >
>      > > Are you still around? Have you had any luck with twincat in LRW
>     mode?
>      > >
>      > > Regards,
>      > >
>      > > Roland
>      > >
>      > > On 8/2/07, *roland tollenaar* < rwatollenaar at gmail.com
>      > > > wrote:
>      > >
>      > > Hi Said,
>      > >
>      > > please let me know as soon as possible what the result is. In
>      > > the mean time I am going to figure out how to hack the frames
>      > > that EML puts on the wire to try LWR as well. But it is very
>      > > imoprtant to know how TwinCat behaves in LRW.
>      > >
>      > > But you have it wrong below!!! It is already in LRD/LWR you
>      > > must set it TO!! LRW.
>      > >
>      > > Roland
>      > >
>      > >
>      > > On 8/2/07, *said harti* < harti_said at yahoo.fr
>      > > > wrote:
>      > >
>      > > Hi,
>      > >
>      > > We can change the configure of the Twincat from LRW to LRD/LWR
>      > > we choose the specific module (EL2004 for example) :
>      > > Adevanced Setting..>General>Behavior> and we can choose :
>      > > Use LRD/LWR instead of LRW,
>      > >
>      > > I am going to realize the scan...
>      > >
>      > > Said
>      > >
>      > > */ Tom Panis
>      > > >/* a ?crit :
>      > >
>      > >
>      > > Roland Tollenaar schreef:
>      > > > Hi,
>      > > >
>      > > > Thanks for the insight. I had not noticed that. Am I
>      > > correct in
>      > > > stating that the EML frame has a single telegram all
>      > > LWR? Its surely
>      > > > getting my digital inputs so there seems to be no
>      > > problem there. Still
>      > > > the command in the header of the data for the ouputs
>      > > is different to
>      > > > that in the EML one 0x0b as opposed to 0x0c so are you
>      > > /sure/ that
>      > > > EML is operating LWR on the outputs? What am I missing?
>      > >
>      > > EML doesn't use a LWR command (= logical write) but a
>      > > LRW command (=
>      > > logical read write). With this LRW command there can be
>      > > read from and
>      > > written to the slaves at the same time and using the
>      > > same telegram.
>      > >
>      > > 0x0b stands for LWR and 0x0c stands for LRW. So because
>      > > EML uses only
>      > > one telegram, it has to be 0x0c. Twincat splits the read
>      > > and write
>      > > commands and therefore you'll see 0x0b at a Twincat
>      > > scan. And I'm pretty
>      > > sure you'll also see 0x0a (LRD) in another frame of the
>      > > same telegram
>      > > for reading data. An overview of all the Ethercat
>      > > commands can be found
>      > > in the spec at page 69 ff.
>      > >
>      > > Ps. I'm not 100% sure but I think somewhere in the
>      > > configuration of
>      > > TwinCAT, you can choose between using LRW commands or
>      > > LRD and LWR commands.
>      > >
>      > > >
>      > > > Roland
>      > > >
>      > > > Tom Panis wrote:
>      > > > > Roland Tollenaar wrote:
>      > > > >> Hi Klaas,
>      > > > >>
>      > > > >> Thanks. The LWR should be fine but its a bit strange
>      > > that Twincat
>      > > > >> does a logical RD. That would imply that no data is
>      > > written to the
>      > > > >> slaves but this does not correspond to the outputs
>      > > being set?
>      > > > >>
>      > > > >
>      > > > > Ethercat usually sends frames with a couple of
>      > > telegrams inside.
>      > > > > Looking at the scan Sa?d posted you'll see that there
>      > > is a LWR
>      > > > > telegram for the analog and digital outputs a LRD for
>      > > the digital
>      > > > > inputs, a second LRD for the mailbox and a BRD.
>      > > > >
>      > > > >
>      > > > >> Have you received the mail about the watchdog timer?
>      > > Could you
>      > > > >> advise on how to read/ set this with EML?
>      > > > >>
>      > > > >> Regards,
>      > > > >>
>      > > > >> Roland
>      > > > >>
>      > > > >> Klaas Gadeyne wrote:
>      > > > >>
>      > > > >>> On Tue, 31 Jul 2007, Roland Tollenaar wrote:
>      > > > >>>
>      > > > >>>> Hi,
>      > > > >>>>
>      > > > >>>> Please give some assistance wrt to the ethercat
>      > > dataframes. I am
>      > > > >>>> having
>      > > > >>>> trouble with the documentation.
>      > > > >>>>
>      > > > >>>> In particular at the moment the EC datagram header
>      > > is what I am
>      > > > >>>> interested in.
>      > > > >>>>
>      > > > >>>> This is what the header looks like.
>      > > > >>>>
>      > > > >>>> Cmd /Idx /Addr /Offset /11bit length/R/C/R/M /IRQ
>      > > > >>>> TC 0b 00 00 00 01 00 05 80 00 00
>      > > > >>>> EML 0c 46 00 00 01 00 05 00 00 00
>      > > > >>>>
>      > > > >>>> Now the questions are:
>      > > > >>>>
>      > > > >>>> Where do I find documentation on the Cmd values
>      > > that must be used.
>      > > > >>>> Why
>      > > > >>>> would EML have a different command? (0xc instead
>      > > of 0x0b)
>      > > > >>>>
>      > > > >>>
>      > > > >>>
>      > > > >>>
>      > > > >>>
>      > > > >>>
>      > > > >>> So it seems you (or EML code, since I don't know
>      > > _when_ this frame is
>      > > > >>> send)) are performing a logical read-write, while
>      > > twincat is doing a
>      > > > >>> logical read.
>      > > > >>>
>      > > > >>>
>      > > > >>>> The Index Idx has 0x46 instead of 00. Again I have
>      > > missed (cannot for
>      > > > >>>> the life of me find it this morning because I
>      > > think I have seen
>      > > > >>>> something about it) the part in the documentation
>      > > that tells me
>      > > > >>>> what the
>      > > > >>>> index does. Why will EML have a different value here?
>      > > > >>>>
>      > > > >>> AFAIK (please check in the spec) the spec only says
>      > > that the master
>      > > > >>> should check if the index is unaltered when a
>      > > message returns, its
>      > > > >>> real value doesn't matter.
>      > > > >>>
>      > > > >>>
>      > > > >>>> Then we see a difference in the RCRM part of the
>      > > header. I have no
>      > > > >>>> idea
>      > > > >>>> what they mean. C is recirculating, M means More
>      > > datagrams.
>      > > > >>>>
>      > > > >>> Me neither, I guess that is the module specific data?
>      > > > >>>
>      > > > >>>
>      > > > >>>> Finally my question is how to establish the lenght
>      > > out of the 11 bit
>      > > > >>>> length. This may be obvious but what confuses me
>      > > is the part in the
>      > > > >>>> Ethercat Header (main header not the one in the
>      > > datagram)
>      > > > >>>>
>      > > > >>>> This part is
>      > > > >>>> TC 0x39 0x10
>      > > > >>>> EML 0x11 0x10
>      > > > >>>>
>      > > > >>>> Which I don;t understnad because according to the
>      > > documentation
>      > > > >>>> the last
>      > > > >>>> 4 bits indicate the type and 1 should be Ethercat.
>      > > But neither TC nor
>      > > > >>>> EML have a 1 in that position? Or is LSB and MSB
>      > > turned around?
>      > > > >>>>
>      > > > >>> I don't understand your question here, but ethercat
>      > > is little
>      > > > >>> endian IIRC
>      > > > >>>
>      > > > >>>
>      > > > >>>> I get a feeling that the differences in this
>      > > header may be the
>      > > > >>>> cause for
>      > > > >>>> the problem. It may even be the length which IMHO
>      > > seems to differ
>      > > > >>>> but I
>      > > > >>>> am not sure because there is so much info I am
>      > > lacking.
>      > > > >>>>
>      > > > >>>
>      > > > >> _______________________________________________
>      > > > >> Ethercatmaster-users mailing list
>      > > > >> Ethercatmaster-users at lists.berlios.de
>      > >
>      > > > >>
>      > > https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>      > >
>      > > > >>
>      > > > >>
>      > > > > _______________________________________________
>      > > > > Ethercatmaster-users mailing list
>      > > > > Ethercatmaster-users at lists.berlios.de
>      > >
>      > > > >
>      > > https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>      > >
>      > > > >
>      > > >
>      > > _______________________________________________
>      > > Ethercatmaster-users mailing list
>      > > Ethercatmaster-users at lists.berlios.de
>      > >
>      > > https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>      > >
>      > >
>      > >
>      > >
>      >
>     ------------------------------------------------------------------------
>      > > Ne gardez plus qu'une seule adresse mail ! Copiez vos mails
>      > > vers Yahoo! Mail
>      > >
>      > > _______________________________________________
>      > > Ethercatmaster-users mailing list
>      > > Ethercatmaster-users at lists.berlios.de
>      > >
>      > > https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>      > >
>      > >
>      > >
>      > >
>      > >
>      >
>     ------------------------------------------------------------------------
>      > > Stockage illimit? de vos mails avec Yahoo! Mail. Changez
>      > aujourd'hui de
>      > > mail !
>      >
>      >
>      >
>     ------------------------------------------------------------------------
>      > Stockage illimit? de vos mails avec Yahoo! Mail. Changez
>     aujourd'hui de
>      > mail !
> 
> 
> ------------------------------------------------------------------------
> Stockage illimit? de vos mails avec Yahoo! Mail. Changez aujourd'hui de 
> mail ! <http://fr.promotions.yahoo.com/mail/nouveau_yahoomail2.html>


From rwatollenaar at gmail.com  Tue Aug  7 09:13:27 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Tue, 07 Aug 2007 09:13:27 +0200
Subject: [Ethercatmaster-users] non-persistent outputs ETG suggestions
Message-ID: <46B81B97.3020405@gmail.com>

Hi Said, Klaas, Tom


ETG Mr Haefele has investigated the matter a bit and his findings are 
stated below. Please tell me how to implement his suggestions with EML 
since at the moment I am rather at loss as to how I must make the 
configuration changes that he suggests.

Kind regards,

Roland Tollenaar





Dear Mr. Tollenaar,



It was good that you called this morning. So I learned a view things 
about how you work with EtherCAT configurations and the use of device 
description files. Thank you.



There are two things you might have to have a look at.

1)    ESC Type in Register 0x0000

    For IO terminals register 0x0000 = 0x01

    For ET1100 register 0x0000 = 0x11

    This is only for master information. Read only information

2)    ESC PDI Type register 0x0140

    Old terminal 0x02

    New terminals 0x04

    Read only information for master use.

3)    SyncManager Control Register 0x0804 +y

    IO terminals 1 buffer mode -> 0x0804 = 0x46

    ET1100 terminals 3 buffer mode -> 0x0804 = 0x44

    This is also described within the device description file.

    During start up the SyncManagers (and FMMUs) shall be configured by 
the master according to the Device Description File. The scan shows that 
the SyncManagers are configured in 1 Buffer     Mode.


       If ET1200 terminals are operated in 1 Buffer Mode they will light 
up once but then the watchdog will expire.

       This is exactly what you have observed.

       To avoid this behaviour please check the ESC type at start up and 
configure the SyncManagers with the values described in the device 
description file which belongs to the terminal. I       attached the 
latest XML file for EL1xxx and EL2xxx Beckhoff terminals.

       I know that this is a little confusing but can easily be resolved 
by using the values of the device description.


From harti_said at yahoo.fr  Tue Aug  7 10:17:53 2007
From: harti_said at yahoo.fr (said harti)
Date: Tue, 7 Aug 2007 10:17:53 +0200 (CEST)
Subject: [Ethercatmaster-users] RE : non-persistent outputs ETG suggestions
In-Reply-To: <46B81B97.3020405@gmail.com>
Message-ID: <758641.93059.qm@web37311.mail.mud.yahoo.com>

Hi Rolland,

I try to understand the ETG Mr Haefele investigation, it seems very interest suggestion...

Can you please send me the  XML  description file ??

Thanks

Said 

Roland Tollenaar <rwatollenaar at gmail.com> a ?crit : Hi Said, Klaas, Tom


ETG Mr Haefele has investigated the matter a bit and his findings are 
stated below. Please tell me how to implement his suggestions with EML 
since at the moment I am rather at loss as to how I must make the 
configuration changes that he suggests.

Kind regards,

Roland Tollenaar





Dear Mr. Tollenaar,



It was good that you called this morning. So I learned a view things 
about how you work with EtherCAT configurations and the use of device 
description files. Thank you.



There are two things you might have to have a look at.

1)    ESC Type in Register 0x0000

    For IO terminals register 0x0000 = 0x01

    For ET1100 register 0x0000 = 0x11

    This is only for master information. Read only information

2)    ESC PDI Type register 0x0140

    Old terminal 0x02

    New terminals 0x04

    Read only information for master use.

3)    SyncManager Control Register 0x0804 +y

    IO terminals 1 buffer mode -> 0x0804 = 0x46

    ET1100 terminals 3 buffer mode -> 0x0804 = 0x44

    This is also described within the device description file.

    During start up the SyncManagers (and FMMUs) shall be configured by 
the master according to the Device Description File. The scan shows that 
the SyncManagers are configured in 1 Buffer     Mode.


       If ET1200 terminals are operated in 1 Buffer Mode they will light 
up once but then the watchdog will expire.

       This is exactly what you have observed.

       To avoid this behaviour please check the ESC type at start up and 
configure the SyncManagers with the values described in the device 
description file which belongs to the terminal. I       attached the 
latest XML file for EL1xxx and EL2xxx Beckhoff terminals.

       I know that this is a little confusing but can easily be resolved 
by using the values of the device description.
_______________________________________________
Ethercatmaster-users mailing list
Ethercatmaster-users at lists.berlios.de
https://lists.berlios.de/mailman/listinfo/ethercatmaster-users


       
---------------------------------
 Stockage illimit? de vos mails avec Yahoo! Mail. Changez aujourd'hui de mail !
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070807/81929a3b/attachment.html>

From rolandtollenaar at gmail.com  Wed Aug  8 19:05:19 2007
From: rolandtollenaar at gmail.com (roland Tollenaar)
Date: Wed, 8 Aug 2007 17:05:19 +0000
Subject: [Ethercatmaster-users] non-persistent outputs problem solved
Message-ID: <bc4264770708081005n1000d069s987b7cb3f1ce29c@mail.gmail.com>

Hi All,

I think the problem is finally sorted. The ETG suggestions contained
the clue, our configuration settings for the symcmanager were
incorrect. EC_QUEUED must be EC_BUFFERED.

An easy solution considering the amount of distress the problem
caused, but, there it is.

Hope this helps others in the future. I'll be glad to expound or offer
whatever assistance I can with anyone experiencing this problem. Even
to people who top-quote their emails. ;)


Regards,

Roland.


From tompanis at skynet.be  Wed Aug  8 19:07:19 2007
From: tompanis at skynet.be (Tom Panis)
Date: Wed, 08 Aug 2007 19:07:19 +0200
Subject: [Ethercatmaster-users] non-persistent outputs ETG suggestions
In-Reply-To: <46B81B97.3020405@gmail.com>
References: <46B81B97.3020405@gmail.com>
Message-ID: <46B9F847.4070801@skynet.be>



Roland Tollenaar schreef:
> Hi Said, Klaas, Tom
>
>
> ETG Mr Haefele has investigated the matter a bit and his findings are 
> stated below. Please tell me how to implement his suggestions with EML 
> since at the moment I am rather at loss as to how I must make the 
> configuration changes that he suggests.
>
>   

Can you post the XML-file on the mailinglist, so we can all take a look
at it?

> Kind regards,
>
> Roland Tollenaar
>
>
>
>
>
> Dear Mr. Tollenaar,
>
>
>
> It was good that you called this morning. So I learned a view things 
> about how you work with EtherCAT configurations and the use of device 
> description files. Thank you.
>
>
>
> There are two things you might have to have a look at.
>
> 1)    ESC Type in Register 0x0000
>
>     For IO terminals register 0x0000 = 0x01
>
>     For ET1100 register 0x0000 = 0x11
>
>     This is only for master information. Read only information
>
> 2)    ESC PDI Type register 0x0140
>
>     Old terminal 0x02
>
>     New terminals 0x04
>
>     Read only information for master use.
>
> 3)    SyncManager Control Register 0x0804 +y
>
>     IO terminals 1 buffer mode -> 0x0804 = 0x46
>
>     ET1100 terminals 3 buffer mode -> 0x0804 = 0x44
>
>     This is also described within the device description file.
>
>     During start up the SyncManagers (and FMMUs) shall be configured by 
> the master according to the Device Description File. The scan shows that 
> the SyncManagers are configured in 1 Buffer     Mode.
>
>
>        If ET1200 terminals are operated in 1 Buffer Mode they will light 
> up once but then the watchdog will expire.
>
>        This is exactly what you have observed.
>
>        To avoid this behaviour please check the ESC type at start up and 
> configure the SyncManagers with the values described in the device 
> description file which belongs to the terminal. I       attached the 
> latest XML file for EL1xxx and EL2xxx Beckhoff terminals.
>
>        I know that this is a little confusing but can easily be resolved 
> by using the values of the device description.
> _______________________________________________
> Ethercatmaster-users mailing list
> Ethercatmaster-users at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>
>   


From rwatollenaar at gmail.com  Thu Aug  9 10:06:02 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Thu, 09 Aug 2007 10:06:02 +0200
Subject: [Ethercatmaster-users] non-persistent outputs ETG suggestions
In-Reply-To: <46B9F847.4070801@skynet.be>
References: <46B81B97.3020405@gmail.com> <46B9F847.4070801@skynet.be>
Message-ID: <46BACAEA.8030705@gmail.com>

Hi Tom,

I did ubt it bounced when I did that. So I sent it again without. I'll 
send it to you off-list

RR

Tom Panis wrote:
> 
> Roland Tollenaar schreef:
>> Hi Said, Klaas, Tom
>>
>>
>> ETG Mr Haefele has investigated the matter a bit and his findings are 
>> stated below. Please tell me how to implement his suggestions with EML 
>> since at the moment I am rather at loss as to how I must make the 
>> configuration changes that he suggests.
>>
>>   
> 
> Can you post the XML-file on the mailinglist, so we can all take a look
> at it?
> 
>> Kind regards,
>>
>> Roland Tollenaar
>>
>>
>>
>>
>>
>> Dear Mr. Tollenaar,
>>
>>
>>
>> It was good that you called this morning. So I learned a view things 
>> about how you work with EtherCAT configurations and the use of device 
>> description files. Thank you.
>>
>>
>>
>> There are two things you might have to have a look at.
>>
>> 1)    ESC Type in Register 0x0000
>>
>>     For IO terminals register 0x0000 = 0x01
>>
>>     For ET1100 register 0x0000 = 0x11
>>
>>     This is only for master information. Read only information
>>
>> 2)    ESC PDI Type register 0x0140
>>
>>     Old terminal 0x02
>>
>>     New terminals 0x04
>>
>>     Read only information for master use.
>>
>> 3)    SyncManager Control Register 0x0804 +y
>>
>>     IO terminals 1 buffer mode -> 0x0804 = 0x46
>>
>>     ET1100 terminals 3 buffer mode -> 0x0804 = 0x44
>>
>>     This is also described within the device description file.
>>
>>     During start up the SyncManagers (and FMMUs) shall be configured by 
>> the master according to the Device Description File. The scan shows that 
>> the SyncManagers are configured in 1 Buffer     Mode.
>>
>>
>>        If ET1200 terminals are operated in 1 Buffer Mode they will light 
>> up once but then the watchdog will expire.
>>
>>        This is exactly what you have observed.
>>
>>        To avoid this behaviour please check the ESC type at start up and 
>> configure the SyncManagers with the values described in the device 
>> description file which belongs to the terminal. I       attached the 
>> latest XML file for EL1xxx and EL2xxx Beckhoff terminals.
>>
>>        I know that this is a little confusing but can easily be resolved 
>> by using the values of the device description.
>> _______________________________________________
>> Ethercatmaster-users mailing list
>> Ethercatmaster-users at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>>
>>   
> _______________________________________________
> Ethercatmaster-users mailing list
> Ethercatmaster-users at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
> 


From rwatollenaar at gmail.com  Thu Aug  9 10:09:14 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Thu, 09 Aug 2007 10:09:14 +0200
Subject: [Ethercatmaster-users] non-persistent outputs ETG suggestions
In-Reply-To: <46B9F847.4070801@skynet.be>
References: <46B81B97.3020405@gmail.com> <46B9F847.4070801@skynet.be>
Message-ID: <46BACBAA.7020504@gmail.com>

Hi Tom,

I have sent the xml files for you benefit in the future. If you can get 
them onto the list for everyone's benefit that would be great.

But please note I sent an email to the list explaining that the problem 
is now sorted. The ETG feedback made me aware of the fact that the 
configuration was wrong after all. Should have been EC_BUFFERED instead 
of EC_QUEUED.

Hope this helps.

Roland

Tom Panis wrote:
> 
> Roland Tollenaar schreef:
>> Hi Said, Klaas, Tom
>>
>>
>> ETG Mr Haefele has investigated the matter a bit and his findings are 
>> stated below. Please tell me how to implement his suggestions with EML 
>> since at the moment I am rather at loss as to how I must make the 
>> configuration changes that he suggests.
>>
>>   
> 
> Can you post the XML-file on the mailinglist, so we can all take a look
> at it?
> 
>> Kind regards,
>>
>> Roland Tollenaar
>>
>>
>>
>>
>>
>> Dear Mr. Tollenaar,
>>
>>
>>
>> It was good that you called this morning. So I learned a view things 
>> about how you work with EtherCAT configurations and the use of device 
>> description files. Thank you.
>>
>>
>>
>> There are two things you might have to have a look at.
>>
>> 1)    ESC Type in Register 0x0000
>>
>>     For IO terminals register 0x0000 = 0x01
>>
>>     For ET1100 register 0x0000 = 0x11
>>
>>     This is only for master information. Read only information
>>
>> 2)    ESC PDI Type register 0x0140
>>
>>     Old terminal 0x02
>>
>>     New terminals 0x04
>>
>>     Read only information for master use.
>>
>> 3)    SyncManager Control Register 0x0804 +y
>>
>>     IO terminals 1 buffer mode -> 0x0804 = 0x46
>>
>>     ET1100 terminals 3 buffer mode -> 0x0804 = 0x44
>>
>>     This is also described within the device description file.
>>
>>     During start up the SyncManagers (and FMMUs) shall be configured by 
>> the master according to the Device Description File. The scan shows that 
>> the SyncManagers are configured in 1 Buffer     Mode.
>>
>>
>>        If ET1200 terminals are operated in 1 Buffer Mode they will light 
>> up once but then the watchdog will expire.
>>
>>        This is exactly what you have observed.
>>
>>        To avoid this behaviour please check the ESC type at start up and 
>> configure the SyncManagers with the values described in the device 
>> description file which belongs to the terminal. I       attached the 
>> latest XML file for EL1xxx and EL2xxx Beckhoff terminals.
>>
>>        I know that this is a little confusing but can easily be resolved 
>> by using the values of the device description.
>> _______________________________________________
>> Ethercatmaster-users mailing list
>> Ethercatmaster-users at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>>
>>   
> _______________________________________________
> Ethercatmaster-users mailing list
> Ethercatmaster-users at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
> 


From rwatollenaar at gmail.com  Thu Aug  9 10:26:48 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Thu, 09 Aug 2007 10:26:48 +0200
Subject: [Ethercatmaster-users] non-persistent outputs, post mortem
In-Reply-To: <557080.30080.qm@web37304.mail.mud.yahoo.com>
References: <557080.30080.qm@web37304.mail.mud.yahoo.com>
Message-ID: <46BACFC8.5080404@gmail.com>

Hi Said,

So your outputs are also working now?

> But can you please explain me the exact differnce between EC_QUEUED and 
> EC_BUFFERED ?
I am nothing of an authority on the topic, but outside of BeckHoff and 
ETG no-one here is so I will give it my best shot.

Apparently data transfer on the slave can take place via two 
configurations of the Syncmanager. A single buffer where a handshaking 
procedure of some kind is used and where the writing side (either master 
or slave) must complete writing before the reading side can read. The 
other method uses tree buffers where there is always consistent data 
available for the reading side to read and space fr the writing side to 
write simultaneously.

you will find some explanantion of this in the documentation I sent you 
earlier.

If anyone has other ideas or a better explanation I am also interested 
in knowing the exact difference. Tom?


Roland



> 
> Said
> 
> */roland Tollenaar <rolandtollenaar at gmail.com>/* a ?crit :
> 
>     Hi All,
> 
>     I think the problem is finally sorted. The ETG suggestions contained
>     the clue, our configuration settings for the symcmanager were
>     incorrect. EC_QUEUED must be EC_BUFFERED.
> 
>     An easy solution considering the amount of distress the problem
>     caused, but, there it is.
> 
>     Hope this helps others in the future. I'll be glad to expound or offer
>     whatever assistance I can with anyone experiencing this problem. Even
>     to people who top-quote their emails. ;)
> 
> 
>     Regards,
> 
>     Roland.
>     _______________________________________________
>     Ethercatmaster-users mailing list
>     Ethercatmaster-users at lists.berlios.de
>     https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
> 
> 
> ------------------------------------------------------------------------
> Stockage illimit? de vos mails avec Yahoo! Mail. Changez aujourd'hui de 
> mail ! <http://fr.promotions.yahoo.com/mail/nouveau_yahoomail2.html>


From harti_said at yahoo.fr  Thu Aug  9 15:47:30 2007
From: harti_said at yahoo.fr (said harti)
Date: Thu, 9 Aug 2007 15:47:30 +0200 (CEST)
Subject: [Ethercatmaster-users] XML configuration File and the master test
	program
Message-ID: <588068.31193.qm@web37310.mail.mud.yahoo.com>

Hello,

thanks to my TwinCAT tool, i can generate the xml configuration file, 
on this file we find all parameters used on the EML test program...

for exemple :

EML function               ===>     EML value              ====>   XML File

EtherCAT_SlaveConfig ===>     a_product_code      ====> <ProductCode>
EtherCAT_SlaveConfig ===>     a_revision               ====> <RevisionNo>
EtherCAT_SlaveConfig ===>     a_station_address   ====> <PhysAddr>

So my question is :

what are XML parameters File which corresponds to EC_FMMU EML function ??


 EML function               ===>     EML value                      ====>   XML File
 
EC_FMMU                  ===>     logical_start_address      ====> ????
EC_FMMU                  ===>     length                            ====> ????
EC_FMMU                  ===>     logical_start_bit              ====> ????
EC_FMMU                  ===>     logical_end_bit               ====> ????
EC_FMMU                  ===>     physical_start_address    ====> ????
EC_FMMU                  ===>     physical_start_bit           ====> ????

Attached, my XML config File

Thanks,

King regards,

Said
 



       
---------------------------------
 Ne gardez plus qu'une seule adresse mail ! Copiez vos mails vers Yahoo! Mail 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070809/d172dd73/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test_2.xml
Type: text/xml
Size: 37275 bytes
Desc: 265615225-test_2.xml
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070809/d172dd73/attachment.xml>

From harti_said at yahoo.fr  Thu Aug  9 15:50:38 2007
From: harti_said at yahoo.fr (said harti)
Date: Thu, 9 Aug 2007 15:50:38 +0200 (CEST)
Subject: [Ethercatmaster-users] XML configuration File and the EML test
	program
Message-ID: <416099.62600.qm@web37311.mail.mud.yahoo.com>

Hello,

thanks to my TwinCAT tool, i can generate the xml configuration file,
on this file we find all parameters used on the EML test program...

for exemple :

EML function               ===>     EML value              ====>   XML File

EtherCAT_SlaveConfig ===>     a_product_code      ====> <ProductCode>
EtherCAT_SlaveConfig ===>     a_revision               ====> <RevisionNo>
EtherCAT_SlaveConfig ===>     a_station_address   ====> <PhysAddr>

So my question is :

what are XML parameters File which corresponds to EC_FMMU EML function ??


EML function               ===>     EML value                      ====>   XML File

EC_FMMU                  ===>     logical_start_address      ====> ????
EC_FMMU                  ===>     length                            ====> ????
EC_FMMU                  ===>     logical_start_bit              ====> ????
EC_FMMU                  ===>     logical_end_bit               ====> ????
EC_FMMU                  ===>     physical_start_address   ====> ????
EC_FMMU                  ===>     physical_start_bit           ====> ????

Attached, my XML config File

Thanks,

King regards,

Said
       
---------------------------------
 Stockage illimit? de vos mails avec Yahoo! Mail. Changez aujourd'hui de mail !
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070809/53c8ae08/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test_2.xml
Type: text/xml
Size: 37275 bytes
Desc: 265615225-test_2.xml
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070809/53c8ae08/attachment.xml>

From tompanis at skynet.be  Thu Aug  9 21:55:31 2007
From: tompanis at skynet.be (Tom Panis)
Date: Thu, 09 Aug 2007 21:55:31 +0200
Subject: [Ethercatmaster-users] non-persistent outputs ETG suggestions
In-Reply-To: <46BACBAA.7020504@gmail.com>
References: <46B81B97.3020405@gmail.com> <46B9F847.4070801@skynet.be>
	<46BACBAA.7020504@gmail.com>
Message-ID: <46BB7133.8030202@skynet.be>


Roland Tollenaar wrote:
> Hi Tom,
>
> I have sent the xml files for you benefit in the future. If you can 
> get them onto the list for everyone's benefit that would be great.

Thanks.

>
> But please note I sent an email to the list explaining that the 
> problem is now sorted. The ETG feedback made me aware of the fact that 
> the configuration was wrong after all. Should have been EC_BUFFERED 
> instead of EC_QUEUED.

Note that the buffer type should only be EC_BUFFERED for the newer 
modules (I thought the revision number of your EL_2004 module was 
0x00100000). For the modules with revision number 0, it still needs to 
be EC_QUEUED. That's the reason why everything worked fine with my 
modules: they have revision number 0.

>
> Hope this helps.




From rwatollenaar at gmail.com  Fri Aug 10 04:38:34 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Fri, 10 Aug 2007 04:38:34 +0200
Subject: [Ethercatmaster-users] XML configuration File and the master
 test	program
In-Reply-To: <588068.31193.qm@web37310.mail.mud.yahoo.com>
References: <588068.31193.qm@web37310.mail.mud.yahoo.com>
Message-ID: <46BBCFAA.6050700@gmail.com>

Hi Said,

I think it would be better to use Tom's installation guide for this. It
would be easier. There he tells you where to look in TwinCat to find the
parameters.

Regards,

Roland



said harti wrote:
> Hello,
> 
> thanks to my TwinCAT tool, i can generate the xml configuration file,
> on this file we find all parameters used on the EML test program...
> 
> for exemple :
> 
> EML function               ===>     EML value              ====>   XML File
> 
> EtherCAT_SlaveConfig ===>     a_product_code      ====> <ProductCode>
> EtherCAT_SlaveConfig ===>     a_revision               ====> <RevisionNo>
> EtherCAT_SlaveConfig ===>     a_station_address   ====> <PhysAddr>
> 
> So my question is :
> 
> what are XML parameters File which corresponds to EC_FMMU EML function ??
> 
> 
> EML function               ===>     EML value                      
> ====>   XML File
> 
> EC_FMMU                  ===>     logical_start_address      ====> ????
> EC_FMMU                  ===>     length                            
> ====> ????
> EC_FMMU                  ===>     logical_start_bit              ====> ????
> EC_FMMU                  ===>     logical_end_bit               ====> ????
> EC_FMMU                  ===>     physical_start_address   ====> ????
> EC_FMMU                  ===>     physical_start_bit           ====> ????
> 
> Attached, my XML config File
> 
> Thanks,
> 
> King regards,
> 
> Said
>  
> 
> 
> ------------------------------------------------------------------------
> Ne gardez plus qu'une seule adresse mail ! Copiez vos mails 
> <http://www.trueswitch.com/yahoo-fr/> vers Yahoo! Mail
> 
> 
> ------------------------------------------------------------------------
> 
> <?xml version="1.0" encoding="ISO8859-1"?>
> <EtherCATConfig><Config><Master><Info><Name><![CDATA[P?riph?rique 4 (EtherCAT)]]></Name><Destination>010105010000</Destination><Source>000e7b56c49a</Source><EtherType>a488</EtherType></Info><InitCmds><InitCmd><Transition>IP</Transition><BeforeSlave>1</BeforeSlave><Comment><![CDATA[read slave count]]></Comment><Requires>cycle</Requires><Cmd>7</Cmd><Adp>0</Adp><Ado>304</Ado><Data>0000</Data><Retries>0</Retries></InitCmd><InitCmd><Transition>IP</Transition><BeforeSlave>1</BeforeSlave><Comment><![CDATA[read slave count]]></Comment><Requires>cycle</Requires><Cmd>7</Cmd><Adp>0</Adp><Ado>304</Ado><Data>0000</Data><Retries>0</Retries></InitCmd><InitCmd><Transition>IP</Transition><BeforeSlave>1</BeforeSlave><Comment><![CDATA[enable ECAT IRQ]]></Comment><Requires>cycle</Requires><Cmd>8</Cmd><Adp>0</Adp><Ado>512</Ado><Data>0400</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><BeforeSlave>1</BeforeSlave><Comment><![CDATA[clear configured addresses]]></Comment><

Req
>  uires>cycle</Requires><Cmd>8</Cmd><Adp>0</Adp><Ado>16</Ado><Data>0000</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><BeforeSlave>1</BeforeSlave><Comment><![CDATA[clear crc register]]></Comment><Requires>cycle</Requires><Cmd>8</Cmd><Adp>0</Adp><Ado>768</Ado><Data>0000000000000000</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><Transition>PI</Transition><Transition>BI</Transition><Transition>SI</Transition><Transition>OI</Transition><BeforeSlave>1</BeforeSlave><Comment><![CDATA[clear fmmu]]></Comment><Requires>cycle</Requires><Cmd>8</Cmd><Adp>0</Adp><Ado>1536</Ado><DataLength>256</DataLength><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><BeforeSlave>1</BeforeSlave><Comment><![CDATA[clear sm]]></Comment><Requires>cycle</Requires><Cmd>8</Cmd><Adp>0</Adp><Ado>2048</Ado><DataLength>256</DataLength><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><BeforeSlave>1</BeforeSlave><Comment><![CDATA[

cle
>  ar dc system time]]></Comment><Requires>cycle</Requires><Cmd>8</Cmd><Adp>0</Adp><Ado>2320</Ado><DataLength>32</DataLength><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><BeforeSlave>1</BeforeSlave><Comment><![CDATA[clear dc cycle cfg]]></Comment><Requires>cycle</Requires><Cmd>8</Cmd><Adp>0</Adp><Ado>2433</Ado><Data>00</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><BeforeSlave>1</BeforeSlave><Comment><![CDATA[reset dc speed]]></Comment><Requires>cycle</Requires><Cmd>8</Cmd><Adp>0</Adp><Ado>2352</Ado><Data>0010</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><BeforeSlave>1</BeforeSlave><Comment><![CDATA[configure dc filter]]></Comment><Requires>cycle</Requires><Cmd>8</Cmd><Adp>0</Adp><Ado>2356</Ado><Data>000c</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><BeforeSlave>1</BeforeSlave><Comment><![CDATA[en/disable second physical address]]></Comment><Requires>cycle</Requires><Cmd>8</C

md>
>  <Adp>0</Adp><Ado>259</Ado><Data>00</Data><Retries>3</Retries></InitCmd></InitCmds></Master><Slave><Info><Name><![CDATA[Terme 1 (EK1100)]]></Name><PhysAddr>1001</PhysAddr><AutoIncAddr>0</AutoIncAddr><Physics>YKY</Physics><VendorId>2</VendorId><ProductCode>72100946</ProductCode><RevisionNo>65536</RevisionNo><SerialNo>0</SerialNo><ProductRevision>EK1100-0000-0001</ProductRevision></Info><InitCmds><InitCmd><Transition>PI</Transition><Transition>BI</Transition><Transition>SI</Transition><Transition>OI</Transition><Comment><![CDATA[set device state to INIT]]></Comment><Requires>cycle</Requires><Cmd>2</Cmd><Adp>0</Adp><Ado>288</Ado><Data>0100</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>PI</Transition><Transition>SI</Transition><Transition>OI</Transition><Comment><![CDATA[check device state for INIT]]></Comment><Requires>cycle</Requires><Cmd>1</Cmd><Adp>0</Adp><Ado>304</Ado><Data>0000</Data><Retries>3</Retries><Validate><Data>0100</Data><DataMask>0f00</DataMask><Time

out
>  >5000</Timeout></Validate></InitCmd><InitCmd><Transition>BI</Transition><Comment><![CDATA[check device state for INIT]]></Comment><Requires>cycle</Requires><Cmd>1</Cmd><Adp>0</Adp><Ado>304</Ado><Data>0000</Data><Retries>3</Retries><Validate><Data>0100</Data><DataMask>0f00</DataMask><Timeout>10000</Timeout></Validate></InitCmd><InitCmd><Transition>IP</Transition><Transition>IB</Transition><Comment><![CDATA[set device state to INIT]]></Comment><Requires>cycle</Requires><Cmd>2</Cmd><Adp>0</Adp><Ado>288</Ado><Data>0100</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><Transition>IB</Transition><Comment><![CDATA[check device state for INIT]]></Comment><Requires>cycle</Requires><Cmd>1</Cmd><Adp>0</Adp><Ado>304</Ado><Data>0000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>0100</Data><DataMask>0f00</DataMask><Timeout>3000</Timeout></Validate></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[assign EEPROM to ECAT]]></Comment

><R
>  equires>cycle</Requires><Cmd>2</Cmd><Adp>0</Adp><Ado>1280</Ado><Data>00</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[check vendor id]]></Comment><Cmd>2</Cmd><Adp>0</Adp><Ado>1282</Ado><Data>000108000000</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[check vendor id]]></Comment><Requires>cycle</Requires><Cmd>1</Cmd><Adp>0</Adp><Ado>1288</Ado><Data>00000000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>02000000</Data><Timeout>100</Timeout></Validate></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[check product code]]></Comment><Cmd>2</Cmd><Adp>0</Adp><Ado>1282</Ado><Data>00010a000000</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[check product code]]></Comment><Requires>cycle</Requires><Cmd>1</Cmd><Adp>0</Adp><Ado>1288</Ado><Data>00000000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate>

<Da
>  ta>522c4c04</Data><Timeout>100</Timeout></Validate></InitCmd><InitCmd><Transition>IP</Transition><Transition>IB</Transition><Comment><![CDATA[set physical address]]></Comment><Requires>cycle</Requires><Cmd>2</Cmd><Adp>0</Adp><Ado>16</Ado><Data>e903</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>SP</Transition><Transition>OP</Transition><Comment><![CDATA[set device state to PREOP]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1001</Adp><Ado>288</Ado><Data>0200</Data><Retries>300</Retries></InitCmd><InitCmd><Transition>OS</Transition><Comment><![CDATA[set device state to SAFEOP]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1001</Adp><Ado>288</Ado><Data>0400</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>SP</Transition><Transition>OP</Transition><Comment><![CDATA[check device state for PREOP]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1001</Adp><Ado>304</Ado><Data>000000000000</Data><Retries>3</Retries><Validate><Da

ta>
>  020000000000</Data><DataMask>1f0000000000</DataMask><Timeout>5000</Timeout></Validate></InitCmd><InitCmd><Transition>IP</Transition><Transition>IB</Transition><Comment><![CDATA[assign EEPROM to PDI]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1001</Adp><Ado>1280</Ado><Data>01</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>II</Transition><Comment><![CDATA[assign EEPROM back to ECAT]]></Comment><Requires>cycle</Requires><Cmd>2</Cmd><Adp>0</Adp><Ado>1280</Ado><Data>00</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[set device state to PREOP]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1001</Adp><Ado>288</Ado><Data>0200</Data><Cnt>1</Cnt><Retries>300</Retries></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[check device state for PREOP]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1001</Adp><Ado>304</Ado><Data>000000000000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate

><D
>  ata>020000000000</Data><DataMask>1f0000000000</DataMask><Timeout>3000</Timeout></Validate></InitCmd><InitCmd><Transition>IP</Transition><Transition>BI</Transition><Comment><![CDATA[assign EEPROM back to ECAT]]></Comment><Requires>cycle</Requires><Cmd>2</Cmd><Adp>0</Adp><Ado>1280</Ado><Data>00</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>IB</Transition><Comment><![CDATA[set device state to BOOT]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1001</Adp><Ado>288</Ado><Data>0300</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>IB</Transition><Comment><![CDATA[check device state for BOOT]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1001</Adp><Ado>304</Ado><Data>000000000000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>030000000000</Data><DataMask>1f0000000000</DataMask><Timeout>3000</Timeout></Validate></InitCmd><InitCmd><Transition>PS</Transition><Comment><![CDATA[set device state to SAFEOP]]></Comment><Requires>cycle<

/Re
>  quires><Cmd>5</Cmd><Adp>1001</Adp><Ado>288</Ado><Data>0400</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>PS</Transition><Comment><![CDATA[check device state for SAFEOP]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1001</Adp><Ado>304</Ado><Data>000000000000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>040000000000</Data><DataMask>1f0000000000</DataMask><Timeout>10000</Timeout></Validate></InitCmd><InitCmd><Transition>OS</Transition><Comment><![CDATA[check device state for SAFEOP]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1001</Adp><Ado>304</Ado><Data>000000000000</Data><Retries>3</Retries><Validate><Data>040000000000</Data><DataMask>1f0000000000</DataMask><Timeout>200</Timeout></Validate></InitCmd><InitCmd><Transition>SO</Transition><Comment><![CDATA[set device state to OP]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1001</Adp><Ado>288</Ado><Data>0800</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Tr

ans
>  ition>SO</Transition><Comment><![CDATA[check device state for OP]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1001</Adp><Ado>304</Ado><Data>000000000000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>080000000000</Data><DataMask>1f0000000000</DataMask><Timeout>10000</Timeout></Validate></InitCmd></InitCmds></Slave><Slave><Info><Name><![CDATA[Terme 2 (EL1004)]]></Name><PhysAddr>1002</PhysAddr><AutoIncAddr>65535</AutoIncAddr><Physics>KK</Physics><VendorId>2</VendorId><ProductCode>65810514</ProductCode><RevisionNo>1048576</RevisionNo><SerialNo>0</SerialNo><ProductRevision>EL1004-0000-0016</ProductRevision></Info><ProcessData><Recv><BitStart>312</BitStart><BitLength>4</BitLength></Recv><Sm0><Type>Inputs</Type><StartAddress>4096</StartAddress><ControlByte>0</ControlByte><Enable>0</Enable><Pdo>6656</Pdo><Pdo>6657</Pdo><Pdo>6658</Pdo><Pdo>6659</Pdo></Sm0><TxPdo Fixed="1" Mandatory="1" Sm="0"><Index>#x1a00</Index><Name>Channel 1</Name><Entry><Index>#x6000</Index>

<Su
>  bIndex>1</SubIndex><BitLen>1</BitLen><Name>Input</Name><DataType>BOOL</DataType></Entry></TxPdo><TxPdo Fixed="1" Mandatory="1" Sm="0"><Index>#x1a01</Index><Name>Channel 2</Name><Entry><Index>#x6010</Index><SubIndex>1</SubIndex><BitLen>1</BitLen><Name>Input</Name><DataType>BOOL</DataType></Entry></TxPdo><TxPdo Fixed="1" Mandatory="1" Sm="0"><Index>#x1a02</Index><Name>Channel 3</Name><Entry><Index>#x6020</Index><SubIndex>1</SubIndex><BitLen>1</BitLen><Name>Input</Name><DataType>BOOL</DataType></Entry></TxPdo><TxPdo Fixed="1" Mandatory="1" Sm="0"><Index>#x1a03</Index><Name>Channel 4</Name><Entry><Index>#x6030</Index><SubIndex>1</SubIndex><BitLen>1</BitLen><Name>Input</Name><DataType>BOOL</DataType></Entry></TxPdo></ProcessData><InitCmds><InitCmd><Transition>PI</Transition><Transition>BI</Transition><Transition>SI</Transition><Transition>OI</Transition><Comment><![CDATA[set device state to INIT]]></Comment><Requires>cycle</Requires><Cmd>2</Cmd><Adp>65535</Adp><Ado>288</Ado><D

ata
>  >0100</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>PI</Transition><Transition>SI</Transition><Transition>OI</Transition><Comment><![CDATA[check device state for INIT]]></Comment><Requires>cycle</Requires><Cmd>1</Cmd><Adp>65535</Adp><Ado>304</Ado><Data>0000</Data><Retries>3</Retries><Validate><Data>0100</Data><DataMask>0f00</DataMask><Timeout>5000</Timeout></Validate></InitCmd><InitCmd><Transition>BI</Transition><Comment><![CDATA[check device state for INIT]]></Comment><Requires>cycle</Requires><Cmd>1</Cmd><Adp>65535</Adp><Ado>304</Ado><Data>0000</Data><Retries>3</Retries><Validate><Data>0100</Data><DataMask>0f00</DataMask><Timeout>10000</Timeout></Validate></InitCmd><InitCmd><Transition>IP</Transition><Transition>IB</Transition><Comment><![CDATA[set device state to INIT]]></Comment><Requires>cycle</Requires><Cmd>2</Cmd><Adp>65535</Adp><Ado>288</Ado><Data>0100</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><Transition>IB</Tr

ans
>  ition><Comment><![CDATA[check device state for INIT]]></Comment><Requires>cycle</Requires><Cmd>1</Cmd><Adp>65535</Adp><Ado>304</Ado><Data>0000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>0100</Data><DataMask>0f00</DataMask><Timeout>3000</Timeout></Validate></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[assign EEPROM to ECAT]]></Comment><Requires>cycle</Requires><Cmd>2</Cmd><Adp>65535</Adp><Ado>1280</Ado><Data>00</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[check vendor id]]></Comment><Cmd>2</Cmd><Adp>65535</Adp><Ado>1282</Ado><Data>000108000000</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[check vendor id]]></Comment><Requires>cycle</Requires><Cmd>1</Cmd><Adp>65535</Adp><Ado>1288</Ado><Data>00000000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>02000000</Data><Timeout>100</Timeout></Validate></InitCmd><InitCmd><Transition>IP</

Tra
>  nsition><Comment><![CDATA[check product code]]></Comment><Cmd>2</Cmd><Adp>65535</Adp><Ado>1282</Ado><Data>00010a000000</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[check product code]]></Comment><Requires>cycle</Requires><Cmd>1</Cmd><Adp>65535</Adp><Ado>1288</Ado><Data>00000000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>5230ec03</Data><Timeout>100</Timeout></Validate></InitCmd><InitCmd><Transition>IP</Transition><Transition>IB</Transition><Comment><![CDATA[set physical address]]></Comment><Requires>cycle</Requires><Cmd>2</Cmd><Adp>65535</Adp><Ado>16</Ado><Data>ea03</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>SP</Transition><Transition>OP</Transition><Comment><![CDATA[set device state to PREOP]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1002</Adp><Ado>288</Ado><Data>0200</Data><Retries>300</Retries></InitCmd><InitCmd><Transition>IP</Transition><Transition>SP</Transition>

<Tr
>  ansition>SI</Transition><Transition>OP</Transition><Transition>OI</Transition><Comment><![CDATA[clear sms]]></Comment><Cmd>5</Cmd><Adp>1002</Adp><Ado>2048</Ado><Data>0000000000000000</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>PS</Transition><Comment><![CDATA[set sm 0 (inputs)]]></Comment><Cmd>5</Cmd><Adp>1002</Adp><Ado>2048</Ado><Data>0010010000000100</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>PS</Transition><Comment><![CDATA[set fmmu 0 (inputs)]]></Comment><Cmd>5</Cmd><Adp>1002</Adp><Ado>1536</Ado><Data>00080100010000030010000101000000</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>OS</Transition><Comment><![CDATA[set device state to SAFEOP]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1002</Adp><Ado>288</Ado><Data>0400</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>SP</Transition><Transition>SI</Transition><Transition>OP</Transition><Transition>OI</Transition><Comment><![CDATA[clear fmmu 0]

]><
>  /Comment><Cmd>5</Cmd><Adp>1002</Adp><Ado>1536</Ado><Data>00000000000000000000000000000000</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>SP</Transition><Transition>OP</Transition><Comment><![CDATA[check device state for PREOP]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1002</Adp><Ado>304</Ado><Data>000000000000</Data><Retries>3</Retries><Validate><Data>020000000000</Data><DataMask>1f0000000000</DataMask><Timeout>5000</Timeout></Validate></InitCmd><InitCmd><Transition>IP</Transition><Transition>IB</Transition><Comment><![CDATA[assign EEPROM to PDI]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1002</Adp><Ado>1280</Ado><Data>01</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>II</Transition><Comment><![CDATA[assign EEPROM back to ECAT]]></Comment><Requires>cycle</Requires><Cmd>2</Cmd><Adp>65535</Adp><Ado>1280</Ado><Data>00</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[set device sta

te
>  to PREOP]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1002</Adp><Ado>288</Ado><Data>0200</Data><Cnt>1</Cnt><Retries>300</Retries></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[check device state for PREOP]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1002</Adp><Ado>304</Ado><Data>000000000000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>020000000000</Data><DataMask>1f0000000000</DataMask><Timeout>3000</Timeout></Validate></InitCmd><InitCmd><Transition>IP</Transition><Transition>BI</Transition><Comment><![CDATA[assign EEPROM back to ECAT]]></Comment><Requires>cycle</Requires><Cmd>2</Cmd><Adp>65535</Adp><Ado>1280</Ado><Data>00</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>IB</Transition><Comment><![CDATA[set device state to BOOT]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1002</Adp><Ado>288</Ado><Data>0300</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>IB</Transition><Comment><![CDATA[c

hec
>  k device state for BOOT]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1002</Adp><Ado>304</Ado><Data>000000000000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>030000000000</Data><DataMask>1f0000000000</DataMask><Timeout>3000</Timeout></Validate></InitCmd><InitCmd><Transition>PS</Transition><Comment><![CDATA[set device state to SAFEOP]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1002</Adp><Ado>288</Ado><Data>0400</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>PS</Transition><Comment><![CDATA[check device state for SAFEOP]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1002</Adp><Ado>304</Ado><Data>000000000000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>040000000000</Data><DataMask>1f0000000000</DataMask><Timeout>10000</Timeout></Validate></InitCmd><InitCmd><Transition>OS</Transition><Comment><![CDATA[check device state for SAFEOP]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1002</Adp><Ado>304</Ado

><D
>  ata>000000000000</Data><Retries>3</Retries><Validate><Data>040000000000</Data><DataMask>1f0000000000</DataMask><Timeout>200</Timeout></Validate></InitCmd><InitCmd><Transition>SO</Transition><Comment><![CDATA[set device state to OP]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1002</Adp><Ado>288</Ado><Data>0800</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>SO</Transition><Comment><![CDATA[check device state for OP]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1002</Adp><Ado>304</Ado><Data>000000000000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>080000000000</Data><DataMask>1f0000000000</DataMask><Timeout>10000</Timeout></Validate></InitCmd></InitCmds><PreviousPort Selected="1"><Port>B</Port><PhysAddr>1001</PhysAddr></PreviousPort></Slave><Slave><Info><Name><![CDATA[Terme 3 (EL2004)]]></Name><PhysAddr>1003</PhysAddr><AutoIncAddr>65534</AutoIncAddr><Physics>KK</Physics><VendorId>2</VendorId><ProductCode>131346514</ProductCod

e><
>  RevisionNo>1048576</RevisionNo><SerialNo>0</SerialNo><ProductRevision>EL2004-0000-0016</ProductRevision></Info><ProcessData><Send><BitStart>208</BitStart><BitLength>4</BitLength></Send><Sm0><Type>Outputs</Type><StartAddress>3840</StartAddress><ControlByte>68</ControlByte><Enable>1</Enable><Pdo>5632</Pdo><Pdo>5633</Pdo><Pdo>5634</Pdo><Pdo>5635</Pdo></Sm0><RxPdo Fixed="1" Mandatory="1" Sm="0"><Index>#x1600</Index><Name>Channel 1</Name><Entry><Index>#x7000</Index><SubIndex>1</SubIndex><BitLen>1</BitLen><Name>Output</Name><DataType>BOOL</DataType></Entry></RxPdo><RxPdo Fixed="1" Mandatory="1" Sm="0"><Index>#x1601</Index><Name>Channel 2</Name><Entry><Index>#x7010</Index><SubIndex>1</SubIndex><BitLen>1</BitLen><Name>Output</Name><DataType>BOOL</DataType></Entry></RxPdo><RxPdo Fixed="1" Mandatory="1" Sm="0"><Index>#x1602</Index><Name>Channel 3</Name><Entry><Index>#x7020</Index><SubIndex>1</SubIndex><BitLen>1</BitLen><Name>Output</Name><DataType>BOOL</DataType></Entry></RxPdo><Rx

Pdo
>   Fixed="1" Mandatory="1" Sm="0"><Index>#x1603</Index><Name>Channel 4</Name><Entry><Index>#x7030</Index><SubIndex>1</SubIndex><BitLen>1</BitLen><Name>Output</Name><DataType>BOOL</DataType></Entry></RxPdo></ProcessData><InitCmds><InitCmd><Transition>PI</Transition><Transition>BI</Transition><Transition>SI</Transition><Transition>OI</Transition><Comment><![CDATA[set device state to INIT]]></Comment><Requires>cycle</Requires><Cmd>2</Cmd><Adp>65534</Adp><Ado>288</Ado><Data>0100</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>PI</Transition><Transition>SI</Transition><Transition>OI</Transition><Comment><![CDATA[check device state for INIT]]></Comment><Requires>cycle</Requires><Cmd>1</Cmd><Adp>65534</Adp><Ado>304</Ado><Data>0000</Data><Retries>3</Retries><Validate><Data>0100</Data><DataMask>0f00</DataMask><Timeout>5000</Timeout></Validate></InitCmd><InitCmd><Transition>BI</Transition><Comment><![CDATA[check device state for INIT]]></Comment><Requires>cycle</Requires><Cm

d>1
>  </Cmd><Adp>65534</Adp><Ado>304</Ado><Data>0000</Data><Retries>3</Retries><Validate><Data>0100</Data><DataMask>0f00</DataMask><Timeout>10000</Timeout></Validate></InitCmd><InitCmd><Transition>IP</Transition><Transition>IB</Transition><Comment><![CDATA[set device state to INIT]]></Comment><Requires>cycle</Requires><Cmd>2</Cmd><Adp>65534</Adp><Ado>288</Ado><Data>0100</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><Transition>IB</Transition><Comment><![CDATA[check device state for INIT]]></Comment><Requires>cycle</Requires><Cmd>1</Cmd><Adp>65534</Adp><Ado>304</Ado><Data>0000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>0100</Data><DataMask>0f00</DataMask><Timeout>3000</Timeout></Validate></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[assign EEPROM to ECAT]]></Comment><Requires>cycle</Requires><Cmd>2</Cmd><Adp>65534</Adp><Ado>1280</Ado><Data>00</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>IP

</T
>  ransition><Comment><![CDATA[check vendor id]]></Comment><Cmd>2</Cmd><Adp>65534</Adp><Ado>1282</Ado><Data>000108000000</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[check vendor id]]></Comment><Requires>cycle</Requires><Cmd>1</Cmd><Adp>65534</Adp><Ado>1288</Ado><Data>00000000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>02000000</Data><Timeout>100</Timeout></Validate></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[check product code]]></Comment><Cmd>2</Cmd><Adp>65534</Adp><Ado>1282</Ado><Data>00010a000000</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[check product code]]></Comment><Requires>cycle</Requires><Cmd>1</Cmd><Adp>65534</Adp><Ado>1288</Ado><Data>00000000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>5230d407</Data><Timeout>100</Timeout></Validate></InitCmd><InitCmd><Transition>IP</Transition><Transition>IB</Transition><Co

mme
>  nt><![CDATA[set physical address]]></Comment><Requires>cycle</Requires><Cmd>2</Cmd><Adp>65534</Adp><Ado>16</Ado><Data>eb03</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>SP</Transition><Transition>OP</Transition><Comment><![CDATA[set device state to PREOP]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1003</Adp><Ado>288</Ado><Data>0200</Data><Retries>300</Retries></InitCmd><InitCmd><Transition>IP</Transition><Transition>SP</Transition><Transition>SI</Transition><Transition>OP</Transition><Transition>OI</Transition><Comment><![CDATA[clear sms]]></Comment><Cmd>5</Cmd><Adp>1003</Adp><Ado>2048</Ado><Data>0000000000000000</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>OS</Transition><Comment><![CDATA[clear output sm]]></Comment><Cmd>5</Cmd><Adp>1003</Adp><Ado>2048</Ado><Data>0000000000000000</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>SO</Transition><Comment><![CDATA[set sm 0 (outputs)]]></Comment><Cmd>5</Cmd><Adp>1003</Adp>

<Ad
>  o>2048</Ado><Data>000f010044000100</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>PS</Transition><Comment><![CDATA[set fmmu 0 (outputs)]]></Comment><Cmd>5</Cmd><Adp>1003</Adp><Ado>1536</Ado><Data>0000010001000003000f000201000000</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>OS</Transition><Comment><![CDATA[set device state to SAFEOP]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1003</Adp><Ado>288</Ado><Data>0400</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>SP</Transition><Transition>SI</Transition><Transition>OP</Transition><Transition>OI</Transition><Comment><![CDATA[clear fmmu 0]]></Comment><Cmd>5</Cmd><Adp>1003</Adp><Ado>1536</Ado><Data>00000000000000000000000000000000</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>SP</Transition><Transition>OP</Transition><Comment><![CDATA[check device state for PREOP]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1003</Adp><Ado>304</Ado><Data>00000000

000
>  0</Data><Retries>3</Retries><Validate><Data>020000000000</Data><DataMask>1f0000000000</DataMask><Timeout>5000</Timeout></Validate></InitCmd><InitCmd><Transition>IP</Transition><Transition>IB</Transition><Comment><![CDATA[assign EEPROM to PDI]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1003</Adp><Ado>1280</Ado><Data>01</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>II</Transition><Comment><![CDATA[assign EEPROM back to ECAT]]></Comment><Requires>cycle</Requires><Cmd>2</Cmd><Adp>65534</Adp><Ado>1280</Ado><Data>00</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[set device state to PREOP]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1003</Adp><Ado>288</Ado><Data>0200</Data><Cnt>1</Cnt><Retries>300</Retries></InitCmd><InitCmd><Transition>IP</Transition><Comment><![CDATA[check device state for PREOP]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1003</Adp><Ado>304</Ado><Data>000000000000

</D
>  ata><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>020000000000</Data><DataMask>1f0000000000</DataMask><Timeout>3000</Timeout></Validate></InitCmd><InitCmd><Transition>IP</Transition><Transition>BI</Transition><Comment><![CDATA[assign EEPROM back to ECAT]]></Comment><Requires>cycle</Requires><Cmd>2</Cmd><Adp>65534</Adp><Ado>1280</Ado><Data>00</Data><Retries>3</Retries></InitCmd><InitCmd><Transition>IB</Transition><Comment><![CDATA[set device state to BOOT]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1003</Adp><Ado>288</Ado><Data>0300</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>IB</Transition><Comment><![CDATA[check device state for BOOT]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1003</Adp><Ado>304</Ado><Data>000000000000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>030000000000</Data><DataMask>1f0000000000</DataMask><Timeout>3000</Timeout></Validate></InitCmd><InitCmd><Transition>PS</Transition><Comment><![CDATA[set

de
>  vice state to SAFEOP]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1003</Adp><Ado>288</Ado><Data>0400</Data><Cnt>1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>PS</Transition><Comment><![CDATA[check device state for SAFEOP]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1003</Adp><Ado>304</Ado><Data>000000000000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>040000000000</Data><DataMask>1f0000000000</DataMask><Timeout>10000</Timeout></Validate></InitCmd><InitCmd><Transition>OS</Transition><Comment><![CDATA[check device state for SAFEOP]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1003</Adp><Ado>304</Ado><Data>000000000000</Data><Retries>3</Retries><Validate><Data>040000000000</Data><DataMask>1f0000000000</DataMask><Timeout>200</Timeout></Validate></InitCmd><InitCmd><Transition>SO</Transition><Comment><![CDATA[set device state to OP]]></Comment><Requires>cycle</Requires><Cmd>5</Cmd><Adp>1003</Adp><Ado>288</Ado><Data>0800</Data><C

nt>
>  1</Cnt><Retries>3</Retries></InitCmd><InitCmd><Transition>SO</Transition><Comment><![CDATA[check device state for OP]]></Comment><Requires>cycle</Requires><Cmd>4</Cmd><Adp>1003</Adp><Ado>304</Ado><Data>000000000000</Data><Cnt>1</Cnt><Retries>3</Retries><Validate><Data>080000000000</Data><DataMask>1f0000000000</DataMask><Timeout>10000</Timeout></Validate></InitCmd></InitCmds><PreviousPort Selected="1"><Port>B</Port><PhysAddr>1002</PhysAddr></PreviousPort></Slave><Slave><Info><Name><![CDATA[Terme 4 (EL9010)]]></Name><VendorId>2</VendorId><ProductCode>590491728</ProductCode><RevisionNo>0</RevisionNo><SerialNo>0</SerialNo><ProductRevision>EL9010</ProductRevision></Info><InitCmds/></Slave><Cyclic><Frame><Cmd><State>SAFEOP</State><State>OP</State><Comment><![CDATA[cyclic cmd]]></Comment><Cmd>11</Cmd><Addr>65536</Addr><DataLength>1</DataLength><Cnt>1</Cnt><InputOffs>16</InputOffs><OutputOffs>16</OutputOffs></Cmd><Cmd><State>SAFEOP</State><State>OP</State><Comment><![CDATA[cyclic

cm
>  d]]></Comment><Cmd>10</Cmd><Addr>67584</Addr><DataLength>1</DataLength><Cnt>1</Cnt><InputOffs>29</InputOffs><OutputOffs>29</OutputOffs></Cmd><Cmd><State>PREOP</State><State>SAFEOP</State><State>OP</State><Comment><![CDATA[cyclic cmd]]></Comment><Cmd>7</Cmd><Adp>0</Adp><Ado>304</Ado><DataLength>2</DataLength><Cnt>3</Cnt><InputOffs>42</InputOffs><OutputOffs>42</OutputOffs></Cmd></Frame></Cyclic><ProcessImage><Inputs><ByteSize>1536</ByteSize><Variable><Name>Terme 2 (EL1004).Channel 1.Input</Name><DataType>BOOL</DataType><BitSize>1</BitSize><BitOffs>312</BitOffs></Variable><Variable><Name>Terme 2 (EL1004).Channel 2.Input</Name><DataType>BOOL</DataType><BitSize>1</BitSize><BitOffs>313</BitOffs></Variable><Variable><Name>Terme 2 (EL1004).Channel 3.Input</Name><DataType>BOOL</DataType><BitSize>1</BitSize><BitOffs>314</BitOffs></Variable><Variable><Name>Terme 2 (EL1004).Channel 4.Input</Name><DataType>BOOL</DataType><BitSize>1</BitSize><BitOffs>315</BitOffs></Variable><Variable><

Nam
>  e>Entr?es.Frm0State</Name><Comment><![CDATA[0x0001 = 1. EtherCAT command not sent (NOP requested)
> 0x0002 = 2. EtherCAT command not sent (NOP requested)
> 0x0004 = 3. EtherCAT command not sent (NOP requested)
> ...
> 0x4000 = 15. EtherCAT command not sent (NOP requested)
> 0x8000 = complete frame not sent
> ]]></Comment><DataType>UINT</DataType><BitSize>16</BitSize><BitOffs>12160</BitOffs></Variable><Variable><Name>Entr?es.Frm0WcState</Name><Comment><![CDATA[0x0001 = wrong working counter of 1. EtherCAT command received
> 0x0002 = wrong working counter of 2. EtherCAT command received
> 0x0004 = wrong working counter of 3. EtherCAT command received
> ...
> 0x4000 = wrong working counter of 15. EtherCAT command received
> 0x8000 = complete frame missing
> ]]></Comment><DataType>UINT</DataType><BitSize>16</BitSize><BitOffs>12176</BitOffs></Variable><Variable><Name>Terme 3 (EL2004).WcState.WcState</Name><Comment><![CDATA[0 = Data valid
> 1 = Data invalid
> ]]></Comment><DataType>BOOL</DataType><BitSize>1</BitSize><BitOffs>12176</BitOffs></Variable><Variable><Name>Terme 2 (EL1004).WcState.WcState</Name><Comment><![CDATA[0 = Data valid
> 1 = Data invalid
> ]]></Comment><DataType>BOOL</DataType><BitSize>1</BitSize><BitOffs>12177</BitOffs></Variable><Variable><Name>Entr?es.SlaveCount</Name><Comment><![CDATA[Actual count of EtherCAT slaves received]]></Comment><DataType>UINT</DataType><BitSize>16</BitSize><BitOffs>12240</BitOffs></Variable><Variable><Name>Entr?es.DevState</Name><Comment><![CDATA[0x0001 = Link error
> 0x0002 = I/O locked after link error (I/O reset required)
> 0x0004 = Link error (redundancy adapter)
> 0x0008 = Missing one frame (redundancy mode)
> 0x0010 = Out of send resources (I/O reset required)
> 0x0020 = Watchdog triggered
> 0x0040 = Ethernet driver (miniport) not found
> 0x0080 = I/O reset active
> 0x0100 = At least one device in 'INIT' state
> 0x0200 = At least one device in 'PRE-OP' state
> 0x0400 = At least one device in 'SAFE-OP' state
> 0x0800 = At least one device indicates an error state
> 0x1000 = DC not in sync
> ]]></Comment><DataType>UINT</DataType><BitSize>16</BitSize><BitOffs>12272</BitOffs></Variable><Variable><Name>InfoData.ChangeCount</Name><Comment><![CDATA[Info data change counter]]></Comment><DataType>UINT</DataType><BitSize>16</BitSize><BitOffs>12288</BitOffs></Variable><Variable><Name>InfoData.DevId</Name><Comment><![CDATA[DeviceId of EtherCAT device]]></Comment><DataType>UINT</DataType><BitSize>16</BitSize><BitOffs>12304</BitOffs></Variable><Variable><Name>InfoData.AmsNetId</Name><Comment><![CDATA[AmsNetId of EtherCAT device]]></Comment><DataType>ARRAY [0..5] OF USINT</DataType><BitSize>48</BitSize><BitOffs>12320</BitOffs></Variable><Variable><Name>InfoData.CfgSlaveCount</Name><Comment><![CDATA[Count of configured EtherCAT slaves]]></Comment><DataType>UINT</DataType><BitSize>16</BitSize><BitOffs>12368</BitOffs></Variable><Variable><Name>Terme 1 (EK1100).InfoData.State</Name><Comment><![CDATA[0x___1 = Slave in 'INIT' state
> 0x___2 = Slave in 'PREOP' state
> 0x___3 = Slave in 'BOOT' state
> 0x___4 = Slave in 'SAFEOP' state
> 0x___8 = Slave in 'OP' state
> 0x001_ = Slave signals error
> 0x002_ = Invalid vendorId, productCode... read
> 0x004_ = Initialization error occurred
> 0x010_ = Slave not present
> 0x020_ = Slave signals link error
> 0x040_ = Slave signals missing link
> 0x080_ = Slave signals unexpected link
> 0x100_ = Communication port A
> 0x200_ = Communication port B
> 0x400_ = Communication port C
> 0x800_ = Communication port D
> ]]></Comment><DataType>UINT</DataType><BitSize>16</BitSize><BitOffs>12384</BitOffs></Variable><Variable><Name>Terme 2 (EL1004).InfoData.State</Name><Comment><![CDATA[0x___1 = Slave in 'INIT' state
> 0x___2 = Slave in 'PREOP' state
> 0x___3 = Slave in 'BOOT' state
> 0x___4 = Slave in 'SAFEOP' state
> 0x___8 = Slave in 'OP' state
> 0x001_ = Slave signals error
> 0x002_ = Invalid vendorId, productCode... read
> 0x004_ = Initialization error occurred
> 0x010_ = Slave not present
> 0x020_ = Slave signals link error
> 0x040_ = Slave signals missing link
> 0x080_ = Slave signals unexpected link
> 0x100_ = Communication port A
> 0x200_ = Communication port B
> 0x400_ = Communication port C
> 0x800_ = Communication port D
> ]]></Comment><DataType>UINT</DataType><BitSize>16</BitSize><BitOffs>12400</BitOffs></Variable><Variable><Name>Terme 3 (EL2004).InfoData.State</Name><Comment><![CDATA[0x___1 = Slave in 'INIT' state
> 0x___2 = Slave in 'PREOP' state
> 0x___3 = Slave in 'BOOT' state
> 0x___4 = Slave in 'SAFEOP' state
> 0x___8 = Slave in 'OP' state
> 0x001_ = Slave signals error
> 0x002_ = Invalid vendorId, productCode... read
> 0x004_ = Initialization error occurred
> 0x010_ = Slave not present
> 0x020_ = Slave signals link error
> 0x040_ = Slave signals missing link
> 0x080_ = Slave signals unexpected link
> 0x100_ = Communication port A
> 0x200_ = Communication port B
> 0x400_ = Communication port C
> 0x800_ = Communication port D
> ]]></Comment><DataType>UINT</DataType><BitSize>16</BitSize><BitOffs>12416</BitOffs></Variable></Inputs><Outputs><ByteSize>1536</ByteSize><Variable><Name>Terme 3 (EL2004).Channel 1.Output</Name><DataType>BOOL</DataType><BitSize>1</BitSize><BitOffs>208</BitOffs></Variable><Variable><Name>Terme 3 (EL2004).Channel 2.Output</Name><DataType>BOOL</DataType><BitSize>1</BitSize><BitOffs>209</BitOffs></Variable><Variable><Name>Terme 3 (EL2004).Channel 3.Output</Name><DataType>BOOL</DataType><BitSize>1</BitSize><BitOffs>210</BitOffs></Variable><Variable><Name>Terme 3 (EL2004).Channel 4.Output</Name><DataType>BOOL</DataType><BitSize>1</BitSize><BitOffs>211</BitOffs></Variable><Variable><Name>Sorties.Frm0Ctrl</Name><Comment><![CDATA[0x0001 = prevent 1. EtherCAT command from sending (request NOP)
> 0x0002 = prevent 2. EtherCAT command from sending (request NOP)
> 0x0004 = prevent 3. EtherCAT command from sending (request NOP)
> ...
> 0x4000 = prevent 15. EtherCAT command from sending (request NOP)
> 0x8000 = prevent complete frame from sending
> ]]></Comment><DataType>UINT</DataType><BitSize>16</BitSize><BitOffs>12160</BitOffs></Variable><Variable><Name>Sorties.Frm0WcCtrl</Name><Comment><![CDATA[0x0001 = copy data with wrong working counter of 1. EtherCAT command
> 0x0002 = copy data with wrong working counter of 2. EtherCAT command
> 0x0004 = copy data with wrong working counter of 3. EtherCAT command
> ...
> 0x4000 = copy data with wrong working counter of 15. EtherCAT command
> ]]></Comment><DataType>UINT</DataType><BitSize>16</BitSize><BitOffs>12176</BitOffs></Variable><Variable><Name>Sorties.DevCtrl</Name><DataType>UINT</DataType><BitSize>16</BitSize><BitOffs>12272</BitOffs></Variable></Outputs></ProcessImage></Config></EtherCATConfig>
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Ethercatmaster-users mailing list
> Ethercatmaster-users at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users



From harti_said at yahoo.fr  Fri Aug 10 08:56:50 2007
From: harti_said at yahoo.fr (said harti)
Date: Fri, 10 Aug 2007 08:56:50 +0200 (CEST)
Subject: [Ethercatmaster-users] RE : Re: XML configuration File and the
	master test program
In-Reply-To: <46BBCE22.6010406@tosec.nl>
Message-ID: <424084.96445.qm@web37302.mail.mud.yahoo.com>



Roland Tollenaar <r.tollenaar at tosec.nl> a ?crit : Hi Said,

I think it would be better to use Tom's installation guide for this. It 
would be easier. There he tells you where to look in TwinCat to find the 
parameters.

Regards,

Roland

I think that the Tom's intallation guide don't use XML file...(i am not sure !!!)
I want use this XML file, because i developpe a C++ parser with TINYXML library, in order to parameters the EML program automaticly...

So i need to know the location of FMMU parameters on the XML File.
I can parse (locate) all other parameters, like PD SynManager, and Mbx SyncManager, but i need to trake also the FMMU parameters on the XML file.

You can take a look to my XML file, if you have some ideas, let me know...

Regards, 

Said


said harti wrote:
> Hello,
> 
> thanks to my TwinCAT tool, i can generate the xml configuration file,
> on this file we find all parameters used on the EML test program...
> 
> for exemple :
> 
> EML function               ===>     EML value              ====>   XML File
> 
> EtherCAT_SlaveConfig ===>     a_product_code      ====> 

> EtherCAT_SlaveConfig ===>     a_revision               ====> 
> EtherCAT_SlaveConfig ===>     a_station_address   ====> 

> 
> So my question is :
> 
> what are XML parameters File which corresponds to EC_FMMU EML function ??
> 
> 
> EML function               ===>     EML value                      
> ====>   XML File
> 
> EC_FMMU                  ===>     logical_start_address      ====> ????
> EC_FMMU                  ===>     length                            
> ====> ????
> EC_FMMU                  ===>     logical_start_bit              ====> ????
> EC_FMMU                  ===>     logical_end_bit               ====> ????
> EC_FMMU                  ===>     physical_start_address   ====> ????
> EC_FMMU                  ===>     physical_start_bit           ====> ????
> 
> Attached, my XML config File
> 
> Thanks,
> 
> King regards,
> 
> Said
>  
> 
> 
> ------------------------------------------------------------------------
> Ne gardez plus qu'une seule adresse mail ! Copiez vos mails 
>  vers Yahoo! Mail
> 
> 
> ------------------------------------------------------------------------
> 
> 
> 010105010000000e7b56c49aa488IP1cycle7030400000IP1cycle7030400000IP1cycle8051204003IP1<
Req
>  uires>cycle801600003IP1cycle8076800000000000000003IPPIBISIOI1cycle8015362563IP1cycle8020482563IP1cle
>  ar dc system time]]-->cycle802320323IP1cycle802433003IP1cycle80235200103IP1cycle802356000c3IP1cycle8
md>
>  0259003
1001
0
YKY
2
72100946
655360
EK1100-0000-0001
PIBISIOIcycle2028801003PISIOIcycle103040000301000f00
out
>  >5000BIcycle103040000301000f0010000IPIBcycle20288010013IPIBcycle1030400001301000f003000IP
>
>  equires>cycle2012800013IP20128200010800000013IPcycle101288000000001302000000100IP20128200010a00000013IPcycle1012880000000013

>  ta>522c4c04100IPIBcycle2016e90313SPOPcycle510012880200300OScycle5100128804003SPOPcycle410013040000000000003
ta>
>  0200000000001f00000000005000IPIBcycle5100112800113IIcycle201280003IPcycle5100128802001300IPcycle4100130400000000000013
>
>  ata>0200000000001f00000000003000IPBIcycle201280003IBcycle51001288030013IBcycle41001304000000000000130300000000001f00000000003000PScycle<
/Re
>  quires>51001288040013PScycle41001304000000000000130400000000001f000000000010000OScycle4100130400000000000030400000000001f0000000000200SOcycle51001288080013
ans
>  ition>SOcycle41001304000000000000130800000000001f000000000010000
1002
65535
KK
2
65810514
10485760
EL1004-0000-0016

3124Inputs409600
6656

6657

6658

6659
#x1a00Channel 1#x6000

>  bIndex>11InputBOOL#x1a01Channel 2#x601011InputBOOL#x1a02Channel 3#x602011InputBOOL#x1a03Channel 4#x603011InputBOOL
PIBISIOIcycle265535288
ata
>  >01003PISIOIcycle1655353040000301000f005000BIcycle1655353040000301000f0010000IPIBcycle265535288010013IPIB
ans
>  ition>cycle16553530400001301000f003000IPcycle26553512800013IP265535128200010800000013IPcycle1655351288000000001302000000100IPTra
>  nsition>265535128200010a00000013IPcycle165535128800000000135230ec03100IPIBcycle26553516ea0313SPOPcycle510022880200300IPSP

>  ansition>SIOPOI51002204800000000000000003PS510022048001001000000010013PS5100215360008010001000003001000010100000013OScycle5100228804003SPSIOPOI]><
>  /Comment>510021536000000000000000000000000000000003SPOPcycle4100230400000000000030200000000001f00000000005000IPIBcycle5100212800113IIcycle2655351280003IPte 
>  to PREOP]]-->cycle5100228802001300IPcycle41002304000000000000130200000000001f00000000003000IPBIcycle2655351280003IBcycle51002288030013IBhec
>  k device state for BOOT]]-->cycle41002304000000000000130300000000001f00000000003000PScycle51002288040013PScycle41002304000000000000130400000000001f000000000010000OScycle41002304

=== message truncated ===



       
---------------------------------
 Ne gardez plus qu'une seule adresse mail ! Copiez vos mails vers Yahoo! Mail 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070810/38f020c3/attachment.html>

From rwatollenaar at gmail.com  Mon Aug 13 11:45:13 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Mon, 13 Aug 2007 11:45:13 +0200
Subject: [Ethercatmaster-users] EML conflict with RTCAN? low_level_input
	framebuilding failed.
Message-ID: <46C02829.9020009@gmail.com>

Hi,

in a 1 ms period task of my xenomai application things work perfectly 
with my BeckHoff devices addressing them via Ethercat with EML until I 
activate rtcan. Then sometimes (not always) I get incessant warnings 
from EML which read:

EC_Telegram:: check_index(): Index field does not correspond with 
received data.
low_level_input(): framebuilding failed.

The cycle time of the task is not being violated AFAI can see.

In dmesg the following can be found when the conflict occurs

RTnet:rtskb allocation from real-time cache failed.
Assertion failed! drivers/xenomai/can/rtcan_raw.c: rtcan_tx_push:168 
dev->tx_socket=0 (3) TX skb still in use.


Can anyone make any suggestions as to what might be the problem here or 
what I could try to look at to establish this?

Regards.

Roland.





From wg at grandegger.com  Mon Aug 13 13:41:56 2007
From: wg at grandegger.com (Wolfgang Grandegger)
Date: Mon, 13 Aug 2007 13:41:56 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input	framebuilding failed.
In-Reply-To: <46C02829.9020009@gmail.com>
References: <46C02829.9020009@gmail.com>
Message-ID: <46C04384.4030805@grandegger.com>

Roland Tollenaar wrote:
> Hi,
> 
> in a 1 ms period task of my xenomai application things work perfectly 
> with my BeckHoff devices addressing them via Ethercat with EML until I 
> activate rtcan. Then sometimes (not always) I get incessant warnings 
> from EML which read:
> 
> EC_Telegram:: check_index(): Index field does not correspond with 
> received data.
> low_level_input(): framebuilding failed.
> 
> The cycle time of the task is not being violated AFAI can see.
> 
> In dmesg the following can be found when the conflict occurs
> 
> RTnet:rtskb allocation from real-time cache failed.
> Assertion failed! drivers/xenomai/can/rtcan_raw.c: rtcan_tx_push:168 
> dev->tx_socket=0 (3) TX skb still in use.

Hm, this is not supposed to happen.

> Can anyone make any suggestions as to what might be the problem here or 
> what I could try to look at to establish this?

Can you show the output of /proc/rtcan/devices and /proc/rtcan/sockets 
before and after the problem showed up.

Wolfgang.



From rwatollenaar at gmail.com  Mon Aug 13 14:41:36 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Mon, 13 Aug 2007 14:41:36 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input	framebuilding failed.
In-Reply-To: <46C04384.4030805@grandegger.com>
References: <46C02829.9020009@gmail.com> <46C04384.4030805@grandegger.com>
Message-ID: <46C05180.5090302@gmail.com>

Hi

>> RTnet:rtskb allocation from real-time cache failed.
>> Assertion failed! drivers/xenomai/can/rtcan_raw.c: rtcan_tx_push:168 
>> dev->tx_socket=0 (3) TX skb still in use.
> 
> Hm, this is not supposed to happen.
Which of the two?


> Can you show the output of /proc/rtcan/devices and /proc/rtcan/sockets 
> before and after the problem showed up.

Below is an accumulation of what I think you are asking for. I am not 
convinced that the rtskb allocation failed message is serious, as you 
will see from the syslog and my comment above it only takes place when i 
close my application. Although I try to close all connections neatly 
certain threads still seem to be busy. See the errors I get on closing 
the application.

App running with no problem:

root at slax:~# cat /proc/rtcan/sockets
fd Name___________ Filter ErrMask RX_Timeout_ns TX_Timeout_ns RX_BufFull 
TX_Lo
  2 rtcan2               1 0x00000      infinite      infinite 
0     1
  0 rtcan2              -1 0x00000      infinite      infinite 
0     1

root at slax:~# cat /proc/rtcan/devices
Name___________ _Baudrate State___ TX_Counter RX_Counter ____Errors
rtcan0          undefined stopped           0          0          0
rtcan1          undefined stopped           0          0          0
rtcan2            1000000 active     16321347   27633347    2367116


App running with messages failing

root at slax:/var/log# cat /proc/rtcan/sockets
fd Name___________ Filter ErrMask RX_Timeout_ns TX_Timeout_ns RX_BufFull 
TX_Lo
  2 rtcan2               1 0x00000      infinite      infinite 
0     1
  0 rtcan2              -1 0x00000      infinite      infinite 
0     1


root at slax:/var/log# cat /proc/rtcan/devices
Name___________ _Baudrate State___ TX_Counter RX_Counter ____Errors
rtcan0          undefined stopped           0          0          0
rtcan1          undefined stopped           0          0          0
rtcan2            1000000 active     16850473   28691571    2367116



cat /var/syslog shows that the error only seems to come up when the 
application closes.

Only occurs on closing the application
Aug 13 13:01:28 (none) kernel: RTnet: rtskb allocation from real-time 
cache failed
Aug 13 13:02:14 (none) kernel: RTnet: rtskb allocation from real-time 
cache failed
Aug 13 14:02:34 (none) kernel: RTnet: rtskb allocation from real-time 
cache failed
Aug 13 14:03:36 (none) kernel: RTnet: rtskb allocation from real-time 
cache failed
Aug 13 14:18:39 (none) kernel: RTnet: rtskb allocation from real-time 
cache failed
Aug 13 14:19:33 (none) kernel: RTnet: rtskb allocation from real-time 
cache failed
Aug 13 14:19:58 (none) kernel: RTnet: rtskb allocation from real-time 
cache failed
Aug 13 14:21:27 (none) kernel: RTnet: rtskb allocation from real-time 
cache failed
Aug 13 14:22:10 (none) kernel: RTnet: rtskb allocation from real-time 
cache failed


When I close the application I get these errors

rt_dev_recv: aborted because socket was closed
rt_dev_recv: aborted because socket was closed
rt_dev_recv: aborted because socket was closed
rt_dev_recv: aborted because socket was closed
rt_dev_recv: aborted because socket was closed
rt_dev_recv: aborted because socket was closed
rt_dev_recv: aborted because socket was closed
rt_dev_recv: aborted because socket was closed
rt_dev_recv: aborted because socket was closed
rt_dev_recv: aborted because socket was closed
rt_dev_recv: aborted because socket was closed
rt_dev_recv: aborted because socket was closed
rt_dev_recv: aborted because socket was closed
rt_dev_recv: aborted because socket was closed
rt_dev_recv: aborted because socket was closed
rt_dev_recv: aborted because socket was closed
rt_dev_ioctl: Bad file descriptor
Waiting for tasks to stop....low_level_output(): Cannot Send
low_level_output(): Cannot Send
low_level_output(): Cannot Send
low_level_output(): Cannot Send
low_level_output(): Cannot Send
low_level_output(): Cannot Send
low_level_output(): Cannot Send
low_level_output(): Cannot Send
low_level_output(): Cannot Send
low_level_output(): Cannot Send
low_level_txandrx: failed: MAX_TRIES_TX: Giving up
DLL::txandrx() Error
PD_Buffer: Error sending PD
txandrx failed:


Does this shed any light on the matter?


Roland


> 
> Wolfgang.
> 
> 


From wg at grandegger.com  Mon Aug 13 15:03:12 2007
From: wg at grandegger.com (Wolfgang Grandegger)
Date: Mon, 13 Aug 2007 15:03:12 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input	framebuilding failed.
In-Reply-To: <46C05180.5090302@gmail.com>
References: <46C02829.9020009@gmail.com> <46C04384.4030805@grandegger.com>
	<46C05180.5090302@gmail.com>
Message-ID: <46C05690.2010108@grandegger.com>

Roland Tollenaar wrote:
> Hi
> 
>>> RTnet:rtskb allocation from real-time cache failed.
>>> Assertion failed! drivers/xenomai/can/rtcan_raw.c: rtcan_tx_push:168 
>>> dev->tx_socket=0 (3) TX skb still in use.
>>
>> Hm, this is not supposed to happen.
> Which of the two?

The RTCAN assertion. Well, in fact, it can happen when the device goes 
bus-off or is stopped while a TX message is pending. The next message 
after (re-)start will the trigger this message. This is a bug but it 
should _not_ harm (either I remove the assertion or I reset properly the 
value of dev->tx_socket).

The first one should be pretty clear. The rtskb pool seems to be exhausted.

> 
>> Can you show the output of /proc/rtcan/devices and /proc/rtcan/sockets 
>> before and after the problem showed up.
> 
> Below is an accumulation of what I think you are asking for. I am not 
> convinced that the rtskb allocation failed message is serious, as you 
> will see from the syslog and my comment above it only takes place when i 
> close my application. Although I try to close all connections neatly 
> certain threads still seem to be busy. See the errors I get on closing 
> the application.
> 
> App running with no problem:
> 
> root at slax:~# cat /proc/rtcan/sockets
> fd Name___________ Filter ErrMask RX_Timeout_ns TX_Timeout_ns RX_BufFull 
> TX_Lo
>  2 rtcan2               1 0x00000      infinite      infinite 0     1
>  0 rtcan2              -1 0x00000      infinite      infinite 0     1
> 
> root at slax:~# cat /proc/rtcan/devices
> Name___________ _Baudrate State___ TX_Counter RX_Counter ____Errors
> rtcan0          undefined stopped           0          0          0
> rtcan1          undefined stopped           0          0          0
> rtcan2            1000000 active     16321347   27633347    2367116
> 
> 
> App running with messages failing
> 
> root at slax:/var/log# cat /proc/rtcan/sockets
> fd Name___________ Filter ErrMask RX_Timeout_ns TX_Timeout_ns RX_BufFull 
> TX_Lo
>  2 rtcan2               1 0x00000      infinite      infinite 0     1
>  0 rtcan2              -1 0x00000      infinite      infinite 0     1
> 
> 
> root at slax:/var/log# cat /proc/rtcan/devices
> Name___________ _Baudrate State___ TX_Counter RX_Counter ____Errors
> rtcan0          undefined stopped           0          0          0
> rtcan1          undefined stopped           0          0          0
> rtcan2            1000000 active     16850473   28691571    2367116

Oops, that much errors?

> cat /var/syslog shows that the error only seems to come up when the 
> application closes.
> 
> Only occurs on closing the application
> Aug 13 13:01:28 (none) kernel: RTnet: rtskb allocation from real-time 
> cache failed
> Aug 13 13:02:14 (none) kernel: RTnet: rtskb allocation from real-time 
> cache failed
> Aug 13 14:02:34 (none) kernel: RTnet: rtskb allocation from real-time 
> cache failed
> Aug 13 14:03:36 (none) kernel: RTnet: rtskb allocation from real-time 
> cache failed
> Aug 13 14:18:39 (none) kernel: RTnet: rtskb allocation from real-time 
> cache failed
> Aug 13 14:19:33 (none) kernel: RTnet: rtskb allocation from real-time 
> cache failed
> Aug 13 14:19:58 (none) kernel: RTnet: rtskb allocation from real-time 
> cache failed
> Aug 13 14:21:27 (none) kernel: RTnet: rtskb allocation from real-time 
> cache failed
> Aug 13 14:22:10 (none) kernel: RTnet: rtskb allocation from real-time 
> cache failed
> 
> 
> When I close the application I get these errors
> 
> rt_dev_recv: aborted because socket was closed
> rt_dev_recv: aborted because socket was closed
> rt_dev_recv: aborted because socket was closed
> rt_dev_recv: aborted because socket was closed
> rt_dev_recv: aborted because socket was closed
> rt_dev_recv: aborted because socket was closed
> rt_dev_recv: aborted because socket was closed
> rt_dev_recv: aborted because socket was closed
> rt_dev_recv: aborted because socket was closed
> rt_dev_recv: aborted because socket was closed
> rt_dev_recv: aborted because socket was closed
> rt_dev_recv: aborted because socket was closed
> rt_dev_recv: aborted because socket was closed
> rt_dev_recv: aborted because socket was closed
> rt_dev_recv: aborted because socket was closed
> rt_dev_recv: aborted because socket was closed

You should handle this error properly.

> rt_dev_ioctl: Bad file descriptor
> Waiting for tasks to stop....low_level_output(): Cannot Send
> low_level_output(): Cannot Send
> low_level_output(): Cannot Send
> low_level_output(): Cannot Send
> low_level_output(): Cannot Send
> low_level_output(): Cannot Send
> low_level_output(): Cannot Send
> low_level_output(): Cannot Send
> low_level_output(): Cannot Send
> low_level_output(): Cannot Send
> low_level_txandrx: failed: MAX_TRIES_TX: Giving up
> DLL::txandrx() Error
> PD_Buffer: Error sending PD
> txandrx failed:
> 
> 
> Does this shed any light on the matter?

Hm, seems that your shutdown is not implemented properly.

Wolfgang.


From rwatollenaar at gmail.com  Mon Aug 13 15:11:25 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Mon, 13 Aug 2007 15:11:25 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input	framebuilding failed.
In-Reply-To: <46C05690.2010108@grandegger.com>
References: <46C02829.9020009@gmail.com> <46C04384.4030805@grandegger.com>
	<46C05180.5090302@gmail.com> <46C05690.2010108@grandegger.com>
Message-ID: <46C0587D.20206@gmail.com>

Hi Wolfgang,

> The RTCAN assertion. Well, in fact, it can happen when the device goes 
> bus-off or is stopped while a TX message is pending. The next message 
> after (re-)start will the trigger this message. This is a bug but it 
> should _not_ harm (either I remove the assertion or I reset properly the 
> value of dev->tx_socket).
Clear. Thanks.


> The first one should be pretty clear. The rtskb pool seems to be exhausted.
Sorry if this is not clear to me. What is the rtskb pool and what are 
the implications of it being full?

>>
>> root at slax:/var/log# cat /proc/rtcan/devices
>> Name___________ _Baudrate State___ TX_Counter RX_Counter ____Errors
>> rtcan0          undefined stopped           0          0          0
>> rtcan1          undefined stopped           0          0          0
>> rtcan2            1000000 active     16850473   28691571    2367116
> 
> Oops, that much errors?
eeuuh yes, I started up can after having had it disabled for a very long 
time while I was working on the ethercat. I seem to have forgotten that 
CAN is not wireless, forgot to plug in the bus. So I think that those 
errors were picked up then, they did not seem to increase later on.


>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
> 
> You should handle this error properly.
You are right. I think I am not closing the threads in the correct 
sequence, not sure I know how to yet. But can this be the cause of my 
problem? Where is the conflict/ complication arising between rtcan and 
eml. I do understand that this is an almost impossible question to find 
an answer to over two separate lists. :(


> 
> Hm, seems that your shutdown is not implemented properly.
I'd say this assessment is rather accurate. Will look into it:)

Roland

> 
> Wolfgang.
> 


From rwatollenaar at gmail.com  Mon Aug 13 16:00:00 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Mon, 13 Aug 2007 16:00:00 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input	framebuilding failed.
In-Reply-To: <46C05690.2010108@grandegger.com>
References: <46C02829.9020009@gmail.com> <46C04384.4030805@grandegger.com>
	<46C05180.5090302@gmail.com> <46C05690.2010108@grandegger.com>
Message-ID: <46C063E0.1010809@gmail.com>

Hi,

All closing & shutting down has been perfected. There are no more errors 
on closing my application.

Yet the problem persists very explicitly. Rtcan and EML can run 
separately and never throw up any errors. As soon as they are used in 
combination then in 50% of the cases the framebuilding in EML gets 
messed up (as per the error message)

There is definitely something between the two that is not right.


>>>> RTnet:rtskb allocation from real-time cache failed.

Could I get some tips as to what I can do about this? I seem to get it 
even when I do not have rtcan activity running in my application and 
(because I am clueless) I would like to prevent this message which may 
signify the root of the problem.



Regards,

Roland.






>>> Hm, this is not supposed to happen.
>> Which of the two?
> 
> The RTCAN assertion. Well, in fact, it can happen when the device goes 
> bus-off or is stopped while a TX message is pending. The next message 
> after (re-)start will the trigger this message. This is a bug but it 
> should _not_ harm (either I remove the assertion or I reset properly the 
> value of dev->tx_socket).
> 
> The first one should be pretty clear. The rtskb pool seems to be exhausted.
> 
>>
>>> Can you show the output of /proc/rtcan/devices and 
>>> /proc/rtcan/sockets before and after the problem showed up.
>>
>> Below is an accumulation of what I think you are asking for. I am not 
>> convinced that the rtskb allocation failed message is serious, as you 
>> will see from the syslog and my comment above it only takes place when 
>> i close my application. Although I try to close all connections neatly 
>> certain threads still seem to be busy. See the errors I get on closing 
>> the application.
>>
>> App running with no problem:
>>
>> root at slax:~# cat /proc/rtcan/sockets
>> fd Name___________ Filter ErrMask RX_Timeout_ns TX_Timeout_ns 
>> RX_BufFull TX_Lo
>>  2 rtcan2               1 0x00000      infinite      infinite 0     1
>>  0 rtcan2              -1 0x00000      infinite      infinite 0     1
>>
>> root at slax:~# cat /proc/rtcan/devices
>> Name___________ _Baudrate State___ TX_Counter RX_Counter ____Errors
>> rtcan0          undefined stopped           0          0          0
>> rtcan1          undefined stopped           0          0          0
>> rtcan2            1000000 active     16321347   27633347    2367116
>>
>>
>> App running with messages failing
>>
>> root at slax:/var/log# cat /proc/rtcan/sockets
>> fd Name___________ Filter ErrMask RX_Timeout_ns TX_Timeout_ns 
>> RX_BufFull TX_Lo
>>  2 rtcan2               1 0x00000      infinite      infinite 0     1
>>  0 rtcan2              -1 0x00000      infinite      infinite 0     1
>>
>>
>> root at slax:/var/log# cat /proc/rtcan/devices
>> Name___________ _Baudrate State___ TX_Counter RX_Counter ____Errors
>> rtcan0          undefined stopped           0          0          0
>> rtcan1          undefined stopped           0          0          0
>> rtcan2            1000000 active     16850473   28691571    2367116
> 
> Oops, that much errors?
> 
>> cat /var/syslog shows that the error only seems to come up when the 
>> application closes.
>>
>> Only occurs on closing the application
>> Aug 13 13:01:28 (none) kernel: RTnet: rtskb allocation from real-time 
>> cache failed
>> Aug 13 13:02:14 (none) kernel: RTnet: rtskb allocation from real-time 
>> cache failed
>> Aug 13 14:02:34 (none) kernel: RTnet: rtskb allocation from real-time 
>> cache failed
>> Aug 13 14:03:36 (none) kernel: RTnet: rtskb allocation from real-time 
>> cache failed
>> Aug 13 14:18:39 (none) kernel: RTnet: rtskb allocation from real-time 
>> cache failed
>> Aug 13 14:19:33 (none) kernel: RTnet: rtskb allocation from real-time 
>> cache failed
>> Aug 13 14:19:58 (none) kernel: RTnet: rtskb allocation from real-time 
>> cache failed
>> Aug 13 14:21:27 (none) kernel: RTnet: rtskb allocation from real-time 
>> cache failed
>> Aug 13 14:22:10 (none) kernel: RTnet: rtskb allocation from real-time 
>> cache failed
>>
>>
>> When I close the application I get these errors
>>
>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
>> rt_dev_recv: aborted because socket was closed
> 
> You should handle this error properly.
> 
>> rt_dev_ioctl: Bad file descriptor
>> Waiting for tasks to stop....low_level_output(): Cannot Send
>> low_level_output(): Cannot Send
>> low_level_output(): Cannot Send
>> low_level_output(): Cannot Send
>> low_level_output(): Cannot Send
>> low_level_output(): Cannot Send
>> low_level_output(): Cannot Send
>> low_level_output(): Cannot Send
>> low_level_output(): Cannot Send
>> low_level_output(): Cannot Send
>> low_level_txandrx: failed: MAX_TRIES_TX: Giving up
>> DLL::txandrx() Error
>> PD_Buffer: Error sending PD
>> txandrx failed:
>>
>>
>> Does this shed any light on the matter?
> 
> Hm, seems that your shutdown is not implemented properly.
> 
> Wolfgang.
> 


From jan.kiszka at web.de  Mon Aug 13 16:51:49 2007
From: jan.kiszka at web.de (Jan Kiszka)
Date: Mon, 13 Aug 2007 16:51:49 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input	framebuilding failed.
In-Reply-To: <46C063E0.1010809@gmail.com>
References: <46C02829.9020009@gmail.com>
	<46C04384.4030805@grandegger.com>	<46C05180.5090302@gmail.com>
	<46C05690.2010108@grandegger.com> <46C063E0.1010809@gmail.com>
Message-ID: <46C07005.8000504@web.de>

Roland Tollenaar wrote:
> Hi,
> 
> All closing & shutting down has been perfected. There are no more errors 
> on closing my application.
> 
> Yet the problem persists very explicitly. Rtcan and EML can run 
> separately and never throw up any errors. As soon as they are used in 
> combination then in 50% of the cases the framebuilding in EML gets 
> messed up (as per the error message)
> 
> There is definitely something between the two that is not right.
> 

In 9 of 10 cases (if not more): timing. Running both alone doesn't
expose some timing issue (race) or transient overload. I can't help with
EML complaints, maybe the FMTC guys have an idea what can trigger this
and how to debug it.

> 
>>>>> RTnet:rtskb allocation from real-time cache failed.
> 
> Could I get some tips as to what I can do about this? I seem to get it 
> even when I do not have rtcan activity running in my application and 
> (because I am clueless) I would like to prevent this message which may 
> signify the root of the problem.

You have created the socket for some/all EML activity from primary mode
of some Xenomai thread, thus network buffer allocation is ought to run
against the real-time rtskb pool - which is by default empty :p. See
README.pools from the RTnet documentation on this.

I don't have the EML design at hand, but you might be able to avoid this
by initialising before creating the shadow task or by explicitly
switching to secondary mode before initialising. [Sorry for this issue,
it's at least partly due to some outdated RTnet design.]

Jan

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 250 bytes
Desc: OpenPGP digital signature
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070813/ce6c908f/attachment.pgp>

From rwatollenaar at gmail.com  Mon Aug 13 17:55:08 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Mon, 13 Aug 2007 17:55:08 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input	framebuilding failed.
In-Reply-To: <46C07005.8000504@web.de>
References: <46C02829.9020009@gmail.com>
	<46C04384.4030805@grandegger.com>	<46C05180.5090302@gmail.com>
	<46C05690.2010108@grandegger.com> <46C063E0.1010809@gmail.com>
	<46C07005.8000504@web.de>
Message-ID: <46C07EDC.4040305@gmail.com>

Hi

>> There is definitely something between the two that is not right.
>>
> 
> In 9 of 10 cases (if not more): timing. Running both alone doesn't
> expose some timing issue (race) or transient overload. I can't help with
> EML complaints, maybe the FMTC guys have an idea what can trigger this
> and how to debug it.
Out of interest, what timing exactly? These two systems (rtcan and eml) 
run separately, they don;t need to access the same address space or 
otherwise share resources that would require timing? What am I not 
understanding?



>>>>>> RTnet:rtskb allocation from real-time cache failed.
>> Could I get some tips as to what I can do about this? I seem to get it 
>> even when I do not have rtcan activity running in my application and 
>> (because I am clueless) I would like to prevent this message which may 
>> signify the root of the problem.
> 
> You have created the socket for some/all EML activity from primary mode
> of some Xenomai thread, 
100% correct.


thus network buffer allocation is ought to run
> against the real-time rtskb pool - which is by default empty :p. See
> README.pools from the RTnet documentation on this.


> I don't have the EML design at hand, but you might be able to avoid this
> by initialising before creating the shadow task or by explicitly
In fact this is what I tried initially. IT does not work at all. so I 
ended up initializing in the thread. Problem?

Is this allocation possibly the cause of the problem or is the rtnet 
warning harmless? At least it is not related to rtcan in any manner 
because it appears even if rtcan is not activated in the application.

Roland



> switching to secondary mode before initialising. [Sorry for this issue,
> it's at least partly due to some outdated RTnet design.]
> 
> Jan
> 


From jan.kiszka at web.de  Mon Aug 13 18:57:08 2007
From: jan.kiszka at web.de (Jan Kiszka)
Date: Mon, 13 Aug 2007 18:57:08 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input	framebuilding failed.
In-Reply-To: <46C07EDC.4040305@gmail.com>
References: <46C02829.9020009@gmail.com>
	<46C04384.4030805@grandegger.com>	<46C05180.5090302@gmail.com>
	<46C05690.2010108@grandegger.com> <46C063E0.1010809@gmail.com>
	<46C07005.8000504@web.de> <46C07EDC.4040305@gmail.com>
Message-ID: <46C08D64.4050903@web.de>

Roland Tollenaar wrote:
> Hi
> 
>>> There is definitely something between the two that is not right.
>>>
>>
>> In 9 of 10 cases (if not more): timing. Running both alone doesn't
>> expose some timing issue (race) or transient overload. I can't help with
>> EML complaints, maybe the FMTC guys have an idea what can trigger this
>> and how to debug it.
> Out of interest, what timing exactly? These two systems (rtcan and eml)
> run separately, they don;t need to access the same address space or
> otherwise share resources that would require timing? What am I not
> understanding?

The share the same CPU? Varying the load can re-order the execution
order in otherwise independent components.

> 
> 
>>>>>>> RTnet:rtskb allocation from real-time cache failed.
>>> Could I get some tips as to what I can do about this? I seem to get
>>> it even when I do not have rtcan activity running in my application
>>> and (because I am clueless) I would like to prevent this message
>>> which may signify the root of the problem.
>>
>> You have created the socket for some/all EML activity from primary mode
>> of some Xenomai thread, 
> 100% correct.
> 
> 
> thus network buffer allocation is ought to run
>> against the real-time rtskb pool - which is by default empty :p. See
>> README.pools from the RTnet documentation on this.
> 
> 
>> I don't have the EML design at hand, but you might be able to avoid this
>> by initialising before creating the shadow task or by explicitly
> In fact this is what I tried initially. IT does not work at all. so I
> ended up initializing in the thread. Problem?

Not necessarily. But it would have been nice to report the other issue
as well, because maybe there is something to be fixed (either in the
code or in the docs). Initialisation almost always happens in non-RT
context, and you shouldn't be force to do this under RT constraints. If
this is an RTnet and/or EML problem, please report it on the related lists!

> 
> Is this allocation possibly the cause of the problem or is the rtnet
> warning harmless? At least it is not related to rtcan in any manner
> because it appears even if rtcan is not activated in the application.

Did you set the rtskb_cache_size module parameter for the rtnet.ko? Did
you choose it appropriately large so that buffer pool do not exhaust if
RTnet is blocked by other system activity? Again, check the documentation.

Jan

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 250 bytes
Desc: OpenPGP digital signature
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070813/4134a5b7/attachment.pgp>

From rwatollenaar at gmail.com  Mon Aug 13 19:40:03 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Mon, 13 Aug 2007 19:40:03 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input	framebuilding failed.
In-Reply-To: <46C08D64.4050903@web.de>
References: <46C02829.9020009@gmail.com>
	<46C04384.4030805@grandegger.com>	<46C05180.5090302@gmail.com>
	<46C05690.2010108@grandegger.com> <46C063E0.1010809@gmail.com>
	<46C07005.8000504@web.de> <46C07EDC.4040305@gmail.com>
	<46C08D64.4050903@web.de>
Message-ID: <46C09773.5070607@gmail.com>

Hi Jan,


>> thus network buffer allocation is ought to run
>>> against the real-time rtskb pool - which is by default empty :p. See
>>> README.pools from the RTnet documentation on this.
I read this documentation. Together with an archive email of this list I 
  understand that if I load rtnet.ko like

insmod rtnet.ko rtskb_cache_size=64

(for the benfit of other poor souls in the future :))

it should help. And it does make a huge difference. Now instead of not 
giving a problem 1 out of 5 times its more like giving a problem 1 every 
10 times.

The 64 is a value I got from the mailing list. How large can I make this 
and what am I compromising?


>>> I don't have the EML design at hand, but you might be able to avoid this
>>> by initialising before creating the shadow task or by explicitly
>> In fact this is what I tried initially. IT does not work at all. so I
>> ended up initializing in the thread. Problem?
> 
> Not necessarily. But it would have been nice to report the other issue
> as well, because maybe there is something to be fixed (either in the
> code or in the docs). Initialisation almost always happens in non-RT
> context, and you shouldn't be force to do this under RT constraints. If
> this is an RTnet and/or EML problem, please report it on the related lists!
Will do so with your compliments and regards. :) I tried to initialize 
like I initialize rtcan in non-rt but it really does not work.


> Did you set the rtskb_cache_size module parameter for the rtnet.ko? Did
> you choose it appropriately large so that buffer pool do not exhaust if
> RTnet is blocked by other system activity? Again, check the documentation.
As stated, this seems to mitigate the problem. What is not clear to me 
is why the default of the rtskb pool is zero?

Roland.

> 
> Jan
> 


From jan.kiszka at web.de  Mon Aug 13 19:57:26 2007
From: jan.kiszka at web.de (Jan Kiszka)
Date: Mon, 13 Aug 2007 19:57:26 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input	framebuilding failed.
In-Reply-To: <46C09773.5070607@gmail.com>
References: <46C02829.9020009@gmail.com>
	<46C04384.4030805@grandegger.com>	<46C05180.5090302@gmail.com>
	<46C05690.2010108@grandegger.com> <46C063E0.1010809@gmail.com>
	<46C07005.8000504@web.de> <46C07EDC.4040305@gmail.com>
	<46C08D64.4050903@web.de> <46C09773.5070607@gmail.com>
Message-ID: <46C09B86.3030709@web.de>

Roland Tollenaar wrote:
> Hi Jan,
> 
> 
>>> thus network buffer allocation is ought to run
>>>> against the real-time rtskb pool - which is by default empty :p. See
>>>> README.pools from the RTnet documentation on this.
> I read this documentation. Together with an archive email of this list I
>  understand that if I load rtnet.ko like
> 
> insmod rtnet.ko rtskb_cache_size=64
> 
> (for the benfit of other poor souls in the future :))
> 
> it should help. And it does make a huge difference. Now instead of not
> giving a problem 1 out of 5 times its more like giving a problem 1 every
> 10 times.
> 
> The 64 is a value I got from the mailing list. How large can I make this
> and what am I compromising?

Each buffer is slightly more than 1.5 KB heavy. Do your maths :). How
many buffers you need depend on how many incoming and outgoing frames
might be queued into they are processed. And that depends on the frame
rate and the time your EML stack has to handle it in the worst case. I
can't give you numbers on this, that depends on _your_ setup.

> 
> 
>>>> I don't have the EML design at hand, but you might be able to avoid
>>>> this
>>>> by initialising before creating the shadow task or by explicitly
>>> In fact this is what I tried initially. IT does not work at all. so I
>>> ended up initializing in the thread. Problem?
>>
>> Not necessarily. But it would have been nice to report the other issue
>> as well, because maybe there is something to be fixed (either in the
>> code or in the docs). Initialisation almost always happens in non-RT
>> context, and you shouldn't be force to do this under RT constraints. If
>> this is an RTnet and/or EML problem, please report it on the related
>> lists!
> Will do so with your compliments and regards. :) I tried to initialize
> like I initialize rtcan in non-rt but it really does not work.

That sounds like a bug - of what component soever.

> 
> 
>> Did you set the rtskb_cache_size module parameter for the rtnet.ko? Did
>> you choose it appropriately large so that buffer pool do not exhaust if
>> RTnet is blocked by other system activity? Again, check the
>> documentation.
> As stated, this seems to mitigate the problem. What is not clear to me
> is why the default of the rtskb pool is zero?

Because you _normally_ don't need it and would thus wast the allocated
memory.

Jan

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 250 bytes
Desc: OpenPGP digital signature
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070813/62225ee3/attachment.pgp>

From rwatollenaar at gmail.com  Mon Aug 13 20:17:14 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Mon, 13 Aug 2007 20:17:14 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input	framebuilding failed.
In-Reply-To: <46C09B86.3030709@web.de>
References: <46C02829.9020009@gmail.com>
	<46C04384.4030805@grandegger.com>	<46C05180.5090302@gmail.com>
	<46C05690.2010108@grandegger.com> <46C063E0.1010809@gmail.com>
	<46C07005.8000504@web.de> <46C07EDC.4040305@gmail.com>
	<46C08D64.4050903@web.de> <46C09773.5070607@gmail.com>
	<46C09B86.3030709@web.de>
Message-ID: <46C0A02A.1010706@gmail.com>

Hi,

>> The 64 is a value I got from the mailing list. How large can I make this
>> and what am I compromising?
> 
> Each buffer is slightly more than 1.5 KB heavy. Do your maths :). How
> many buffers you need depend on how many incoming and outgoing frames
> might be queued into they are processed. And that depends on the frame
> rate and the time your EML stack has to handle it in the worst case. I
> can't give you numbers on this, that depends on _your_ setup.

That much is clear. Will make it big out of shear inability to 
calculate. The lost memory is of almost no concern.

Thanks.

Roland


> 
> Jan
> 


From jan.kiszka at web.de  Mon Aug 13 20:30:10 2007
From: jan.kiszka at web.de (Jan Kiszka)
Date: Mon, 13 Aug 2007 20:30:10 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input	framebuilding failed.
In-Reply-To: <46C0A02A.1010706@gmail.com>
References: <46C02829.9020009@gmail.com>
	<46C04384.4030805@grandegger.com>	<46C05180.5090302@gmail.com>
	<46C05690.2010108@grandegger.com> <46C063E0.1010809@gmail.com>
	<46C07005.8000504@web.de> <46C07EDC.4040305@gmail.com>
	<46C08D64.4050903@web.de> <46C09773.5070607@gmail.com>
	<46C09B86.3030709@web.de> <46C0A02A.1010706@gmail.com>
Message-ID: <46C0A332.2040701@web.de>

Roland Tollenaar wrote:
> Hi,
> 
>>> The 64 is a value I got from the mailing list. How large can I make this
>>> and what am I compromising?
>>
>> Each buffer is slightly more than 1.5 KB heavy. Do your maths :). How
>> many buffers you need depend on how many incoming and outgoing frames
>> might be queued into they are processed. And that depends on the frame

s/into/until/ (my brain-based dictionary must be broken)

>> rate and the time your EML stack has to handle it in the worst case. I
>> can't give you numbers on this, that depends on _your_ setup.
> 
> That much is clear. Will make it big out of shear inability to
> calculate. The lost memory is of almost no concern.

Just make sure that picking an arbitrary large pool size doesn't paper
over some real system design issue that may manifests in huge latencies.
Again, I don't know your numbers, so I cannot tell what is reasonable
and what an indication of a problem. A system-level analysis of the
event flows would be a good job for LTTng now - if it only worked already...

Jan

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 250 bytes
Desc: OpenPGP digital signature
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070813/66b2c647/attachment.pgp>

From rwatollenaar at gmail.com  Tue Aug 14 15:56:40 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Tue, 14 Aug 2007 15:56:40 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input	framebuilding failed.
In-Reply-To: <46C07005.8000504@web.de>
References: <46C02829.9020009@gmail.com>
	<46C04384.4030805@grandegger.com>	<46C05180.5090302@gmail.com>
	<46C05690.2010108@grandegger.com> <46C063E0.1010809@gmail.com>
	<46C07005.8000504@web.de>
Message-ID: <46C1B498.8060600@gmail.com>

Hi,

Some new insight:

I have included the rtnet list because I think this is of interest and I 
don;t know exactly where the problem arises. Most likely EML but which 
goes unnecessarily haywire when xenomai has a latency glitch which seems 
to be caused by rtcan but may also be rtnet (so the rest of you can stop 
reading here :) )

To refresh, I am running EML and rtcan together and separately they 
appear to function perfectly but when combined, EML sometimes starts 
ejecting the error:

EC_Telegram::index_check() : index not the same,
low_level_input() :  framebuilding failed.

Or something pretty closely to that effect.

Despite EML warning that the frame could not be built, the inputs (which 
rely on the framebuilding being succesful pretty stringently) seem to 
function perfectly. It seems as though EML is emitting a false warning.

I have now killed the warning from EML with the following hack:

In EC_Telegram::check_index() I have effectively killed the check by 
snubbing the holler and always returning true. Now the application no 
longer emits warnings and everything functions well (or so it seems). I 
have a sawtooth analog output on a scope which triggers well. It 
fluttered sometimes when EML emitted the warning. Presumably the 
fluttering is caused by some latency which I thought might be the result 
of EML emitting the warnings. However even without the warnings from EML 
this fluttering incidentally takes place. Generally I can increase the 
chance of this flutter (I will confirm this with a latency test later 
on) by clicking about in the user interface of my application (QT).


So EML seems to go haywire when there is latency and there seems to be 
latency when I am using rtcan. (Bit of latency can also be caused by 
clicking about but I think it is mainly rtcan causing the latency spikes 
and the clicking about just knocks it over the edge more often.)

I have also made the index that is supposedly not the same visible. For 
the EML chaps: index and m_idx and the output seems to be something like 
this

index	m_idx
0	1
0	0
1	2
2	3
2	3
3	4
4	5
:	:
:	:
253	254
0	2

or something to that effect. Can anyone comment on this?


P.S.

Everything else is sorted out now, application closes neatly all 
sockets, no buffer overruns, no errors in syslog etc.

Also I have managed to get the initialization of the socket to the non 
real-time context but the problem persists in exactly the same manner.

I have increased the rtskbf_cache_size. The problem occurs less 
frequently but certainly does not subside completely. Irrespective of 
how big I make it after that.  There is no mention of any problem in 
this regard in any of the logs anymore (dmesg syslog etc)

Roland.









These are the comments that have been made which may be relevant:



Jan Kiszka wrote:
> In 9 of 10 cases (if not more): timing. Running both alone doesn't
> expose some timing issue (race) or transient overload. I can't help with
> EML complaints, maybe the FMTC guys have an idea what can trigger this
> and how to debug it.

>>>>>> RTnet:rtskb allocation from real-time cache failed.

> You have created the socket for some/all EML activity from primary mode
> of some Xenomai thread, thus network buffer allocation is ought to run
> against the real-time rtskb pool - which is by default empty :p. See
> README.pools from the RTnet documentation on this.

Although this was a problem


> 
> I don't have the EML design at hand, but you might be able to avoid this
> by initialising before creating the shadow task or by explicitly
> switching to secondary mode before initialising. [Sorry for this issue,
> it's at least partly due to some outdated RTnet design.]
> 
> Jan
> 


From klaas.gadeyne at fmtc.be  Tue Aug 14 16:47:17 2007
From: klaas.gadeyne at fmtc.be (Klaas Gadeyne)
Date: Tue, 14 Aug 2007 16:47:17 +0200 (CEST)
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input framebuilding failed.
In-Reply-To: <46C1B498.8060600@gmail.com>
References: <46C02829.9020009@gmail.com> <46C04384.4030805@grandegger.com>
	<46C05180.5090302@gmail.com> <46C05690.2010108@grandegger.com>
	<46C063E0.1010809@gmail.com> <46C07005.8000504@web.de>
	<46C1B498.8060600@gmail.com>
Message-ID: <Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>

On Tue, 14 Aug 2007, Roland Tollenaar wrote:
> To refresh, I am running EML and rtcan together and separately they
> appear to function perfectly but when combined, EML sometimes starts
> ejecting the error:

How many threads do you have sending process data, and what are there
priorities? (/proc/xenomai/sched IIRC)

> EC_Telegram::index_check() : index not the same,
> low_level_input() :  framebuilding failed.
>
> Or something pretty closely to that effect.
>
> Despite EML warning that the frame could not be built, the inputs (which
> rely on the framebuilding being succesful pretty stringently) seem to
> function perfectly. It seems as though EML is emitting a false warning.

What do you mean with "inputs functioning perfectly"?

> I have now killed the warning from EML with the following hack:
>
> In EC_Telegram::check_index() I have effectively killed the check by
> snubbing the holler and always returning true. Now the application no
> longer emits warnings and everything functions well (or so it seems). I
> have a sawtooth analog output on a scope which triggers well.

Should I have read s/input/output/g in the above?

> It
> fluttered sometimes when EML emitted the warning. Presumably the
> fluttering is caused by some latency which I thought might be the result
> of EML emitting the warnings. However even without the warnings from EML
> this fluttering incidentally takes place. Generally I can increase the
> chance of this flutter (I will confirm this with a latency test later
> on) by clicking about in the user interface of my application (QT).
>
>
> So EML seems to go haywire when there is latency and there seems to be
> latency when I am using rtcan. (Bit of latency can also be caused by
> clicking about but I think it is mainly rtcan causing the latency spikes
> and the clicking about just knocks it over the edge more often.)
>
> I have also made the index that is supposedly not the same visible. For
> the EML chaps: index and m_idx and the output seems to be something like
> this
>
> index	m_idx
> 0	1
> 0	0
> 1	2
> 2	3
> 2	3
> 3	4
> 4	5
> :	:
> :	:
> 253	254
> 0	2
>
> or something to that effect. Can anyone comment on this?

Is the above the index in the output captured with wireshark or
something else?

AFAIS from the code shouldn't be affected by latency of the PD
thread.  You might uncomment the following log statements to get more
info too (I wonder why they are commented out anyway, Tom?)

static bool ec_rtdm_txandrx(struct EtherCAT_Frame * frame, struct
netif * netif) {
         int tries = 0;
         while (tries < MAX_TRIES_TX) {
                 pthread_mutex_lock (&txandrx_mut);
                 if (low_level_output(frame,netif)){
                         if (low_level_input(frame,netif)){
                                 pthread_mutex_unlock(&txandrx_mut);
                                 return true;
                         }
                         else{
                                 //log(EC_LOG_ERROR,
 				"low_level_txandrx: receiving
 				failed\n");
                                 pthread_mutex_unlock(&txandrx_mut);
                         }
                 }
                 else{
                         //log(EC_LOG_ERROR, "low_level_txandrx:
 			sending failed\n");
                         pthread_mutex_unlock(&txandrx_mut);
                 }
                 tries++;
         }
         log(EC_LOG_FATAL, "low_level_txandrx: failed: MAX_TRIES_TX:
 	Giving up\n");
         return false;

Klaas



From rwatollenaar at gmail.com  Tue Aug 14 20:03:21 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Tue, 14 Aug 2007 20:03:21 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input framebuilding failed.
In-Reply-To: <Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>
References: <46C02829.9020009@gmail.com> <46C04384.4030805@grandegger.com>
	<46C05180.5090302@gmail.com> <46C05690.2010108@grandegger.com>
	<46C063E0.1010809@gmail.com> <46C07005.8000504@web.de>
	<46C1B498.8060600@gmail.com>
	<Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>
Message-ID: <46C1EE69.3020301@gmail.com>

Hi,

> How many threads do you have sending process data, and what are there
> priorities? (/proc/xenomai/sched IIRC)
I have 3 rt tasks running. Only one sends and receives process data. The 
priorities are:
rt_task1 99
rt_task2 75
rt_task3 1

Period times are
1ms
3ms
indefinite(holds a blocking rt_can recv call to catch any incoming CAN 
messages)


> 
>> EC_Telegram::index_check() : index not the same,
>> low_level_input() :  framebuilding failed.
>>
>> Or something pretty closely to that effect.
>>
>> Despite EML warning that the frame could not be built, the inputs (which
>> rely on the framebuilding being succesful pretty stringently) seem to
>> function perfectly. It seems as though EML is emitting a false warning.
> 
> What do you mean with "inputs functioning perfectly"?

The digital inputs are packed into the frame as are the digital outputs 
and analog output process data. The outputs function as they should but 
the warning complains mainly about the retrieving part of the ethercat 
cycle. Hence my comment that the digital inputs also function as they 
should that is to say the data arrives correctly and uncorrupted. AFAI 
understand from ETG the index is not changed by the ESC's so I would 
expect the check always return true. But even if it does not what does 
that mean? Can it mean that EML is losing some frames that have been 
transmitted? I.e. the index is incremented with every transmit and the 
message with the same index is expected on the next read but instead it 
is only getting one later? If so, what could cause this?

>> I have now killed the warning from EML with the following hack:
>>
>> In EC_Telegram::check_index() I have effectively killed the check by
>> snubbing the holler and always returning true. Now the application no
>> longer emits warnings and everything functions well (or so it seems). I
>> have a sawtooth analog output on a scope which triggers well.
> 
> Should I have read s/input/output/g in the above?
No, output. The output is incremented up in task 1 and reset to -10V 
when it reaches 10V. The steps take place at exactly 1ms with impressive 
accuracy and consistency. This saw tooth wave is so stable that my scope 
has no problem locking onto it and it remains stationary (allowing me to 
admire the accurate 1ms steps :) ). Now and then if I try hard the wave 
flimmers i.e. the triggering is lost) which I think indicates that the 
1ms task did not increment the analog output on time. Whatever happens 
to cause this (rtcan ?, we know that it displays some latency breaking 
behaviour when the buffer is full. But there is no evidence that there 
is any buffer overflow at present anymore) might make an ethernet frame 
go lost Ah!, a delayed read **** which causes the index shift and 
consequently the irritating messages.

**** It occurs to me to ask whether there is an incomming buffer for 
ethercat frames that is maybe read out in such a manner (e.g. FIFO) that 
if a message can get "buried" and once a slip has occurred the index 
shift stays resident. ?? If anyone would care to enlighten me on how 
this part of EML works and whether this hypothesis is a possibility or 
not I would be much obliged.


>> I have also made the index that is supposedly not the same visible. For
>> the EML chaps: index and m_idx and the output seems to be something like
>> this
>>
>> index    m_idx
>> 0    1
>> 0    0
>> 1    2
>> 2    3
>> 2    3
>> 3    4
>> 4    5
>> :    :
>> :    :
>> 253    254
>> 0    2
>>
>> or something to that effect. Can anyone comment on this?
> 
> Is the above the index in the output captured with wireshark or
> something else?
No EML and switches are no friends of each other when the frame gets 
long I suspect. EML bombs out when I introduce a switch. I would be much 
obliged to anyone who would tell me how to set up any timeout delay 
measurement in EML.
What I did was simply put a printf line into EML to output index and 
m_idx to screen. So unfortunately this does not tell us where the shift 
is acquired.


Thanks. I'll give below a try.

Roland.

> 
> AFAIS from the code shouldn't be affected by latency of the PD
> thread.  You might uncomment the following log statements to get more
> info too (I wonder why they are commented out anyway, Tom?)
> 
> static bool ec_rtdm_txandrx(struct EtherCAT_Frame * frame, struct
> netif * netif) {
>         int tries = 0;
>         while (tries < MAX_TRIES_TX) {
>                 pthread_mutex_lock (&txandrx_mut);
>                 if (low_level_output(frame,netif)){
>                         if (low_level_input(frame,netif)){
>                                 pthread_mutex_unlock(&txandrx_mut);
>                                 return true;
>                         }
>                         else{
>                                 //log(EC_LOG_ERROR,
>                 "low_level_txandrx: receiving
>                 failed\n");
>                                 pthread_mutex_unlock(&txandrx_mut);
>                         }
>                 }
>                 else{
>                         //log(EC_LOG_ERROR, "low_level_txandrx:
>             sending failed\n");
>                         pthread_mutex_unlock(&txandrx_mut);
>                 }
>                 tries++;
>         }
>         log(EC_LOG_FATAL, "low_level_txandrx: failed: MAX_TRIES_TX:
>     Giving up\n");
>         return false;
> 
> Klaas
> 
> 


From jan.kiszka at web.de  Tue Aug 14 21:17:46 2007
From: jan.kiszka at web.de (Jan Kiszka)
Date: Tue, 14 Aug 2007 21:17:46 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input framebuilding failed.
In-Reply-To: <46C1EE69.3020301@gmail.com>
References: <46C02829.9020009@gmail.com>
	<46C04384.4030805@grandegger.com>	<46C05180.5090302@gmail.com>
	<46C05690.2010108@grandegger.com>	<46C063E0.1010809@gmail.com>
	<46C07005.8000504@web.de>	<46C1B498.8060600@gmail.com>	<Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>
	<46C1EE69.3020301@gmail.com>
Message-ID: <46C1FFDA.4070709@web.de>

Roland Tollenaar wrote:
> Hi,
> 
>> How many threads do you have sending process data, and what are there
>> priorities? (/proc/xenomai/sched IIRC)
> I have 3 rt tasks running. Only one sends and receives process data. The 
> priorities are:
> rt_task1 99

Check the /proc output again, there should be also RTnet's stack manager
at prio 98. Maybe that is too low for your scenario and causes prio
inversions (note: every incoming Ethernet frame goes through its hands).
Try lowering the prio of your rt_task1 beneath 98.

> rt_task2 75
> rt_task3 1
> 
> Period times are
> 1ms
> 3ms
> indefinite(holds a blocking rt_can recv call to catch any incoming CAN 
> messages)
> 
> 
>>> EC_Telegram::index_check() : index not the same,
>>> low_level_input() :  framebuilding failed.
>>>
>>> Or something pretty closely to that effect.
>>>
>>> Despite EML warning that the frame could not be built, the inputs (which
>>> rely on the framebuilding being succesful pretty stringently) seem to
>>> function perfectly. It seems as though EML is emitting a false warning.
>> What do you mean with "inputs functioning perfectly"?
> 
> The digital inputs are packed into the frame as are the digital outputs 
> and analog output process data. The outputs function as they should but 
> the warning complains mainly about the retrieving part of the ethercat 
> cycle. Hence my comment that the digital inputs also function as they 
> should that is to say the data arrives correctly and uncorrupted. AFAI 
> understand from ETG the index is not changed by the ESC's so I would 
> expect the check always return true. But even if it does not what does 
> that mean? Can it mean that EML is losing some frames that have been 
> transmitted? I.e. the index is incremented with every transmit and the 
> message with the same index is expected on the next read but instead it 
> is only getting one later? If so, what could cause this?

If the problem persists (or your _really_ want to understand what
happens), you could try to put an xntrace_user_freeze(0, 1) before the
line which emits that EML warning, turn on the I-pipe tracer, set a
large back_trace_points value (a few thousand), enable verbose mode, and
grab what /proc/ipipe/trace/frozen reports after the hick-up. See [1]
for more howtos.

If you post the dump, we may be able to analyse what the system is doing
before the problem report, if there are long delays due to high-prio
tasks e.g.

Jan

[1] http://www.xenomai.org/index.php/I-pipe:Tracer

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 250 bytes
Desc: OpenPGP digital signature
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070814/da8ca53d/attachment.pgp>

From rwatollenaar at gmail.com  Wed Aug 15 08:11:09 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Wed, 15 Aug 2007 08:11:09 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input framebuilding failed.
In-Reply-To: <46C1FFDA.4070709@web.de>
References: <46C02829.9020009@gmail.com>
	<46C04384.4030805@grandegger.com>	<46C05180.5090302@gmail.com>
	<46C05690.2010108@grandegger.com>	<46C063E0.1010809@gmail.com>
	<46C07005.8000504@web.de>	<46C1B498.8060600@gmail.com>	<Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>
	<46C1EE69.3020301@gmail.com> <46C1FFDA.4070709@web.de>
Message-ID: <46C298FD.8070300@gmail.com>

Hi,

> Check the /proc output again, there should be also RTnet's stack manager
> at prio 98. Maybe that is too low for your scenario and causes prio
> inversions (note: every incoming Ethernet frame goes through its hands).
> Try lowering the prio of your rt_task1 beneath 98.

Thanks. This seems to have made a big improvement. I have so far not 
once detected the scope to loose lock on the sawtooth when the 
index_check in eml is still disabled. Before lowering the priority of my 
task (to 97) I could still invoke what I suspect to be a latency spike.

If the index_check is enabled I now mostly have less problems too. There 
is a chance in start-up of the application that there is a latency spike 
and then the warning kicks in. Due to the fact that the shift is 
permanent, the error is persistent and this then destabilizes the 
sawtooth a bit.

I will keep the check disabled but for the EML chaps I do think this is 
a point of interest. I would be very interested how this index shift 
occurs and why it is persistent after occurring once.

Sorry for the pragmatic qualifications here but in the end its the 
stability of the outputs that will determine the behaviour of the 
machine so its not a bad way to assess the software. :)

> If the problem persists (or your _really_ want to understand what
> happens), you could try to put an xntrace_user_freeze(0, 1) before the
> line which emits that EML warning, turn on the I-pipe tracer, set a
> large back_trace_points value (a few thousand), enable verbose mode, and
> grab what /proc/ipipe/trace/frozen reports after the hick-up. See [1]
> for more howtos.

Done this before so it should not be a problem. Don't think it is 
necessary quite yet as the behaviour at the moment looks good.


Regards,

Roland.

> 
> If you post the dump, we may be able to analyse what the system is doing
> before the problem report, if there are long delays due to high-prio
> tasks e.g.
> 
> Jan
> 
> [1] http://www.xenomai.org/index.php/I-pipe:Tracer
> 


From jan.kiszka at web.de  Wed Aug 15 10:24:34 2007
From: jan.kiszka at web.de (Jan Kiszka)
Date: Wed, 15 Aug 2007 10:24:34 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input framebuilding failed.
In-Reply-To: <46C298FD.8070300@gmail.com>
References: <46C02829.9020009@gmail.com>
	<46C04384.4030805@grandegger.com>	<46C05180.5090302@gmail.com>
	<46C05690.2010108@grandegger.com>	<46C063E0.1010809@gmail.com>
	<46C07005.8000504@web.de>	<46C1B498.8060600@gmail.com>	<Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>
	<46C1EE69.3020301@gmail.com> <46C1FFDA.4070709@web.de>
	<46C298FD.8070300@gmail.com>
Message-ID: <46C2B842.1080501@web.de>

Roland Tollenaar wrote:
> Hi,
> 
>> Check the /proc output again, there should be also RTnet's stack manager
>> at prio 98. Maybe that is too low for your scenario and causes prio
>> inversions (note: every incoming Ethernet frame goes through its hands).
>> Try lowering the prio of your rt_task1 beneath 98.
> 
> Thanks. This seems to have made a big improvement. I have so far not
> once detected the scope to loose lock on the sawtooth when the
> index_check in eml is still disabled. Before lowering the priority of my
> task (to 97) I could still invoke what I suspect to be a latency spike.
> 
> If the index_check is enabled I now mostly have less problems too. There
> is a chance in start-up of the application that there is a latency spike
> and then the warning kicks in. Due to the fact that the shift is
> permanent, the error is persistent and this then destabilizes the
> sawtooth a bit.

Hmm, this doesn't convince me yet. Such skews during startup may as well
be triggered by unusual load during runtime (non-RT activity or new RT
components). Did you put your system under adequate non-RT load as well
while measuring the outputs?

> 
> I will keep the check disabled but for the EML chaps I do think this is
> a point of interest. I would be very interested how this index shift
> occurs and why it is persistent after occurring once.
> 
> Sorry for the pragmatic qualifications here but in the end its the
> stability of the outputs that will determine the behaviour of the
> machine so its not a bad way to assess the software. :)

A problem isn't solved until it is also understood.

> 
>> If the problem persists (or your _really_ want to understand what
>> happens), you could try to put an xntrace_user_freeze(0, 1) before the
>> line which emits that EML warning, turn on the I-pipe tracer, set a
>> large back_trace_points value (a few thousand), enable verbose mode, and
>> grab what /proc/ipipe/trace/frozen reports after the hick-up. See [1]
>> for more howtos.
> 
> Done this before so it should not be a problem. Don't think it is

In that case, I would even more suggest to collect the data, maybe now
about the fragile startup case.

> necessary quite yet as the behaviour at the moment looks good.

Jan

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 250 bytes
Desc: OpenPGP digital signature
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070815/c92cdf9a/attachment.pgp>

From rwatollenaar at gmail.com  Wed Aug 15 10:37:38 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Wed, 15 Aug 2007 10:37:38 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input framebuilding failed.
In-Reply-To: <46C2B842.1080501@web.de>
References: <46C02829.9020009@gmail.com>
	<46C04384.4030805@grandegger.com>	<46C05180.5090302@gmail.com>
	<46C05690.2010108@grandegger.com>	<46C063E0.1010809@gmail.com>
	<46C07005.8000504@web.de>	<46C1B498.8060600@gmail.com>	<Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>
	<46C1EE69.3020301@gmail.com> <46C1FFDA.4070709@web.de>
	<46C298FD.8070300@gmail.com> <46C2B842.1080501@web.de>
Message-ID: <46C2BB52.5090508@gmail.com>

> Hmm, this doesn't convince me yet. Such skews during startup may as well
> be triggered by unusual load during runtime (non-RT activity or new RT
> components). Did you put your system under adequate non-RT load as well
> while measuring the outputs?
could you please just remind me how to do this again? OR can i just run 
the latency test, it has dummy loading in it does it not?

>> Sorry for the pragmatic qualifications here but in the end its the
>> stability of the outputs that will determine the behaviour of the
>> machine so its not a bad way to assess the software. :)
> 
> A problem isn't solved until it is also understood.
You are so right. :(


> 
>>> If the problem persists (or your _really_ want to understand what
>>> happens), you could try to put an xntrace_user_freeze(0, 1) before the
>>> line which emits that EML warning, turn on the I-pipe tracer, set a
>>> large back_trace_points value (a few thousand), enable verbose mode, and
>>> grab what /proc/ipipe/trace/frozen reports after the hick-up. See [1]
>>> for more howtos.
>> Done this before so it should not be a problem. Don't think it is
> 
> In that case, I would even more suggest to collect the data, maybe now
> about the fragile startup case.

Have got it on my todo list. :)

Roland.


> 
>> necessary quite yet as the behaviour at the moment looks good.
> 
> Jan
> 


From rwatollenaar at gmail.com  Wed Aug 15 11:50:43 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Wed, 15 Aug 2007 11:50:43 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input framebuilding failed.
In-Reply-To: <46C2B842.1080501@web.de>
References: <46C02829.9020009@gmail.com>
	<46C04384.4030805@grandegger.com>	<46C05180.5090302@gmail.com>
	<46C05690.2010108@grandegger.com>	<46C063E0.1010809@gmail.com>
	<46C07005.8000504@web.de>	<46C1B498.8060600@gmail.com>	<Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>
	<46C1EE69.3020301@gmail.com> <46C1FFDA.4070709@web.de>
	<46C298FD.8070300@gmail.com> <46C2B842.1080501@web.de>
Message-ID: <46C2CC73.9080807@gmail.com>

Hi,

Some more interesting findings (no i-pipe trace yet though).

> Hmm, this doesn't convince me yet. Such skews during startup may as well
> be triggered by unusual load during runtime (non-RT activity or new RT
> components). Did you put your system under adequate non-RT load as well
> while measuring the outputs?
Running latencytest with my application shows an average latency of 
about 40 and a max of 200ns. This was rather shocking so I turned off 
rtcan in my application. Now the max latecy is 60ns. Turn off EML and 
turn on rtcan, max latecy is 230ns. How is that for strange? But since I 
can see the scope output bobbing with 200ns during the latency test, I 
can also see that if I run my application without the latency test the 
huge max latency disappears entirely. Maybe it is time for the trace but 
then again I am still using CAN over the parallel port so will see what 
it does on a machine with a PCI CAN adaptor first. Because I think I 
know what happens: Due to the external loading the CAN recv interrupt 
triggers the Rx ISR briefly before the 1ms task period ends. Due to the 
priority of the ISR (huge debate over this) and its atomicness (if I 
remember correctly) the reading out of the slow hardware delays the 
start of the new task period.

Just thought it was interesting to mention. Btw when the latency appears 
there are no overflow messages or anything like that which support the 
theory I have about the cause.

Btw2 the 200ns latency spikes do not cause the scope to loose lock on 
the saw-tooth so whatever causes that problem is of a different nature 
still.

Regards,

Roland.



> 
>> I will keep the check disabled but for the EML chaps I do think this is
>> a point of interest. I would be very interested how this index shift
>> occurs and why it is persistent after occurring once.
>>
>> Sorry for the pragmatic qualifications here but in the end its the
>> stability of the outputs that will determine the behaviour of the
>> machine so its not a bad way to assess the software. :)
> 
> A problem isn't solved until it is also understood.
> 
>>> If the problem persists (or your _really_ want to understand what
>>> happens), you could try to put an xntrace_user_freeze(0, 1) before the
>>> line which emits that EML warning, turn on the I-pipe tracer, set a
>>> large back_trace_points value (a few thousand), enable verbose mode, and
>>> grab what /proc/ipipe/trace/frozen reports after the hick-up. See [1]
>>> for more howtos.
>> Done this before so it should not be a problem. Don't think it is
> 
> In that case, I would even more suggest to collect the data, maybe now
> about the fragile startup case.
> 
>> necessary quite yet as the behaviour at the moment looks good.
> 
> Jan
> 


From wg at grandegger.com  Wed Aug 15 12:30:28 2007
From: wg at grandegger.com (Wolfgang Grandegger)
Date: Wed, 15 Aug 2007 12:30:28 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input framebuilding failed.
In-Reply-To: <46C2CC73.9080807@gmail.com>
References: <46C02829.9020009@gmail.com>	<46C04384.4030805@grandegger.com>	<46C05180.5090302@gmail.com>	<46C05690.2010108@grandegger.com>	<46C063E0.1010809@gmail.com>	<46C07005.8000504@web.de>	<46C1B498.8060600@gmail.com>	<Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>	<46C1EE69.3020301@gmail.com>
	<46C1FFDA.4070709@web.de>	<46C298FD.8070300@gmail.com>
	<46C2B842.1080501@web.de> <46C2CC73.9080807@gmail.com>
Message-ID: <46C2D5C4.2010407@grandegger.com>

Roland Tollenaar wrote:
> Hi,
> 
> Some more interesting findings (no i-pipe trace yet though).
> 
>> Hmm, this doesn't convince me yet. Such skews during startup may as well
>> be triggered by unusual load during runtime (non-RT activity or new RT
>> components). Did you put your system under adequate non-RT load as well
>> while measuring the outputs?
> Running latencytest with my application shows an average latency of 
> about 40 and a max of 200ns. This was rather shocking so I turned off 
> rtcan in my application. Now the max latecy is 60ns. Turn off EML and 
> turn on rtcan, max latecy is 230ns. How is that for strange? But since I 
> can see the scope output bobbing with 200ns during the latency test, I 
> can also see that if I run my application without the latency test the 
> huge max latency disappears entirely. Maybe it is time for the trace but 
> then again I am still using CAN over the parallel port so will see what 
> it does on a machine with a PCI CAN adaptor first. Because I think I 
> know what happens: Due to the external loading the CAN recv interrupt 
> triggers the Rx ISR briefly before the 1ms task period ends. Due to the 
> priority of the ISR (huge debate over this) and its atomicness (if I 
> remember correctly) the reading out of the slow hardware delays the 
> start of the new task period.
> 
> Just thought it was interesting to mention. Btw when the latency appears 
> there are no overflow messages or anything like that which support the 
> theory I have about the cause.
> 
> Btw2 the 200ns latency spikes do not cause the scope to loose lock on 
> the saw-tooth so whatever causes that problem is of a different nature 
> still.

s/ns/us/ ?

Wolfgang.


From rwatollenaar at gmail.com  Wed Aug 15 12:30:49 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Wed, 15 Aug 2007 12:30:49 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input framebuilding failed.
In-Reply-To: <46C2D5C4.2010407@grandegger.com>
References: <46C02829.9020009@gmail.com>	<46C04384.4030805@grandegger.com>	<46C05180.5090302@gmail.com>	<46C05690.2010108@grandegger.com>	<46C063E0.1010809@gmail.com>	<46C07005.8000504@web.de>	<46C1B498.8060600@gmail.com>	<Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>	<46C1EE69.3020301@gmail.com>
	<46C1FFDA.4070709@web.de>	<46C298FD.8070300@gmail.com>
	<46C2B842.1080501@web.de> <46C2CC73.9080807@gmail.com>
	<46C2D5C4.2010407@grandegger.com>
Message-ID: <46C2D5D9.8000402@gmail.com>

>>
>> Btw2 the 200ns latency spikes do not cause the scope to loose lock on 
>> the saw-tooth so whatever causes that problem is of a different nature 
>> still.
> 
> s/ns/us/ ?

Indeed. Sorry.

Roland


> 
> Wolfgang.
> 


From klaas.gadeyne at fmtc.be  Thu Aug 16 09:55:52 2007
From: klaas.gadeyne at fmtc.be (Klaas Gadeyne)
Date: Thu, 16 Aug 2007 09:55:52 +0200 (CEST)
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input framebuilding failed.
In-Reply-To: <46C1FFDA.4070709@web.de>
References: <46C02829.9020009@gmail.com> <46C04384.4030805@grandegger.com>
	<46C05180.5090302@gmail.com> <46C05690.2010108@grandegger.com>
	<46C063E0.1010809@gmail.com> <46C07005.8000504@web.de>
	<46C1B498.8060600@gmail.com>
	<Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>
	<46C1EE69.3020301@gmail.com> <46C1FFDA.4070709@web.de>
Message-ID: <Pine.LNX.4.64.0708160951040.18303@ampere.labo01.fmtc.be>

On Tue, 14 Aug 2007, Jan Kiszka wrote:
> Roland Tollenaar wrote:
[dropping some cc:'s]
>>> How many threads do you have sending process data, and what are there
>>> priorities? (/proc/xenomai/sched IIRC)
>> I have 3 rt tasks running. Only one sends and receives process data. The
>> priorities are:
>> rt_task1 99
>
> Check the /proc output again, there should be also RTnet's stack manager
> at prio 98. Maybe that is too low for your scenario and causes prio
> inversions (note: every incoming Ethernet frame goes through its hands).
> Try lowering the prio of your rt_task1 beneath 98.

Indeed (see the lowlevel send code I copy/pasted yesterday to
understand why), that should be documented somewhere!  Your
application threads should have a lower priority than RTnet's stack
manager.  Consider this lack of documentation as an EML bug and
provide a patch...

Klaas


From rwatollenaar at gmail.com  Thu Aug 16 09:58:29 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Thu, 16 Aug 2007 09:58:29 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input framebuilding failed.
In-Reply-To: <Pine.LNX.4.64.0708160951040.18303@ampere.labo01.fmtc.be>
References: <46C02829.9020009@gmail.com> <46C04384.4030805@grandegger.com>
	<46C05180.5090302@gmail.com> <46C05690.2010108@grandegger.com>
	<46C063E0.1010809@gmail.com> <46C07005.8000504@web.de>
	<46C1B498.8060600@gmail.com>
	<Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>
	<46C1EE69.3020301@gmail.com> <46C1FFDA.4070709@web.de>
	<Pine.LNX.4.64.0708160951040.18303@ampere.labo01.fmtc.be>
Message-ID: <46C403A5.8060404@gmail.com>

Hi,

> Indeed (see the lowlevel send code I copy/pasted yesterday to
> understand why), that should be documented somewhere!  Your
> application threads should have a lower priority than RTnet's stack
> manager.  Consider this lack of documentation as an EML bug and
> provide a patch...

Does it matter how much lower? If the stack is 98 is a priority for my 
thread of 97 sufficiently low or is priority inversion still a risk?

Regards,

Roland


> 
> Klaas
> 


From jan.kiszka at web.de  Thu Aug 16 10:21:48 2007
From: jan.kiszka at web.de (Jan Kiszka)
Date: Thu, 16 Aug 2007 10:21:48 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input framebuilding failed.
In-Reply-To: <Pine.LNX.4.64.0708160951040.18303@ampere.labo01.fmtc.be>
References: <46C02829.9020009@gmail.com>
	<46C04384.4030805@grandegger.com>	<46C05180.5090302@gmail.com>
	<46C05690.2010108@grandegger.com>	<46C063E0.1010809@gmail.com>
	<46C07005.8000504@web.de>	<46C1B498.8060600@gmail.com>	<Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>	<46C1EE69.3020301@gmail.com>
	<46C1FFDA.4070709@web.de>
	<Pine.LNX.4.64.0708160951040.18303@ampere.labo01.fmtc.be>
Message-ID: <46C4091C.1080704@web.de>

Klaas Gadeyne wrote:
> On Tue, 14 Aug 2007, Jan Kiszka wrote:
>> Roland Tollenaar wrote:
> [dropping some cc:'s]
>>>> How many threads do you have sending process data, and what are there
>>>> priorities? (/proc/xenomai/sched IIRC)
>>> I have 3 rt tasks running. Only one sends and receives process data. The
>>> priorities are:
>>> rt_task1 99
>> Check the /proc output again, there should be also RTnet's stack manager
>> at prio 98. Maybe that is too low for your scenario and causes prio
>> inversions (note: every incoming Ethernet frame goes through its hands).
>> Try lowering the prio of your rt_task1 beneath 98.
> 
> Indeed (see the lowlevel send code I copy/pasted yesterday to
> understand why), that should be documented somewhere!  Your
> application threads should have a lower priority than RTnet's stack
> manager.  Consider this lack of documentation as an EML bug and
> provide a patch...

Klaas, does this mean that the EML stack has implicit ordering
requirements between RTnet's RX task and applications threads in
multi-user scenarios? I'm asking as this could easily fall apart again
on SMP. Is there some lock lacking?

Jan

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 250 bytes
Desc: OpenPGP digital signature
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070816/9b96a8c0/attachment.pgp>

From klaas.gadeyne at fmtc.be  Thu Aug 16 10:30:41 2007
From: klaas.gadeyne at fmtc.be (Klaas Gadeyne)
Date: Thu, 16 Aug 2007 10:30:41 +0200 (CEST)
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input framebuilding failed.
In-Reply-To: <46C1EE69.3020301@gmail.com>
References: <46C02829.9020009@gmail.com> <46C04384.4030805@grandegger.com>
	<46C05180.5090302@gmail.com> <46C05690.2010108@grandegger.com>
	<46C063E0.1010809@gmail.com> <46C07005.8000504@web.de>
	<46C1B498.8060600@gmail.com>
	<Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>
	<46C1EE69.3020301@gmail.com>
Message-ID: <Pine.LNX.4.64.0708160956010.18303@ampere.labo01.fmtc.be>

On Tue, 14 Aug 2007, Roland Tollenaar wrote:
[Again dropping cc:'s for EML specific issues, and adding eml-devel]

[...]
>> What do you mean with "inputs functioning perfectly"?
>
> The digital inputs are packed into the frame as are the digital outputs
> and analog output process data. The outputs function as they should but
> the warning complains mainly about the retrieving part of the ethercat
> cycle. Hence my comment that the digital inputs also function as they
> should that is to say the data arrives correctly and uncorrupted. AFAI
> understand from ETG the index is not changed by the ESC's so I would
> expect the check always return true. But even if it does not what does
> that mean? Can it mean that EML is losing some frames that have been
> transmitted? I.e. the index is incremented with every transmit and the
> message with the same index is expected on the next read but instead it
> is only getting one later? If so, what could cause this?

Probably something like this happens: One frame somehow gets lost
(wireshark should confirm this), the next txandrx happens before the
timeout of the first txandrx, and the first txandrx accepts a message
that it shouldn't be accepting.

HOWEVER, if you look at the txandrx code I copy pasted in a previous
mail (berlios seems to be down), you can see that this shouldn't be
happening since Tom apparently uses a _global_ lock for this, unless I
overlook something (which is probably the case)...

So, given the implementation with the global lock (one can discuss
whether it's optimal, feel free to provide a patch) I don't understand
how this happens.

////////////////////////////////////////////////////////////////////////
// For thread safety: txandrx() can be called from multiple threads...
static pthread_mutex_t txandrx_mut;

static bool ec_rtdm_txandrx(struct EtherCAT_Frame * frame, struct
netif * netif) {
         int tries = 0;
         while (tries < MAX_TRIES_TX) {
                 pthread_mutex_lock (&txandrx_mut);
                 if (low_level_output(frame,netif)){
                         if (low_level_input(frame,netif)){
                                 pthread_mutex_unlock(&txandrx_mut);
                                 return true;
                         }
                         else{
                                 //log(EC_LOG_ERROR,
 				"low_level_txandrx: receiving
 				failed\n");
                                 pthread_mutex_unlock(&txandrx_mut);
                         }
                 }
                 else{
                         //log(EC_LOG_ERROR, "low_level_txandrx:
 			sending failed\n");
                         pthread_mutex_unlock(&txandrx_mut);
                 }
                 tries++;
         }
         log(EC_LOG_FATAL, "low_level_txandrx: failed: MAX_TRIES_TX:
 	Giving up\n");
         return false;
}
///////////////////////////////////////////////////////////////////////

Unless of course (thinking doesn't hurt), I think other problems could occur
with this implementation.

[I've only had a short look at Tom's code, so feel free to correct
me...]
   Since the locking of the mutex happens inside the while loop, this
   construction seems not particularly threadsafe.  If I look at the
   implementation of low_level_input(), the receiving part on the raw
   socket is implemented like this:

   int len_recv = recv(sock,buffer_receive,sizeof(buffer_receive),0);

   Looking at the top of the driver file, the socket timeout is set to

// Maximum tries to send and receive a message
#define MAX_TRIES_TX 10
// Timeout for receiving and transmitting messages is 10ms
#define TIMEOUT_NSEC 1000 * 100

   [I think s/10ms/100us/g]

   while you're are trying to send at a 1ms period.  So IMO this can
   cause race conditions...

   - Thread sends message, frame somehow gets lost, but timeout is set to
   100 us
   - After 1 ms, thread is woken up again, tries to send msg (should
   fail since mutex is locked).

   I can't predict exactly what will be happening, but by just looking
   at the code, I would say, this ain't gonna work...

Does your problem also occur, if your PD thread only sends at a 2ms
rate (or if you decrease MAX_TRIES_TX to 5 for instance)

[...]
> What I did was simply put a printf line into EML to output index and
> m_idx to screen. So unfortunately this does not tell us where the shift
> is acquired.

Not a plain simple printf() I might hope?

Klaas


From klaas.gadeyne at fmtc.be  Thu Aug 16 10:32:15 2007
From: klaas.gadeyne at fmtc.be (Klaas Gadeyne)
Date: Thu, 16 Aug 2007 10:32:15 +0200 (CEST)
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input framebuilding failed.
In-Reply-To: <46C403A5.8060404@gmail.com>
References: <46C02829.9020009@gmail.com> <46C04384.4030805@grandegger.com>
	<46C05180.5090302@gmail.com> <46C05690.2010108@grandegger.com>
	<46C063E0.1010809@gmail.com> <46C07005.8000504@web.de>
	<46C1B498.8060600@gmail.com>
	<Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>
	<46C1EE69.3020301@gmail.com> <46C1FFDA.4070709@web.de>
	<Pine.LNX.4.64.0708160951040.18303@ampere.labo01.fmtc.be>
	<46C403A5.8060404@gmail.com>
Message-ID: <Pine.LNX.4.64.0708161031540.18303@ampere.labo01.fmtc.be>

On Thu, 16 Aug 2007, Roland Tollenaar wrote:
> Hi,
>
>> Indeed (see the lowlevel send code I copy/pasted yesterday to
>> understand why), that should be documented somewhere!  Your
>> application threads should have a lower priority than RTnet's stack
>> manager.  Consider this lack of documentation as an EML bug and
>> provide a patch...
>
> Does it matter how much lower? If the stack is 98 is a priority for my
> thread of 97 sufficiently low or is priority inversion still a risk?

97 should do

Klaas


From rwatollenaar at gmail.com  Thu Aug 16 10:57:45 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Thu, 16 Aug 2007 10:57:45 +0200
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input framebuilding failed.
In-Reply-To: <46C4091C.1080704@web.de>
References: <46C02829.9020009@gmail.com>
	<46C04384.4030805@grandegger.com>	<46C05180.5090302@gmail.com>
	<46C05690.2010108@grandegger.com>	<46C063E0.1010809@gmail.com>
	<46C07005.8000504@web.de>	<46C1B498.8060600@gmail.com>	<Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>	<46C1EE69.3020301@gmail.com>
	<46C1FFDA.4070709@web.de>
	<Pine.LNX.4.64.0708160951040.18303@ampere.labo01.fmtc.be>
	<46C4091C.1080704@web.de>
Message-ID: <46C41189.2060005@gmail.com>

> 
> Klaas, does this mean that the EML stack has implicit ordering
> requirements between RTnet's RX task and applications threads in
> multi-user scenarios? I'm asking as this could easily fall apart again
> on SMP. Is there some lock lacking?

Stupid question but SMP stands for?

Roland


> 
> Jan
> 


From klaas.gadeyne at fmtc.be  Thu Aug 16 11:01:53 2007
From: klaas.gadeyne at fmtc.be (Klaas Gadeyne)
Date: Thu, 16 Aug 2007 11:01:53 +0200 (CEST)
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input framebuilding failed.
In-Reply-To: <46C41189.2060005@gmail.com>
References: <46C02829.9020009@gmail.com> <46C04384.4030805@grandegger.com>
	<46C05180.5090302@gmail.com> <46C05690.2010108@grandegger.com>
	<46C063E0.1010809@gmail.com> <46C07005.8000504@web.de>
	<46C1B498.8060600@gmail.com>
	<Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>
	<46C1EE69.3020301@gmail.com> <46C1FFDA.4070709@web.de>
	<Pine.LNX.4.64.0708160951040.18303@ampere.labo01.fmtc.be>
	<46C4091C.1080704@web.de> <46C41189.2060005@gmail.com>
Message-ID: <Pine.LNX.4.64.0708161101331.18303@ampere.labo01.fmtc.be>

On Thu, 16 Aug 2007, Roland Tollenaar wrote:
>> Klaas, does this mean that the EML stack has implicit ordering
>> requirements between RTnet's RX task and applications threads in
>> multi-user scenarios? I'm asking as this could easily fall apart again
>> on SMP. Is there some lock lacking?
>
> Stupid question but SMP stands for?

<http://en.wikipedia.org/wiki/Symmetric_multiprocessing>


From klaas.gadeyne at fmtc.be  Thu Aug 16 11:23:20 2007
From: klaas.gadeyne at fmtc.be (Klaas Gadeyne)
Date: Thu, 16 Aug 2007 11:23:20 +0200 (CEST)
Subject: [Ethercatmaster-users] [Xenomai-help] EML conflict with RTCAN?
 low_level_input framebuilding failed.
In-Reply-To: <46C4091C.1080704@web.de>
References: <46C02829.9020009@gmail.com> <46C04384.4030805@grandegger.com>
	<46C05180.5090302@gmail.com> <46C05690.2010108@grandegger.com>
	<46C063E0.1010809@gmail.com> <46C07005.8000504@web.de>
	<46C1B498.8060600@gmail.com>
	<Pine.LNX.4.64.0708141629570.18303@ampere.labo01.fmtc.be>
	<46C1EE69.3020301@gmail.com> <46C1FFDA.4070709@web.de>
	<Pine.LNX.4.64.0708160951040.18303@ampere.labo01.fmtc.be>
	<46C4091C.1080704@web.de>
Message-ID: <Pine.LNX.4.64.0708161101590.18303@ampere.labo01.fmtc.be>

On Thu, 16 Aug 2007, Jan Kiszka wrote:
> Klaas Gadeyne wrote:
>> On Tue, 14 Aug 2007, Jan Kiszka wrote:
>>> Roland Tollenaar wrote:
>> [dropping some cc:'s]
>>>>> How many threads do you have sending process data, and what are there
>>>>> priorities? (/proc/xenomai/sched IIRC)
>>>> I have 3 rt tasks running. Only one sends and receives process data. The
>>>> priorities are:
>>>> rt_task1 99
>>> Check the /proc output again, there should be also RTnet's stack manager
>>> at prio 98. Maybe that is too low for your scenario and causes prio
>>> inversions (note: every incoming Ethernet frame goes through its hands).
>>> Try lowering the prio of your rt_task1 beneath 98.
>>
>> Indeed (see the lowlevel send code I copy/pasted yesterday to
>> understand why), that should be documented somewhere!  Your
>> application threads should have a lower priority than RTnet's stack
>> manager.  Consider this lack of documentation as an EML bug and
>> provide a patch...
>
> Klaas, does this mean that the EML stack has implicit ordering
> requirements between RTnet's RX task and applications threads in
> multi-user scenarios? I'm asking as this could easily fall apart again
> on SMP. Is there some lock lacking?

[Tom, correct me if I'm wrong here]

I haven't sorted it out yet, but it shouldn't.  IIRC Tom's original
implementation didn't contain the while loop in the txandrx call
(grrrrrr, berlios still down).  Again, IIRC, he added it, because
sometimes, during initialization (typically not done in a periodic
thread), when frames got lost, EML just gave up completely.  Now,
since this happened at a couple of places, he decided to put the while
loop in the lower level txandrx code, instead of in several places in
the higher level layers during initialization.

Now, as explained in my previous message, when running this code in a
periodic thread (when all stuff is in its operational state), things
might go wrong when a message arrives after the timeout [*] due to
a) You can have a periodic thread with a period smaller than the
maxtries cycle it takes, which messes things up.
b) the fact that the lock is in (and not around) the while loop.

It seems to me (but I cannot conclude this 100% sure from what Roland
reports) that somehow this scenario occurs:
1/ tries = 0 A first frame is sent out
2/ Somehow, this frame gets delayed more than the timeout [again *]
3/ tries = 1 A second frame (identical to the first one) is sent out
4/ The first frame has arrived back meanwhile and is captured by the
    recv call (no error since they are identical), all seems well.
5/ tries = 0 A third frame (different from the first two) is sent out
6/ The recv call get the second frame back, detects the index is
    wrong, and drops it.

So, ATM I don't think we need another lock, but we (or someone else :)
should get the above behaviour fixed first.
Somehow (I think this is rather related to a) above) this gets solved
(I noticed that my original reasoning about the priorities was not
correct since I hadn't seen the timeout on the socket then) by
altering the priorities, but I think that is not the basic problem here.

Roland, what happens if you simply remove the while loop (make sure to
put EtherCAT logging to verbose mode)?

[*] Somebody should reread the docu in the spec about transmission
rates/times...

Klaas


From rwatollenaar at gmail.com  Fri Aug 17 16:11:27 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Fri, 17 Aug 2007 16:11:27 +0200
Subject: [Ethercatmaster-users] system freezes on calling
Message-ID: <46C5AC8F.8010708@gmail.com>

Hi,

my system freezes completely when I call

/usr/local/rtnet/sbin/rtifconfig rteth0 up

on a system that is known to function. Below startup script usually 
works but on a new installation (same kernel) of my linux distribution 
it now fails.

Is there something I am forgetting to do/configure/start before trying 
to bring up rtnet?

Kind regards,

Roland


#!/bin/bash

#rmmod 8139too		
rmmod natsemi

mknod /dev/rtnet c 10 240
insmod /usr/local/rtnet/modules/rtnet.ko rtskb_cache_size=512 #making 
this value too small causes problems witht he combination rtcan & eml It 
appears as thought the maximum value is 64 (see /proc/rtnet/rtskbf) 
stands for socket buffers.
insmod /usr/local/rtnet/modules/rtpacket.ko
insmod /usr/local/rtnet/modules/rt_loopback.ko
#insmod /usr/local/rtnet/modules/rt_8139too.ko
insmod /usr/local/rtnet/modules/rt_natsemi.ko
/usr/local/rtnet/sbin/rtifconfig rtlo up
/usr/local/rtnet/sbin/rtifconfig rteth0 up


From harti_said at yahoo.fr  Tue Aug 21 14:39:03 2007
From: harti_said at yahoo.fr (said harti)
Date: Tue, 21 Aug 2007 14:39:03 +0200 (CEST)
Subject: [Ethercatmaster-users] EL6751 CANopen Configuration !!!
Message-ID: <465145.40421.qm@web37301.mail.mud.yahoo.com>

Hi,

I am trying to intergrate EL6751 CANopen Module to my test plateform, thanks to the Twincat tool, i can configure Mbx_SM, PD_SM, and FMMUs of this module...
Now, i look for, and try to prepare an CoE frame (MbxHdr, CoEHdr...) in order to communicate with CANopen Slaves via the EL6751 module.

So first, i have set this module to OP State thanks to my code below :

///SlaveConfig EL6751

EtherCAT_FMMU_Config fmmu_config_EL6751(3);

EC_FMMU fmmu0_EL6751(0x00011000,0x0010,0x00,0x07,0x1000,0x00,false,true,true);
EC_FMMU fmmu1_EL6751(0x00011800,0x0008,0x00,0x07,0x1400,0x00,true,false,true);
EC_FMMU fmmu2_EL6751(0x00080000,0x0001,0x01,0x01,0x080D,0x00,true,false,true);

EC_SyncMan syncman_mbx0_EL6751(0x1800,558,EC_QUEUED,EC_WRITTEN_FROM_MASTER,true,false,false,false,false,false,EC_FIRST_BUFFER,true);
EC_SyncMan syncman_mbx1_EL6751(0x1A2E,558,EC_QUEUED,EC_READ_FROM_MASTER,true,false,false,false,false,false,EC_FIRST_BUFFER,true);

EtherCAT_PD_Config pd_config_EL6751(2);///argument=length

EC_SyncMan syncman0_EL6751(0x1000,16,EC_BUFFERED,EC_WRITTEN_FROM_MASTER,true,false,false,false,false,false,EC_FIRST_BUFFER,true);
EC_SyncMan syncman1_EL6751(0x1400,8,EC_BUFFERED,EC_READ_FROM_MASTER,true,false,false,false,false,false,EC_FIRST_BUFFER,true);


EtherCAT_SlaveConfig EC_EL6751(0x1A5F3052,0x00000001,0x03ed,&fmmu_config_EL6751,&pd_config_EL6751,&mbx_conf_EL6751);

EtherCAT_MbxConfig mbx_conf_EL6751 = {syncman_mbx0_EL6751, syncman_mbx1_EL6751};

static void init_slave_db() {

         EtherCAT_SlaveDb * slave_db = EtherCAT_SlaveDb::instance(5);



///Connect actual fmmu and process data config to respective handlesfor for EL 4102 (AO)

         fmmu_config_EL4102[0] = fmmu0_EL4102;
         fmmu_config_EL4102[1] = fmmu1_EL4102;
         pd_config_EL4102[0] = syncman0_EL4102;
         pd_config_EL4102[1] = syncman1_EL4102;

///Connect actual fmmu and process data config to respective handles for EL 2004 (DO)

         fmmu_config_EL2004[0] = fmmu0_EL2004;///
         pd_config_EL2004[0] = syncman0_EL2004;///

///Connect actual fmmu and process data config to respective handles for EL 1004 (DI)

         fmmu_config_EL1004[0] = fmmu0_EL1004;///
         pd_config_EL1004[0] = syncman0_EL1004;///

         ///Connect actual fmmu and process data config to respective handles for EL 6751 (CoE)

         fmmu_config_EL6751[0] = fmmu0_EL6751;
         fmmu_config_EL6751[1] = fmmu1_EL6751;
         fmmu_config_EL6751[2] = fmmu2_EL6751;

///Commit the slave config objects to the slave database

     slave_db->set_conf(&EC_EK1100,0); 
     slave_db->set_conf(&EC_EL4102,1);
     

///Commit the slave config objects to the slave database

         slave_db->set_conf(&EC_EL2004,2);///

///Commit the slave config objects to the slave database

         slave_db->set_conf(&EC_EL1004,3);///

///Commit the slave config objects to the slave database

         slave_db->set_conf(&EC_EL6751,4);///   
 }


The EL6751 module is set to OP state without problem, but if i add those two lines to my code (in order to connect process data config to respective handles for EL6751), it's impossible to set this module to OP state :

pd_config_EL6751[0] = syncman0_EL6751;
pd_config_EL6751[1] = syncman1_EL6751;


1) Please, If you have some adeas about this problem, let me know...

2) My second questuion is about Mailbox. Which EML function i must use to send Mailbox messages (Mbx_Hdr+CoE_Hdr...) ? it's the same one for EtherCAT : txandrx() ???

Said



       
---------------------------------
 Ne gardez plus qu'une seule adresse mail ! Copiez vos mails vers Yahoo! Mail 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070821/8e3e0ed7/attachment.html>

From rwatollenaar at gmail.com  Tue Aug 21 14:46:56 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Tue, 21 Aug 2007 14:46:56 +0200
Subject: [Ethercatmaster-users] EML documentation
Message-ID: <46CADEC0.3000608@gmail.com>

Hi,

There is not yet much EML documentation, I understand that Tom's thesis 
is available but written in dutch. Is it possible to get a version of 
this thesis?

Regards,

Roland



From rwatollenaar at gmail.com  Tue Aug 21 15:25:09 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Tue, 21 Aug 2007 15:25:09 +0200
Subject: [Ethercatmaster-users] RE :  EML documentation
In-Reply-To: <754905.25640.qm@web37313.mail.mud.yahoo.com>
References: <754905.25640.qm@web37313.mail.mud.yahoo.com>
Message-ID: <46CAE7B5.3050209@gmail.com>

Yes, but where is the rest of it? :)

RR

said harti wrote:
> Do you spoke about this EML document Rolland ?!!
> 
> There is also some new documentation about EtherCAT Specification on the 
> ETG Member Area, you can understand and find some information.
> 
> Said
> 
> */Roland Tollenaar <rwatollenaar at gmail.com>/* a ?crit :
> 
>     Hi,
> 
>     There is not yet much EML documentation, I understand that Tom's thesis
>     is available but written in dutch. Is it possible to get a version of
>     this thesis?
> 
>     Regards,
> 
>     Roland
> 
>     _______________________________________________
>     Ethercatmaster-users mailing list
>     Ethercatmaster-users at lists.berlios.de
>     https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
> 
> 
> ------------------------------------------------------------------------
> Stockage illimit? de vos mails avec Yahoo! Mail. Changez aujourd'hui de 
> mail ! <http://fr.promotions.yahoo.com/mail/nouveau_yahoomail2.html>


From klaas.gadeyne at fmtc.be  Wed Aug 22 15:55:42 2007
From: klaas.gadeyne at fmtc.be (Klaas Gadeyne)
Date: Wed, 22 Aug 2007 15:55:42 +0200 (CEST)
Subject: [Ethercatmaster-users] EL6751 CANopen Configuration !!!
In-Reply-To: <465145.40421.qm@web37301.mail.mud.yahoo.com>
References: <465145.40421.qm@web37301.mail.mud.yahoo.com>
Message-ID: <alpine.DEB.0.999.0708221553400.16362@ampere.labo01.fmtc.be>


[...]
> 2) My second questuion is about Mailbox. Which EML function i must use to send Mailbox messages (Mbx_Hdr+CoE_Hdr...) ? it's the same one for EtherCAT : txandrx() ???

See
<http://ethercatmaster.berlios.de/doxygen/html/classEtherCAT__Mbx.html>
<http://ethercatmaster.berlios.de/doxygen/html/classEtherCAT__CoE__MbxMsg.html>

I don't even know if they are implemented.  For sure they are not
tested.  Use the source, use the spec, luke.

Klaas



From harti_said at yahoo.fr  Fri Aug 24 09:20:52 2007
From: harti_said at yahoo.fr (said harti)
Date: Fri, 24 Aug 2007 09:20:52 +0200 (CEST)
Subject: [Ethercatmaster-users] RE : Re:  EL6751 CANopen Configuration !!!
In-Reply-To: <alpine.DEB.0.999.0708221553400.16362@ampere.labo01.fmtc.be>
Message-ID: <539893.71640.qm@web37304.mail.mud.yahoo.com>

Thanks Klaas for your reponse...

After have readed a spec and look at the EML libray, i think that there is an importante difference between EtherCAT_CoE_MbxMsg and EtherCAT_MbxMsg, this difference is that in the first one we can specifie the CAN services, (which i hope to do) but in the second one we can just send a simple mbx message (thanks to write or read functions) without specifie exactly the services type of our protocole (CAN in my case).

1) So, now, i hope use EtherCAT_CoE_MbxMsg, (i have eready prepare it) but i don't know how can i send it ? which EML function  alow  to  send it ???

2) my second question,  is simply, how our ethrcat process will be able to transmet my EtherCAT_CoE_MbxMsg to the EL6751 CANopen module ? (there is other eml function parameters for Mailbox ????)

Thanks

Said 

Klaas Gadeyne <klaas.gadeyne at fmtc.be> a ?crit : 
[...]
> 2) My second questuion is about Mailbox. Which EML function i must use to send Mailbox messages (Mbx_Hdr+CoE_Hdr...) ? it's the same one for EtherCAT : txandrx() ???

See



I don't even know if they are implemented.  For sure they are not
tested.  Use the source, use the spec, luke.

Klaas



       
---------------------------------
 Ne gardez plus qu'une seule adresse mail ! Copiez vos mails vers Yahoo! Mail 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070824/dad26d84/attachment.html>

From rwatollenaar at gmail.com  Mon Aug 27 15:52:25 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Mon, 27 Aug 2007 15:52:25 +0200
Subject: [Ethercatmaster-users] Tr: First Eml Error
In-Reply-To: <609685.7363.qm@web37313.mail.mud.yahoo.com>
References: <609685.7363.qm@web37313.mail.mud.yahoo.com>
Message-ID: <46D2D719.4030106@gmail.com>

HI Said,

It looks like you are not getting a clean socket.

Socket created: socket id: 3
 > Got interface: index: 0
 > Cannot set timout: Invalid argument
 > Continue without timeout

I have never seen the message of the timeout. Is that your output or 
does it arise from eml?

If it arises from eml see if you can find it in the code. If you tell me 
in which file the printf("Cannot se timout: Invalid argument") resides I 
will try to help you. I don;t have the time at the moment to look for 
it, eml is written a bit hairy and it takes quite a bit of digging to to 
sift through the layers.

Roland







said harti wrote:
> Hi Rolland,
> 
> I have resolved my problem concerning first eml error,
> 
> thanks so match
> 
> Said
> 
> Remarque : message transf?r? en pi?ce jointe.
> 
> ------------------------------------------------------------------------
> Stockage illimit? de vos mails avec Yahoo! Mail. Changez aujourd'hui de 
> mail ! <http://fr.promotions.yahoo.com/mail/nouveau_yahoomail2.html>
> ------------------------------------------------------------------------
> 
> Subject:
> First Eml Error
> From:
> said harti <harti_said at yahoo.fr>
> Date:
> Mon, 27 Aug 2007 12:01:24 +0200 (CEST)
> To:
> rolandtollenaar at gmail.com
> 
> To:
> rolandtollenaar at gmail.com
> 
> 
> Hi Rolland,
> 
> Please, can you tell me what has the solution about this first 
> communication eml  error :
> 
> /Socket created: socket id: 3
> />/ Got interface: index: 0
> />/ Cannot set timout: Invalid argument
> />/ Continue without timeout
> />/ Attach netif
> />/ 
> />/ Master initializing
> />/ 
> />/ low_level_output(): Cannot Send
> />/ low_level_output(): Cannot Send
> />/ low_level_output(): Cannot Send
> />/ low_level_output(): Cannot Send
> />/ low_level_output(): Cannot Send
> />/ low_level_output(): Cannot Send
> />/ low_level_output(): Cannot Send
> />/ low_level_output(): Cannot Send
> />/ low_level_output(): Cannot Send
> />/ low_level_output(): Cannot Send
> />/ low_level_txandrx: failed: MAX_TRIES_TX: Giving up
> />/ DLL::txandrx() Error
> />/ Error sending
>  counter frame
> />/ Something went wrong while scanning network
> />/ EtherCAT_AL:: Can't init network
> />/ Getting slave handler
> />/ EtherCAT_AL: No such slave, returning NULL
> />/ Setting EK1100 to OP STATE
> />/ Segmentation fault
> 
> we have got this error at the fisrt of our EtherCAT installation (on jun month)
> 
> what has the solution ? :-(
> 
> Best Regards,
> 
> Said
> /
> 
> 
> 
> */Roland Tollenaar <rwatollenaar at gmail.com>/* a ?crit :
> 
>     Yes, but where is the rest of it? :)
> 
>     RR
> 
>     said harti wrote:
>      > Do you spoke about this EML document Rolland ?!!
>      >
>      > There is also some new documentation about EtherCAT Specification
>     on the
>      > ETG Member Area, you can understand and find some information.
>      >
>      > Said
>      >
>      > */Roland Tollenaar /* a ?crit :
>      >
>      > Hi,
>      >
>      > There is not yet much EML documentation, I understand that Tom's
>     thesis
>      > is available but written in dutch. Is it possible to get a version of
>      > this thesis?
>      >
>      > Regards,
>      >
>      > Roland
>      >
>      > _______________________________________________
>      > Ethercatmaster-users mailing list
>      > Ethercatmaster-users at lists.berlios.de
>      > https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>      >
>      >
>      >
>     ------------------------------------------------------------------------
>      > Stockage illimit? de vos mails avec Yahoo! Mail. Changez
>     aujourd'hui de
>      > mail !
> 
> 
> ------------------------------------------------------------------------
> Stockage illimit? de vos mails avec Yahoo! Mail. Changez aujourd'hui de 
> mail ! <http://fr.promotions.yahoo.com/mail/nouveau_yahoomail2.html>


From harti_said at yahoo.fr  Tue Aug 28 11:54:13 2007
From: harti_said at yahoo.fr (said harti)
Date: Tue, 28 Aug 2007 11:54:13 +0200 (CEST)
Subject: [Ethercatmaster-users] RE : Re:  EL6751 CANopen Configuration !!!
In-Reply-To: <alpine.DEB.0.999.0708221553400.16362@ampere.labo01.fmtc.be>
Message-ID: <600365.57829.qm@web37308.mail.mud.yahoo.com>



Klaas Gadeyne <klaas.gadeyne at fmtc.be> a ?crit : 
[...]
> 2) My second questuion is about Mailbox. Which EML function i must use to send Mailbox messages (Mbx_Hdr+CoE_Hdr...) ? it's the same one for EtherCAT : txandrx() ???

See



I don't even know if they are implemented.  For sure they are not
tested.  Use the source, use the spec, luke.

Klaas

Hi,

Thanks for your responses.

I think that the read() and write() eml functions are not emplemented

see :
http://ethercatmaster.berlios.de/doxygen/html/classEtherCAT__Mbx.html

So, do you think that the check_mbx() and post_mbx functions will allows me to send CoE Mailbox Messages???

see :
EtherCAT_Router.cxx
and
http://ethercatmaster.berlios.de/doxygen/html/ethercat__router_8h-source.html

King Regards,

Said


       
---------------------------------
 Stockage illimit? de vos mails avec Yahoo! Mail. Changez aujourd'hui de mail !
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070828/f740f10b/attachment.html>

From harti_said at yahoo.fr  Tue Aug 28 17:27:47 2007
From: harti_said at yahoo.fr (said harti)
Date: Tue, 28 Aug 2007 17:27:47 +0200 (CEST)
Subject: [Ethercatmaster-users] Send Mailbox Messages errors!
In-Reply-To: <alpine.DEB.0.999.0708221553400.16362@ampere.labo01.fmtc.be>
Message-ID: <825125.41592.qm@web37303.mail.mud.yahoo.com>


Hi,

In order to send Mailbox messages, i'll test post_mbxmsg() eml function,
but when i use  EtherCAT_Router object :

EtherCAT_Router * ec_router = EtherCAT_Router::instance();
ec_router->post_mbxmsg(&a_CoE_MsgMbx, sh_el6751)

i got this error :

incomplete type 'EtherCAT_Router' used in nested name specifier

if you have some ideas, let me know please ?

Regards,

Said



Klaas Gadeyne <klaas.gadeyne at fmtc.be> a ?crit : 
[...]
> 2) My second questuion is about Mailbox. Which EML function i must use to send Mailbox messages (Mbx_Hdr+CoE_Hdr...) ? it's the same one for EtherCAT : txandrx() ???

See



I don't even know if they are implemented.  For sure they are not
tested.  Use the source, use the spec, luke.

Klaas



       
---------------------------------
 Ne gardez plus qu'une seule adresse mail ! Copiez vos mails vers Yahoo! Mail 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ethercatmaster-users/attachments/20070828/0e45225b/attachment.html>

From sancelot at free.fr  Tue Aug 28 18:00:46 2007
From: sancelot at free.fr (=?ISO-8859-1?Q?St=E9phane_ANCELOT?=)
Date: Tue, 28 Aug 2007 18:00:46 +0200
Subject: [Ethercatmaster-users] mbx question
Message-ID: <46D446AE.6050100@free.fr>

Hi,
When using post_mbx msg from the master what do I have to set in from_sh
 parameter ???

Best Regards
Steph


From klaas.gadeyne at fmtc.be  Wed Aug 29 09:07:17 2007
From: klaas.gadeyne at fmtc.be (Klaas Gadeyne)
Date: Wed, 29 Aug 2007 09:07:17 +0200 (CEST)
Subject: [Ethercatmaster-users] RE : Re: EL6751 CANopen Configuration !!!
In-Reply-To: <600365.57829.qm@web37308.mail.mud.yahoo.com>
References: <600365.57829.qm@web37308.mail.mud.yahoo.com>
Message-ID: <Pine.LNX.4.64.0708290859490.6617@ampere.labo01.fmtc.be>

On Tue, 28 Aug 2007, said harti wrote:
> I think that the read() and write() eml functions are not emplemented
>
> see :
> http://ethercatmaster.berlios.de/doxygen/html/classEtherCAT__Mbx.html
>
> So, do you think that the check_mbx() and post_mbx functions will allows me to send CoE Mailbox Messages???
>
> see :
> EtherCAT_Router.cxx
> and
> http://ethercatmaster.berlios.de/doxygen/html/ethercat__router_8h-source.html

IIRC (again, don't trust my word for it, the spec provides the
definitive answer), the router is "just a router", it's basically a
(lower priority) thread that "routes" mailbox messages from one slave
to another.  To that extent, it checks if a slave indicated that it
wants to post a mbx message, reads that message and forwards it to its
destination.
Therefore it uses those 2 functions you mention above.  However, since
it's meant for routing only, those functions are private (and hence
not available to the master).
However, I think they might be a good starting point in order to
implement functions that achieve similar communication between master
and slave.

ps.  I noticed the berlios doxygen documentation for the router is not
completely up-to-date, I'll try to find some time to have a look at
that...

Klaas


From klaas.gadeyne at fmtc.be  Wed Aug 29 09:10:06 2007
From: klaas.gadeyne at fmtc.be (Klaas Gadeyne)
Date: Wed, 29 Aug 2007 09:10:06 +0200 (CEST)
Subject: [Ethercatmaster-users] Send Mailbox Messages errors!
In-Reply-To: <825125.41592.qm@web37303.mail.mud.yahoo.com>
References: <825125.41592.qm@web37303.mail.mud.yahoo.com>
Message-ID: <Pine.LNX.4.64.0708290907520.6617@ampere.labo01.fmtc.be>

On Tue, 28 Aug 2007, said harti wrote:
> In order to send Mailbox messages, i'll test post_mbxmsg() eml function,
> but when i use  EtherCAT_Router object :
>
> EtherCAT_Router * ec_router = EtherCAT_Router::instance();
> ec_router->post_mbxmsg(&a_CoE_MsgMbx, sh_el6751)
>
> i got this error :
>
> incomplete type 'EtherCAT_Router' used in nested name specifier
>
> if you have some ideas, let me know please ?

Can you provide some more context about the error?

Klaas


From klaas.gadeyne at fmtc.be  Wed Aug 29 09:15:08 2007
From: klaas.gadeyne at fmtc.be (Klaas Gadeyne)
Date: Wed, 29 Aug 2007 09:15:08 +0200 (CEST)
Subject: [Ethercatmaster-users] mbx question
In-Reply-To: <46D446AE.6050100@free.fr>
References: <46D446AE.6050100@free.fr>
Message-ID: <Pine.LNX.4.64.0708290910260.6617@ampere.labo01.fmtc.be>

On Tue, 28 Aug 2007, St?phane ANCELOT wrote:
> Hi,
> When using post_mbx msg from the master what do I have to set in from_sh
> parameter ???

Hi Stephane,

See the 2-minutes-ago mail to the list.  The router is actually meant
for slave-to-slave mbx communication, that's why the function you
mention needs a slave handler address (I guess it's explained in the
spec like that).  However, you might problably trick it providing a
nonsense address if the source of the message isn't important for the
destination (i.e. it doesn't matter for the destination slave who
actually sent the message (in your case: the master)

But again, (I should post this as my sig on the ML), I haven't been
working on etherCAT for a while anymore and at the time we implemented
EML, there were no mbx communication slave available yet, so please
prove me wrong by quoting from the etherCAT specification :-)

regards,

Klaas

From sancelot at free.fr  Wed Aug 29 10:04:46 2007
From: sancelot at free.fr (=?ISO-8859-1?Q?St=E9phane_ANCELOT?=)
Date: Wed, 29 Aug 2007 10:04:46 +0200
Subject: [Ethercatmaster-users] mbx question
In-Reply-To: <Pine.LNX.4.64.0708290910260.6617@ampere.labo01.fmtc.be>
References: <46D446AE.6050100@free.fr>
	<Pine.LNX.4.64.0708290910260.6617@ampere.labo01.fmtc.be>
Message-ID: <46D5289E.3090506@free.fr>

Klaas Gadeyne a ?crit :
> On Tue, 28 Aug 2007, St?phane ANCELOT wrote:
>> Hi,
>> When using post_mbx msg from the master what do I have to set in from_sh
>> parameter ???
> 
> Hi Stephane,
> 
> See the 2-minutes-ago mail to the list.  The router is actually meant
> for slave-to-slave mbx communication, that's why the function you
> mention needs a slave handler address (I guess it's explained in the
> spec like that).  However, you might problably trick it providing a
> nonsense address if the source of the message isn't important for the
> destination (i.e. it doesn't matter for the destination slave who
> actually sent the message (in your case: the master)
> 
> But again, (I should post this as my sig on the ML), I haven't been
> working on etherCAT for a while anymore and at the time we implemented
> EML, there were no mbx communication slave available yet, so please
> prove me wrong by quoting from the etherCAT specification :-)

Ok, At this time we need only Mailbox communication from master to
slaves (available as stated in the specification) for sdo communication.

In order to do this , we will try to :
setup a mailbox for the master.
implement the mailbox write service derivated from the router code
post_mbxmsg().

Am I on the right way ?

> regards,
> 
> Klaas



From sancelot at free.fr  Wed Aug 29 10:08:51 2007
From: sancelot at free.fr (=?ISO-8859-1?Q?St=E9phane_ANCELOT?=)
Date: Wed, 29 Aug 2007 10:08:51 +0200
Subject: [Ethercatmaster-users] licensing question
Message-ID: <46D52993.5050600@free.fr>

Hi,
At the moment,  the source code is GPL this does not permit us to
deliver our application without delivering our application source code ....

Can it be changed to LGPL ? I can deliver my application with shared
libeml.so.

Best Regards
Steph


From rwatollenaar at gmail.com  Wed Aug 29 10:14:58 2007
From: rwatollenaar at gmail.com (Roland Tollenaar)
Date: Wed, 29 Aug 2007 10:14:58 +0200
Subject: [Ethercatmaster-users] mbx question
In-Reply-To: <46D5289E.3090506@free.fr>
References: <46D446AE.6050100@free.fr>	<Pine.LNX.4.64.0708290910260.6617@ampere.labo01.fmtc.be>
	<46D5289E.3090506@free.fr>
Message-ID: <46D52B02.7000607@gmail.com>

Hi,

This is not the busiest of mailing lists so I am going to risk a 
question. I have nothing to contribute to this thread but would dearly 
like ot know where the mailbox concept fits into Ethercat. I have come 
across it a lot but never seem to have required it and consequently 
don;t know what it does. How does it differ from the normal process data 
exchange with the three buffers?

Kind regards,

Roland.

St?phane ANCELOT wrote:
> Klaas Gadeyne a ?crit :
>> On Tue, 28 Aug 2007, St?phane ANCELOT wrote:
>>> Hi,
>>> When using post_mbx msg from the master what do I have to set in from_sh
>>> parameter ???
>> Hi Stephane,
>>
>> See the 2-minutes-ago mail to the list.  The router is actually meant
>> for slave-to-slave mbx communication, that's why the function you
>> mention needs a slave handler address (I guess it's explained in the
>> spec like that).  However, you might problably trick it providing a
>> nonsense address if the source of the message isn't important for the
>> destination (i.e. it doesn't matter for the destination slave who
>> actually sent the message (in your case: the master)
>>
>> But again, (I should post this as my sig on the ML), I haven't been
>> working on etherCAT for a while anymore and at the time we implemented
>> EML, there were no mbx communication slave available yet, so please
>> prove me wrong by quoting from the etherCAT specification :-)
> 
> Ok, At this time we need only Mailbox communication from master to
> slaves (available as stated in the specification) for sdo communication.
> 
> In order to do this , we will try to :
> setup a mailbox for the master.
> implement the mailbox write service derivated from the router code
> post_mbxmsg().
> 
> Am I on the right way ?
> 
>> regards,
>>
>> Klaas
> 
> _______________________________________________
> Ethercatmaster-users mailing list
> Ethercatmaster-users at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
> 


From sancelot at free.fr  Wed Aug 29 11:44:50 2007
From: sancelot at free.fr (=?ISO-8859-1?Q?St=E9phane_ANCELOT?=)
Date: Wed, 29 Aug 2007 11:44:50 +0200
Subject: [Ethercatmaster-users] mbx question
In-Reply-To: <46D52B02.7000607@gmail.com>
References: <46D446AE.6050100@free.fr>	<Pine.LNX.4.64.0708290910260.6617@ampere.labo01.fmtc.be>
	<46D5289E.3090506@free.fr> <46D52B02.7000607@gmail.com>
Message-ID: <46D54012.9060702@free.fr>

Roland Tollenaar a ?crit :
> Hi,
> 
> This is not the busiest of mailing lists so I am going to risk a
> question. I have nothing to contribute to this thread but would dearly
> like ot know where the mailbox concept fits into Ethercat. I have come
> across it a lot but never seem to have required it and consequently
> don;t know what it does. How does it differ from the normal process data
> exchange with the three buffers?
> 
> Kind regards,
> 
> Roland.
> 
Mainly used to setup parameters in slaves most of the time supposing a
non realtime context. If you want to talk to existing canopen
components, you will need it .
Best Regards
Steph






> St?phane ANCELOT wrote:
>> Klaas Gadeyne a ?crit :
>>> On Tue, 28 Aug 2007, St?phane ANCELOT wrote:
>>>> Hi,
>>>> When using post_mbx msg from the master what do I have to set in
>>>> from_sh
>>>> parameter ???
>>> Hi Stephane,
>>>
>>> See the 2-minutes-ago mail to the list.  The router is actually meant
>>> for slave-to-slave mbx communication, that's why the function you
>>> mention needs a slave handler address (I guess it's explained in the
>>> spec like that).  However, you might problably trick it providing a
>>> nonsense address if the source of the message isn't important for the
>>> destination (i.e. it doesn't matter for the destination slave who
>>> actually sent the message (in your case: the master)
>>>
>>> But again, (I should post this as my sig on the ML), I haven't been
>>> working on etherCAT for a while anymore and at the time we implemented
>>> EML, there were no mbx communication slave available yet, so please
>>> prove me wrong by quoting from the etherCAT specification :-)
>>
>> Ok, At this time we need only Mailbox communication from master to
>> slaves (available as stated in the specification) for sdo communication.
>>
>> In order to do this , we will try to :
>> setup a mailbox for the master.
>> implement the mailbox write service derivated from the router code
>> post_mbxmsg().
>>
>> Am I on the right way ?
>>
>>> regards,
>>>
>>> Klaas
>>
>> _______________________________________________
>> Ethercatmaster-users mailing list
>> Ethercatmaster-users at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/ethercatmaster-users
>>
> 
> 



From klaas.gadeyne at fmtc.be  Wed Aug 29 16:56:32 2007
From: klaas.gadeyne at fmtc.be (Klaas Gadeyne)
Date: Wed, 29 Aug 2007 16:56:32 +0200 (CEST)
Subject: [Ethercatmaster-users] mbx question
In-Reply-To: <46D5289E.3090506@free.fr>
References: <46D446AE.6050100@free.fr>
	<Pine.LNX.4.64.0708290910260.6617@ampere.labo01.fmtc.be>
	<46D5289E.3090506@free.fr>
Message-ID: <Pine.LNX.4.64.0708291654290.6617@ampere.labo01.fmtc.be>

On Wed, 29 Aug 2007, St?phane ANCELOT wrote:
[...]
> Ok, At this time we need only Mailbox communication from master to
> slaves (available as stated in the specification) for sdo communication.
>
> In order to do this , we will try to :
> setup a mailbox for the master.
> implement the mailbox write service derivated from the router code
> post_mbxmsg().
>
> Am I on the right way ?

I think so, yes!  Note that it might require some debugging, as none
of it has been tested...

Klaas

